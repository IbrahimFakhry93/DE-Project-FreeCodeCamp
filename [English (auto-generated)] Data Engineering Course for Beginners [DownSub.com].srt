1
00:00:00,040 --> 00:00:01,719
welcome to this data engineering crash

2
00:00:01,719 --> 00:00:04,240
course created by Justin Chow this

3
00:00:04,240 --> 00:00:06,240
course covers the essentials of data

4
00:00:06,240 --> 00:00:08,760
engineering you'll learn about databases

5
00:00:08,760 --> 00:00:11,679
Docker and analytical engineering you'll

6
00:00:11,679 --> 00:00:13,480
explore Advanced topics like data

7
00:00:13,480 --> 00:00:15,599
pipeline building with airflow and

8
00:00:15,599 --> 00:00:17,760
you'll engage in batch processing with

9
00:00:17,760 --> 00:00:20,840
spark and streaming data with Kafka the

10
00:00:20,840 --> 00:00:23,000
course culminates in a comprehensive

11
00:00:23,000 --> 00:00:25,080
project putting your skills to the test

12
00:00:25,080 --> 00:00:28,080
in creating a full endtoend pipeline hey

13
00:00:28,080 --> 00:00:29,720
everyone welcome to the course my name

14
00:00:29,720 --> 00:00:32,439
is Justin Chow I'm a developer Advocate

15
00:00:32,439 --> 00:00:34,440
at airbit I'm going to be going through

16
00:00:34,440 --> 00:00:36,079
kind of essentially what you need to

17
00:00:36,079 --> 00:00:38,079
know in order to become a data engineer

18
00:00:38,079 --> 00:00:40,360
what goes into Data engineering and then

19
00:00:40,360 --> 00:00:43,000
this is going to go into a fully fledged

20
00:00:43,000 --> 00:00:45,079
demo where you can follow me in creating

21
00:00:45,079 --> 00:00:46,920
a data pipeline from scratch and then

22
00:00:46,920 --> 00:00:49,760
evolving that into a fully fledged data

23
00:00:49,760 --> 00:00:52,079
pipeline using open-source tools such as

24
00:00:52,079 --> 00:00:54,000
airbit so hopefully you enjoyed this and

25
00:00:54,000 --> 00:00:55,960
this gathers some interest if anything

26
00:00:55,960 --> 00:00:57,719
along with data engineering or software

27
00:00:57,719 --> 00:00:59,160
engineering in general is of interest to

28
00:00:59,160 --> 00:01:00,800
you then this should be good to know but

29
00:01:00,800 --> 00:01:03,079
without further Ado let's get into the

30
00:01:03,079 --> 00:01:04,559
course so we're looking over the

31
00:01:04,559 --> 00:01:06,840
introduction to data engineering but you

32
00:01:06,840 --> 00:01:09,280
may be thinking why data Engineering in

33
00:01:09,280 --> 00:01:10,880
the first place well there's a couple

34
00:01:10,880 --> 00:01:12,320
reasons why you may want to consider

35
00:01:12,320 --> 00:01:13,920
getting into Data engineering first

36
00:01:13,920 --> 00:01:15,799
there's a high failure rate of Big Data

37
00:01:15,799 --> 00:01:17,720
projects and the percentage there based

38
00:01:17,720 --> 00:01:19,720
off of the data that we've collected is

39
00:01:19,720 --> 00:01:23,520
85 to 87% of those projects failing and

40
00:01:23,520 --> 00:01:25,240
obviously as I've said that's pretty

41
00:01:25,240 --> 00:01:26,920
pretty high those failures are due to

42
00:01:26,920 --> 00:01:28,680
unreliable data infrastructures and

43
00:01:28,680 --> 00:01:31,240
quality data in the past there's been an

44
00:01:31,240 --> 00:01:33,799
expectations for data scientists to

45
00:01:33,799 --> 00:01:35,439
build out that data infrastructure

46
00:01:35,439 --> 00:01:38,119
that's necessary for those projects with

47
00:01:38,119 --> 00:01:40,200
the infrastructure that was put in place

48
00:01:40,200 --> 00:01:42,000
there's always incorrect data modeling

49
00:01:42,000 --> 00:01:44,000
and redundant work that they have to do

50
00:01:44,000 --> 00:01:45,439
because of the incorrect data modeling

51
00:01:45,439 --> 00:01:46,680
and the Redundant work that they have to

52
00:01:46,680 --> 00:01:48,759
do there's a high rate of data scientist

53
00:01:48,759 --> 00:01:51,399
turnover so there's a high need of data

54
00:01:51,399 --> 00:01:53,079
Engineers to process that data and

55
00:01:53,079 --> 00:01:55,439
extract value instead of the data

56
00:01:55,439 --> 00:01:57,719
scientists with all of that being said

57
00:01:57,719 --> 00:01:59,520
there is a growing importance of the

58
00:01:59,520 --> 00:02:02,399
data engineering role as we speak if

59
00:02:02,399 --> 00:02:04,119
we're talking compensation right now in

60
00:02:04,119 --> 00:02:06,159
the US the average median salary for

61
00:02:06,159 --> 00:02:10,599
data Engineers is 90 to 150k a year and

62
00:02:10,599 --> 00:02:12,879
obviously I say in the US it still

63
00:02:12,879 --> 00:02:14,640
highly depends on the location and

64
00:02:14,640 --> 00:02:16,640
whether you're in the states or not so

65
00:02:16,640 --> 00:02:18,160
that number will change now let's look

66
00:02:18,160 --> 00:02:20,319
at the business potential and impact

67
00:02:20,319 --> 00:02:21,879
that data Engineers can have in any

68
00:02:21,879 --> 00:02:23,760
company you will have a crucial role in

69
00:02:23,760 --> 00:02:25,720
the success of making datadriven

70
00:02:25,720 --> 00:02:28,440
decisions in the AI and ml space for

71
00:02:28,440 --> 00:02:30,360
applications especially esally with the

72
00:02:30,360 --> 00:02:32,840
rise of chat GPT right now and the AI

73
00:02:32,840 --> 00:02:34,519
space in general data Engineers are

74
00:02:34,519 --> 00:02:36,200
going to have that crucial role in

75
00:02:36,200 --> 00:02:38,000
determining what happens with those

76
00:02:38,000 --> 00:02:39,680
applications and the data in general now

77
00:02:39,680 --> 00:02:41,000
let's look at the business potential

78
00:02:41,000 --> 00:02:42,599
that you have as data engineers and the

79
00:02:42,599 --> 00:02:44,800
impact you can make in any company that

80
00:02:44,800 --> 00:02:46,720
you work for the first one being is that

81
00:02:46,720 --> 00:02:47,920
you're going to have a crucial role in

82
00:02:47,920 --> 00:02:49,480
the success of making data driven

83
00:02:49,480 --> 00:02:52,000
decisions in the AI and ml space for

84
00:02:52,000 --> 00:02:53,640
applications and so with the rise of

85
00:02:53,640 --> 00:02:56,840
chpt and the AI space you're going to be

86
00:02:56,840 --> 00:03:00,360
a crucial factor in that aspect and for

87
00:03:00,360 --> 00:03:02,080
any company that wants to and should be

88
00:03:02,080 --> 00:03:03,760
getting into AI in general the next

89
00:03:03,760 --> 00:03:04,720
thing you're going to be doing is

90
00:03:04,720 --> 00:03:05,879
ensuring that there's efficient

91
00:03:05,879 --> 00:03:08,080
management and processing of the actual

92
00:03:08,080 --> 00:03:10,640
data as it moves Downstream while it

93
00:03:10,640 --> 00:03:12,519
moves Downstream you're also ensuring

94
00:03:12,519 --> 00:03:14,920
that the data quality the security and

95
00:03:14,920 --> 00:03:16,640
availability of it to those teams

96
00:03:16,640 --> 00:03:19,640
Downstream such as the data scientists

97
00:03:19,640 --> 00:03:21,959
the data analysts or any other team that

98
00:03:21,959 --> 00:03:24,120
has to work with data in your company

99
00:03:24,120 --> 00:03:26,760
that it's quality it's secure it's

100
00:03:26,760 --> 00:03:29,159
formatted the way that they need it and

101
00:03:29,159 --> 00:03:31,840
it's never not flowing Downstream this

102
00:03:31,840 --> 00:03:33,200
will also lead to better insights and

103
00:03:33,200 --> 00:03:35,200
outcomes for your company and overall

104
00:03:35,200 --> 00:03:36,879
just drive Innovation and

105
00:03:36,879 --> 00:03:39,000
competitiveness so that your company can

106
00:03:39,000 --> 00:03:41,920
Thrive and that your team can Thrive so

107
00:03:41,920 --> 00:03:43,239
now we're moving on into the first

108
00:03:43,239 --> 00:03:45,120
module which is the introduction to

109
00:03:45,120 --> 00:03:47,439
Docker and what we use Docker for in

110
00:03:47,439 --> 00:03:49,439
data engineering but first we have to

111
00:03:49,439 --> 00:03:51,000
have a better understanding of what it

112
00:03:51,000 --> 00:03:52,840
is if you haven't used it before Docker

113
00:03:52,840 --> 00:03:54,400
is an open source platform that

114
00:03:54,400 --> 00:03:56,120
simplifies the process of building

115
00:03:56,120 --> 00:03:58,239
shipping and running any applications

116
00:03:58,239 --> 00:04:00,599
inside containers so imagine you are

117
00:04:00,599 --> 00:04:02,640
working on a project and you want your

118
00:04:02,640 --> 00:04:05,000
co-workers to try and use it to see if

119
00:04:05,000 --> 00:04:07,760
there's any issues but they can't run it

120
00:04:07,760 --> 00:04:10,920
for some reason and you kind of run into

121
00:04:10,920 --> 00:04:12,799
that good old saying of hey it runs okay

122
00:04:12,799 --> 00:04:14,720
on my machine well what Docker is able

123
00:04:14,720 --> 00:04:17,519
to do is you're able to put your

124
00:04:17,519 --> 00:04:19,880
environment into a container and that

125
00:04:19,880 --> 00:04:23,360
container will include every dependency

126
00:04:23,360 --> 00:04:25,800
and kind of Silo everything into again

127
00:04:25,800 --> 00:04:27,520
this container which you can then pass

128
00:04:27,520 --> 00:04:30,000
on to your co-workers or even even run

129
00:04:30,000 --> 00:04:32,240
up in the cloud to have your application

130
00:04:32,240 --> 00:04:33,840
running as it was when you were

131
00:04:33,840 --> 00:04:36,320
developing it so it essentially just

132
00:04:36,320 --> 00:04:38,919
helps organize and make sure everything

133
00:04:38,919 --> 00:04:41,400
works as developed so if we're going

134
00:04:41,400 --> 00:04:43,520
over containers and their benefits

135
00:04:43,520 --> 00:04:45,240
containers are lightweight portable and

136
00:04:45,240 --> 00:04:46,880
self-sufficient environments that

137
00:04:46,880 --> 00:04:48,400
package an application along with all

138
00:04:48,400 --> 00:04:49,759
its dependencies libraries and

139
00:04:49,759 --> 00:04:52,120
configurations as I mentioned before

140
00:04:52,120 --> 00:04:54,759
again just going over how much Docker

141
00:04:54,759 --> 00:04:57,280
has really really helped engineers in

142
00:04:57,280 --> 00:05:00,360
General on packaging their applications

143
00:05:00,360 --> 00:05:01,880
to make sure that they don't run into

144
00:05:01,880 --> 00:05:03,960
any issues down the line when testing

145
00:05:03,960 --> 00:05:05,680
and developing and to make sure that

146
00:05:05,680 --> 00:05:07,520
those environments are reproducible in

147
00:05:07,520 --> 00:05:09,560
case anything goes wrong and making sure

148
00:05:09,560 --> 00:05:10,800
that also when they're pushing up into

149
00:05:10,800 --> 00:05:12,759
the cloud or into production that those

150
00:05:12,759 --> 00:05:15,120
applications are working as intended and

151
00:05:15,120 --> 00:05:16,440
when they were testing it's going to

152
00:05:16,440 --> 00:05:18,000
work the same way in prod so now just

153
00:05:18,000 --> 00:05:19,960
imagine that all your apps code and all

154
00:05:19,960 --> 00:05:21,960
your apps dependencies are landing into

155
00:05:21,960 --> 00:05:23,680
one of these containers and you're

156
00:05:23,680 --> 00:05:25,800
shipping one of those off out into you

157
00:05:25,800 --> 00:05:28,160
know your cooworker place or on AWS or

158
00:05:28,160 --> 00:05:30,240
gcp everything that was inside that

159
00:05:30,240 --> 00:05:32,479
container will be seen on the other end

160
00:05:32,479 --> 00:05:33,919
as well now as I mentioned before in

161
00:05:33,919 --> 00:05:35,360
software development we're looking at

162
00:05:35,360 --> 00:05:38,039
Docker in the form of testing deployment

163
00:05:38,039 --> 00:05:40,160
for its ease of use speed and

164
00:05:40,160 --> 00:05:41,919
flexibility it assists with the

165
00:05:41,919 --> 00:05:43,520
deployment scaling and management of

166
00:05:43,520 --> 00:05:45,520
those applications using what we call

167
00:05:45,520 --> 00:05:47,160
containerization which is just a

168
00:05:47,160 --> 00:05:49,280
lightweight form of virtualization so if

169
00:05:49,280 --> 00:05:50,919
you look on the right hand side's

170
00:05:50,919 --> 00:05:52,720
illustration here you can see that we

171
00:05:52,720 --> 00:05:55,000
have a couple apps that are in

172
00:05:55,000 --> 00:05:57,800
containers using Docker uh as well as

173
00:05:57,800 --> 00:05:59,240
you know sitting on top of your

174
00:05:59,240 --> 00:06:01,479
operating system and the infrastructure

175
00:06:01,479 --> 00:06:03,199
and it's all running all within the

176
00:06:03,199 --> 00:06:05,479
docker ecosystem now there are three

177
00:06:05,479 --> 00:06:06,960
main concepts with Docker that we need

178
00:06:06,960 --> 00:06:08,560
to understand the first one is going to

179
00:06:08,560 --> 00:06:10,639
be Docker files the second one is going

180
00:06:10,639 --> 00:06:12,759
to be Docker images and the third one is

181
00:06:12,759 --> 00:06:14,639
going to be Docker containers now let's

182
00:06:14,639 --> 00:06:17,000
go over what those three are right now

183
00:06:17,000 --> 00:06:18,880
the first step is the docker file the

184
00:06:18,880 --> 00:06:20,720
docker file is a text file that consists

185
00:06:20,720 --> 00:06:22,599
of all the instructions needed hence

186
00:06:22,599 --> 00:06:25,120
blueprints that we want Docker to use

187
00:06:25,120 --> 00:06:27,520
all in order to create the docker image

188
00:06:27,520 --> 00:06:29,800
so the docker image is what is created

189
00:06:29,800 --> 00:06:32,199
from the docker file hence the blueprint

190
00:06:32,199 --> 00:06:33,840
so the blueprint then creates our Docker

191
00:06:33,840 --> 00:06:35,360
image which is the lightweight

192
00:06:35,360 --> 00:06:37,599
Standalone executable package that

193
00:06:37,599 --> 00:06:39,360
includes everything we need to run your

194
00:06:39,360 --> 00:06:41,479
piece of software that includes code the

195
00:06:41,479 --> 00:06:44,720
runtime libraries environment variables

196
00:06:44,720 --> 00:06:47,280
and config files the one thing to note

197
00:06:47,280 --> 00:06:49,840
is that images are readon and immutable

198
00:06:49,840 --> 00:06:51,599
so nothing can change within the docker

199
00:06:51,599 --> 00:06:53,639
image itself if you wanted to create

200
00:06:53,639 --> 00:06:55,639
another Docker image or modify anything

201
00:06:55,639 --> 00:06:57,520
that exists you want to modify your

202
00:06:57,520 --> 00:06:59,879
Docker file and the instructions that

203
00:06:59,879 --> 00:07:01,599
inside that text file to create a new

204
00:07:01,599 --> 00:07:04,000
Docker image so that's why we stick the

205
00:07:04,000 --> 00:07:06,479
image into a Docker container which is

206
00:07:06,479 --> 00:07:09,120
the runtime instance of our Docker image

207
00:07:09,120 --> 00:07:11,520
or in other words the running version of

208
00:07:11,520 --> 00:07:13,759
the image is the docker container this

209
00:07:13,759 --> 00:07:15,759
Docker container is completely isolated

210
00:07:15,759 --> 00:07:17,960
from the host and other containers that

211
00:07:17,960 --> 00:07:20,039
you may have running it has its own file

212
00:07:20,039 --> 00:07:22,840
system and can be started stopped and

213
00:07:22,840 --> 00:07:25,240
deleted inde dependently so for example

214
00:07:25,240 --> 00:07:26,919
we may have one Docker image that

215
00:07:26,919 --> 00:07:29,039
contains our application but we have

216
00:07:29,039 --> 00:07:31,000
three different Docker containers

217
00:07:31,000 --> 00:07:33,840
running that same image so we have three

218
00:07:33,840 --> 00:07:35,560
different environments three different

219
00:07:35,560 --> 00:07:37,800
instances of that image but I can stop

220
00:07:37,800 --> 00:07:39,680
one and the other two are still going to

221
00:07:39,680 --> 00:07:42,280
run I can delete one and nothing changes

222
00:07:42,280 --> 00:07:43,960
in those other containers because they

223
00:07:43,960 --> 00:07:46,720
are isolated environments and you can

224
00:07:46,720 --> 00:07:48,599
run tests you can do anything you want

225
00:07:48,599 --> 00:07:50,479
in those containers but nothing will

226
00:07:50,479 --> 00:07:52,879
change unless it is done inside the

227
00:07:52,879 --> 00:07:55,199
container so first things first to get

228
00:07:55,199 --> 00:07:56,960
started with Docker is obviously we're

229
00:07:56,960 --> 00:07:59,680
going to want to install Docker so head

230
00:07:59,680 --> 00:08:02,520
over to doer. and here is the landing

231
00:08:02,520 --> 00:08:04,599
page of Docker now what we want to do is

232
00:08:04,599 --> 00:08:06,960
simply just download Docker for whatever

233
00:08:06,960 --> 00:08:09,120
operating system you have I am currently

234
00:08:09,120 --> 00:08:11,039
running on a mac Apple chip so I would

235
00:08:11,039 --> 00:08:13,759
click this and download Docker desktop

236
00:08:13,759 --> 00:08:15,800
which also comes with Docker compose

237
00:08:15,800 --> 00:08:18,720
which we will also need for later along

238
00:08:18,720 --> 00:08:21,120
in this course but just know that Docker

239
00:08:21,120 --> 00:08:23,919
compose and Docker desktop are two

240
00:08:23,919 --> 00:08:25,759
prerequisites to running with Docker

241
00:08:25,759 --> 00:08:27,159
right now now if you're on Windows

242
00:08:27,159 --> 00:08:28,560
obviously follow the instructions for

243
00:08:28,560 --> 00:08:30,440
Windows if you're on Linux follow the

244
00:08:30,440 --> 00:08:32,039
instructions for Linux but go ahead and

245
00:08:32,039 --> 00:08:34,080
download Docker for your machine and if

246
00:08:34,080 --> 00:08:36,599
you have any questions uh you can also

247
00:08:36,599 --> 00:08:39,959
go over to Docker and they have a really

248
00:08:39,959 --> 00:08:42,440
good explanation in their docs on how to

249
00:08:42,440 --> 00:08:44,839
install Docker desktop for your machine

250
00:08:44,839 --> 00:08:46,880
and get going with that so make sure you

251
00:08:46,880 --> 00:08:48,839
do this first now that we have Docker

252
00:08:48,839 --> 00:08:51,240
installed I think the docker docks have

253
00:08:51,240 --> 00:08:53,519
a great getting started guide on how you

254
00:08:53,519 --> 00:08:56,200
can actually containerize an application

255
00:08:56,200 --> 00:08:57,720
and so what we're going to do is

256
00:08:57,720 --> 00:08:59,040
actually just go through this really

257
00:08:59,040 --> 00:09:01,040
quickly and it can give us a great idea

258
00:09:01,040 --> 00:09:02,920
of how to containerize an application

259
00:09:02,920 --> 00:09:05,040
through a Docker file how we build the

260
00:09:05,040 --> 00:09:06,959
image getting the image to run inside of

261
00:09:06,959 --> 00:09:08,839
a container and then a couple other

262
00:09:08,839 --> 00:09:10,279
things like networking and things like

263
00:09:10,279 --> 00:09:11,399
that so let's go ahead and go through

264
00:09:11,399 --> 00:09:13,040
the getting started guide and then we'll

265
00:09:13,040 --> 00:09:15,760
move on into the SQL module right after

266
00:09:15,760 --> 00:09:17,920
so if you were still confused on what a

267
00:09:17,920 --> 00:09:19,800
container is or what an image is it

268
00:09:19,800 --> 00:09:21,360
gives you a good rundown here at the

269
00:09:21,360 --> 00:09:23,240
beginning of part one but let's go into

270
00:09:23,240 --> 00:09:25,000
part two on how we can containerize an

271
00:09:25,000 --> 00:09:26,600
application first things first is they

272
00:09:26,600 --> 00:09:27,880
actually have a getting started app

273
00:09:27,880 --> 00:09:29,600
which is just a to-do app for you to

274
00:09:29,600 --> 00:09:31,240
containerize but what we're going to do

275
00:09:31,240 --> 00:09:33,839
first is simply just clone this and and

276
00:09:33,839 --> 00:09:35,360
use it for the rest of this guide I'm

277
00:09:35,360 --> 00:09:36,839
going to open up my terminal here and

278
00:09:36,839 --> 00:09:39,240
make a directory and I'm going to call

279
00:09:39,240 --> 00:09:42,839
this Docker tutorial and I'm going to CD

280
00:09:42,839 --> 00:09:44,360
into Docker

281
00:09:44,360 --> 00:09:46,279
tutorial and then after that what we're

282
00:09:46,279 --> 00:09:47,600
going to do is paste in the command that

283
00:09:47,600 --> 00:09:49,480
was in there which simply just clones

284
00:09:49,480 --> 00:09:51,640
the repo and obviously if it wasn't

285
00:09:51,640 --> 00:09:53,480
clear enough and make sure you have a

286
00:09:53,480 --> 00:09:55,800
text editor installed I'm using vs code

287
00:09:55,800 --> 00:09:57,440
and I think that should be it obviously

288
00:09:57,440 --> 00:09:59,680
Docker installed now that it's clone

289
00:09:59,680 --> 00:10:02,040
let's go ahead and CD into the getting

290
00:10:02,040 --> 00:10:04,680
started guide and what we can see here

291
00:10:04,680 --> 00:10:06,480
is if we open up vs code there's a

292
00:10:06,480 --> 00:10:07,839
couple things here so we have a spec

293
00:10:07,839 --> 00:10:10,240
file we only really need to look at the

294
00:10:10,240 --> 00:10:12,000
source file but this is just a simple

295
00:10:12,000 --> 00:10:13,959
Todo app so let's go ahead and go back

296
00:10:13,959 --> 00:10:16,880
to the getting started guide and it has

297
00:10:16,880 --> 00:10:18,560
the instructions for you on Mac and

298
00:10:18,560 --> 00:10:20,800
windows so depending on your operating

299
00:10:20,800 --> 00:10:22,200
system make sure you follow the right

300
00:10:22,200 --> 00:10:24,279
ones but we've already cded into it what

301
00:10:24,279 --> 00:10:27,079
we're going to do is inside of the route

302
00:10:27,079 --> 00:10:28,839
directory of the getting started app

303
00:10:28,839 --> 00:10:31,600
we're going to to create a Docker file

304
00:10:31,600 --> 00:10:33,200
and as mentioned before this is going to

305
00:10:33,200 --> 00:10:35,040
be the instructions on how we build the

306
00:10:35,040 --> 00:10:37,639
image that containerized the application

307
00:10:37,639 --> 00:10:39,160
that the docker file is sitting in so

308
00:10:39,160 --> 00:10:40,800
now that I've created the docker file if

309
00:10:40,800 --> 00:10:42,560
type in LS you can see that the docker

310
00:10:42,560 --> 00:10:45,399
file is there so what we're going to do

311
00:10:45,399 --> 00:10:48,120
is they've provided us the instructions

312
00:10:48,120 --> 00:10:50,200
or the contents that we're going to use

313
00:10:50,200 --> 00:10:52,240
for this Docker file now you can see

314
00:10:52,240 --> 00:10:53,760
that we have a couple things here that

315
00:10:53,760 --> 00:10:55,680
we haven't seen before but essentially

316
00:10:55,680 --> 00:10:57,639
what from is is we're going to use the

317
00:10:57,639 --> 00:10:59,959
node 18 package that we're pulling from

318
00:10:59,959 --> 00:11:02,600
the docker Hub to run our environment in

319
00:11:02,600 --> 00:11:04,839
or our run time the working directory is

320
00:11:04,839 --> 00:11:07,320
going to be in the SL app or the root

321
00:11:07,320 --> 00:11:09,399
directory of the application this simply

322
00:11:09,399 --> 00:11:11,440
copies everything and then we're going

323
00:11:11,440 --> 00:11:13,399
to run this command which is yarn

324
00:11:13,399 --> 00:11:15,720
install production other commands that

325
00:11:15,720 --> 00:11:17,920
are going to be is going to be node and

326
00:11:17,920 --> 00:11:19,920
we're going to look at in the source

327
00:11:19,920 --> 00:11:22,839
index.js file and we're also exposing

328
00:11:22,839 --> 00:11:24,720
Port 3000 so you can see that these

329
00:11:24,720 --> 00:11:26,079
instructions are pretty straightforward

330
00:11:26,079 --> 00:11:27,720
read like English the one thing to take

331
00:11:27,720 --> 00:11:30,079
in mind is that this does have to be in

332
00:11:30,079 --> 00:11:32,680
order this cannot be misplaced so keep

333
00:11:32,680 --> 00:11:33,800
that in mind when you're writing your

334
00:11:33,800 --> 00:11:35,480
own Docker files but what we're going to

335
00:11:35,480 --> 00:11:36,959
do is we're simply just going to copy

336
00:11:36,959 --> 00:11:39,800
this switch back over to our VSS code

337
00:11:39,800 --> 00:11:42,200
head into Docker file and then just

338
00:11:42,200 --> 00:11:44,399
paste this in and save now that that's

339
00:11:44,399 --> 00:11:45,880
saved they give us a command so we're

340
00:11:45,880 --> 00:11:48,200
going to run Docker build hyphen T which

341
00:11:48,200 --> 00:11:49,959
simply just tags our image and then

342
00:11:49,959 --> 00:11:51,519
we're going to name it getting started

343
00:11:51,519 --> 00:11:53,120
so that will be the name of our image

344
00:11:53,120 --> 00:11:55,160
and then the dot we need at the end to

345
00:11:55,160 --> 00:11:57,040
tell Docker where to look for everything

346
00:11:57,040 --> 00:11:58,920
to containerize which will simply just

347
00:11:58,920 --> 00:12:00,240
be in the the current directory so I'm

348
00:12:00,240 --> 00:12:02,040
going to go ahead and copy this command

349
00:12:02,040 --> 00:12:04,360
as well paste this in also make sure

350
00:12:04,360 --> 00:12:06,000
that you have the docker Damon running

351
00:12:06,000 --> 00:12:07,480
if you installed Docker desktop just

352
00:12:07,480 --> 00:12:09,000
simply open the application let

353
00:12:09,000 --> 00:12:10,279
everything launch and then you should be

354
00:12:10,279 --> 00:12:11,600
good so I'm going to go ahead and hit

355
00:12:11,600 --> 00:12:13,440
enter this is going to do a couple

356
00:12:13,440 --> 00:12:16,959
things awesome so now if we go back into

357
00:12:16,959 --> 00:12:19,480
Docker desktop and we go into images you

358
00:12:19,480 --> 00:12:21,560
can see at the very top getting started

359
00:12:21,560 --> 00:12:23,959
is created we have an image the tag is

360
00:12:23,959 --> 00:12:25,720
going to be the latest tag hasn't been

361
00:12:25,720 --> 00:12:27,760
used yet tells us our size but now we

362
00:12:27,760 --> 00:12:30,079
have an image with everything as you can

363
00:12:30,079 --> 00:12:32,680
see from the docker file so you can see

364
00:12:32,680 --> 00:12:34,480
the commands that we ran we have node

365
00:12:34,480 --> 00:12:37,199
version 18 which we did with the from

366
00:12:37,199 --> 00:12:38,680
command and then we're also exposing

367
00:12:38,680 --> 00:12:40,839
Port 3000 so you can see that the docker

368
00:12:40,839 --> 00:12:43,120
files blueprint is in play here next

369
00:12:43,120 --> 00:12:44,360
thing we're going to do is going to

370
00:12:44,360 --> 00:12:46,199
start this container so we can say

371
00:12:46,199 --> 00:12:48,480
Docker run which is going to run the

372
00:12:48,480 --> 00:12:50,560
image in a container we're going to flag

373
00:12:50,560 --> 00:12:53,959
it for DP which the D flag is short for

374
00:12:53,959 --> 00:12:55,839
detach which runs the container in the

375
00:12:55,839 --> 00:12:57,399
background the P flag is short for

376
00:12:57,399 --> 00:12:58,760
publish which means that we're creating

377
00:12:58,760 --> 00:13:00,560
this Port mapping so that we can

378
00:13:00,560 --> 00:13:03,000
actually access this container locally

379
00:13:03,000 --> 00:13:04,440
and with the mapping we're pointing it

380
00:13:04,440 --> 00:13:08,440
to a local host here so 12.0.0 point1

381
00:13:08,440 --> 00:13:10,800
and we're opening it on Port 3000 now

382
00:13:10,800 --> 00:13:13,000
keep in mind this can change say you

383
00:13:13,000 --> 00:13:14,399
have an application already running on

384
00:13:14,399 --> 00:13:16,720
Port 3000 but you wanted to run this on

385
00:13:16,720 --> 00:13:18,920
Port 6000 you can definitely change this

386
00:13:18,920 --> 00:13:21,079
but this number after the colon needs to

387
00:13:21,079 --> 00:13:24,440
stay at 3,000 because in our Docker file

388
00:13:24,440 --> 00:13:27,279
we exposed Port 3000 so to be able to

389
00:13:27,279 --> 00:13:29,240
access this we need to still keep that

390
00:13:29,240 --> 00:13:31,639
number to 3,000 and then after this this

391
00:13:31,639 --> 00:13:33,079
is the name of our container so

392
00:13:33,079 --> 00:13:34,440
obviously we're going to name it getting

393
00:13:34,440 --> 00:13:37,320
started so let me copy and paste this go

394
00:13:37,320 --> 00:13:38,959
back in our terminal and as you can see

395
00:13:38,959 --> 00:13:41,160
it spits out a container ID uh I'm going

396
00:13:41,160 --> 00:13:43,000
to go Ahad and copy this for later but

397
00:13:43,000 --> 00:13:45,079
if we go back into Docker desktop now

398
00:13:45,079 --> 00:13:47,120
just for a simpler gooey to see if we go

399
00:13:47,120 --> 00:13:48,800
to the containers tab you can see that a

400
00:13:48,800 --> 00:13:50,600
container was created with the image

401
00:13:50,600 --> 00:13:52,759
getting started and it is currently

402
00:13:52,759 --> 00:13:55,519
running on Port 3000 so now if we're

403
00:13:55,519 --> 00:13:57,079
going to go back here and we want to go

404
00:13:57,079 --> 00:13:59,680
to local poost Port 3000 you can see

405
00:13:59,680 --> 00:14:02,079
that the app is now running locally and

406
00:14:02,079 --> 00:14:04,199
we're accessing this container so that

407
00:14:04,199 --> 00:14:07,320
is good now we can move on well first of

408
00:14:07,320 --> 00:14:09,360
all what we may want to do is I can show

409
00:14:09,360 --> 00:14:11,399
you guys that you can actually write

410
00:14:11,399 --> 00:14:13,000
stuff to this so as I mentioned before

411
00:14:13,000 --> 00:14:14,920
this is a to-do app so I can say get cat

412
00:14:14,920 --> 00:14:17,680
food take out the trash very simple

413
00:14:17,680 --> 00:14:19,440
react app going on right now that is

414
00:14:19,440 --> 00:14:21,920
inside of a container so as I mentioned

415
00:14:21,920 --> 00:14:24,440
previously before we started this demo

416
00:14:24,440 --> 00:14:26,959
is that Docker contains a runtime it

417
00:14:26,959 --> 00:14:28,800
contains all the environment variables

418
00:14:28,800 --> 00:14:31,759
and it contains every single dependency

419
00:14:31,759 --> 00:14:33,480
that react or this application in

420
00:14:33,480 --> 00:14:35,600
general needs in order to run and so

421
00:14:35,600 --> 00:14:37,920
we're siloed inside of a container with

422
00:14:37,920 --> 00:14:39,920
a runtime with this environment and

423
00:14:39,920 --> 00:14:41,480
we're able to actually use the

424
00:14:41,480 --> 00:14:43,720
application within the container there's

425
00:14:43,720 --> 00:14:45,199
a couple other commands it tells us so

426
00:14:45,199 --> 00:14:47,120
in the command line we can run Docker PS

427
00:14:47,120 --> 00:14:48,839
and it will name any other containers

428
00:14:48,839 --> 00:14:50,360
that are currently running along with

429
00:14:50,360 --> 00:14:52,079
their container ID so as I mentioned

430
00:14:52,079 --> 00:14:54,079
this container ID popped up but if I

431
00:14:54,079 --> 00:14:56,000
type in Docker PS it's going to be the

432
00:14:56,000 --> 00:14:57,600
only one running but if there were any

433
00:14:57,600 --> 00:14:59,480
other containers running we can pull

434
00:14:59,480 --> 00:15:01,199
their container ID along with their

435
00:15:01,199 --> 00:15:03,320
names and other information the other

436
00:15:03,320 --> 00:15:05,079
thing to note too is that container IDs

437
00:15:05,079 --> 00:15:07,680
can be accessed you don't need the full

438
00:15:07,680 --> 00:15:09,440
container ID you only need the first

439
00:15:09,440 --> 00:15:11,199
couple digits here and you can still

440
00:15:11,199 --> 00:15:12,680
access that container so let's move on

441
00:15:12,680 --> 00:15:14,480
to part three here now we were going to

442
00:15:14,480 --> 00:15:16,279
want to make some changes to this code

443
00:15:16,279 --> 00:15:17,360
and this is going to show us how

444
00:15:17,360 --> 00:15:19,600
updating the application itself changes

445
00:15:19,600 --> 00:15:22,240
things so they want us to change a

446
00:15:22,240 --> 00:15:26,519
paragraph inside of the SRC static JS

447
00:15:26,519 --> 00:15:29,440
app.js file so let's head back into vs

448
00:15:29,440 --> 00:15:32,079
code so we're in SRC we're in static

449
00:15:32,079 --> 00:15:33,120
we're going to go to

450
00:15:33,120 --> 00:15:36,360
index.js JS app.js sorry and then go to

451
00:15:36,360 --> 00:15:38,639
56 and then we're simply going to change

452
00:15:38,639 --> 00:15:40,600
this text to be what they told us we're

453
00:15:40,600 --> 00:15:42,319
going to go ahead and save that but now

454
00:15:42,319 --> 00:15:43,880
that we've updated the application that

455
00:15:43,880 --> 00:15:45,519
means we actually have to build another

456
00:15:45,519 --> 00:15:47,319
version of this image because the image

457
00:15:47,319 --> 00:15:50,319
we built cannot be Rewritten it is

458
00:15:50,319 --> 00:15:52,319
completely readon and so if we're going

459
00:15:52,319 --> 00:15:54,360
to make any changes we have to create

460
00:15:54,360 --> 00:15:56,440
another image and so that's exactly what

461
00:15:56,440 --> 00:15:57,680
we're going to do we're going to run the

462
00:15:57,680 --> 00:16:00,279
same Docker build command command in the

463
00:16:00,279 --> 00:16:01,759
terminal and that's going to build

464
00:16:01,759 --> 00:16:03,880
another image and so now what we're

465
00:16:03,880 --> 00:16:05,560
going to do is we're going to run

466
00:16:05,560 --> 00:16:06,959
container command but we're going to get

467
00:16:06,959 --> 00:16:09,360
an error here because we already have a

468
00:16:09,360 --> 00:16:10,959
container with that name that's binded

469
00:16:10,959 --> 00:16:13,360
to Port 3000 now if we want to remove

470
00:16:13,360 --> 00:16:15,120
the old container that this will bring

471
00:16:15,120 --> 00:16:16,880
us back into Docker PS so we're going to

472
00:16:16,880 --> 00:16:18,800
run Docker PS and so we can see that

473
00:16:18,800 --> 00:16:20,399
this container is still running so what

474
00:16:20,399 --> 00:16:22,120
we're going to do is we're going to say

475
00:16:22,120 --> 00:16:25,240
Docker RM paste the container ID and

476
00:16:25,240 --> 00:16:27,079
that should give me another error saying

477
00:16:27,079 --> 00:16:28,920
you cannot remove a running container so

478
00:16:28,920 --> 00:16:30,839
we're going to say Docker RM and put in

479
00:16:30,839 --> 00:16:33,480
the F flag that will stop the container

480
00:16:33,480 --> 00:16:36,319
as well as remove the container so I'm

481
00:16:36,319 --> 00:16:38,519
going to do that and that should now get

482
00:16:38,519 --> 00:16:40,240
rid of it and now we can see that this

483
00:16:40,240 --> 00:16:42,800
has stopped and we can copy and paste

484
00:16:42,800 --> 00:16:45,319
this again and now we've created another

485
00:16:45,319 --> 00:16:47,560
container and it has started running

486
00:16:47,560 --> 00:16:50,720
with the updated image now if we go back

487
00:16:50,720 --> 00:16:53,440
into the to-do app and refresh this you

488
00:16:53,440 --> 00:16:55,440
can see that it's completely fresh and

489
00:16:55,440 --> 00:16:58,240
the new text has been added so that's

490
00:16:58,240 --> 00:16:59,880
what happens when you go and update an

491
00:16:59,880 --> 00:17:01,319
application we're going to skip part

492
00:17:01,319 --> 00:17:03,680
four but if you wanted to push this

493
00:17:03,680 --> 00:17:05,880
image up into the docker hub for other

494
00:17:05,880 --> 00:17:08,120
people to access you can absolutely do

495
00:17:08,120 --> 00:17:10,160
that we're not doing that right now so

496
00:17:10,160 --> 00:17:12,280
at your own you can go through part four

497
00:17:12,280 --> 00:17:14,640
but we're going to go to part five and

498
00:17:14,640 --> 00:17:16,839
this is actually a big one because

499
00:17:16,839 --> 00:17:18,959
sometimes we're messing with data and as

500
00:17:18,959 --> 00:17:21,640
we saw in the to-do app we have data and

501
00:17:21,640 --> 00:17:23,520
we want to persist it but if we were to

502
00:17:23,520 --> 00:17:25,439
stop the container and open it the data

503
00:17:25,439 --> 00:17:26,799
that we had previously is going to be

504
00:17:26,799 --> 00:17:29,200
gone so the way we can actually assist

505
00:17:29,200 --> 00:17:32,520
data is by simply adding a couple things

506
00:17:32,520 --> 00:17:34,919
so we're going to go through the steps

507
00:17:34,919 --> 00:17:36,640
one more time but we're going to run

508
00:17:36,640 --> 00:17:38,559
this command here we're simply going to

509
00:17:38,559 --> 00:17:40,280
start a container that has a buntu

510
00:17:40,280 --> 00:17:42,240
running and it's going to contain a file

511
00:17:42,240 --> 00:17:44,480
called data. text that will have a

512
00:17:44,480 --> 00:17:47,120
random number between 1 and 10,000 so

513
00:17:47,120 --> 00:17:49,160
let's go open up my terminal and we're

514
00:17:49,160 --> 00:17:51,440
going to run Docker through that and as

515
00:17:51,440 --> 00:17:53,320
you can see it created another container

516
00:17:53,320 --> 00:17:55,400
has an image of auntu I already had it

517
00:17:55,400 --> 00:17:57,559
installed locally but if you do not have

518
00:17:57,559 --> 00:18:00,400
the iunu image it will immediately

519
00:18:00,400 --> 00:18:01,919
detect that and download that from the

520
00:18:01,919 --> 00:18:04,039
docker Hub once we have that going we're

521
00:18:04,039 --> 00:18:05,640
going to copy and paste this and this

522
00:18:05,640 --> 00:18:08,559
will simply check the file that is

523
00:18:08,559 --> 00:18:10,919
inside the container which is data. text

524
00:18:10,919 --> 00:18:13,679
and it should spit out the name of the

525
00:18:13,679 --> 00:18:14,919
or should not spit out the name but it

526
00:18:14,919 --> 00:18:16,559
should spit out the number and what we

527
00:18:16,559 --> 00:18:19,159
need to do is we need to remove the

528
00:18:19,159 --> 00:18:22,039
current container ID or the placeholder

529
00:18:22,039 --> 00:18:24,159
there with the actual container ID and

530
00:18:24,159 --> 00:18:26,880
there we go we have 848 that's spit out

531
00:18:26,880 --> 00:18:28,919
to us so we know that there is data in

532
00:18:28,919 --> 00:18:30,320
side they want us to start another

533
00:18:30,320 --> 00:18:32,400
container that has a bunu so we're going

534
00:18:32,400 --> 00:18:34,840
to go ahead and do that as well and

535
00:18:34,840 --> 00:18:37,400
it'll list in every single folder that

536
00:18:37,400 --> 00:18:39,600
is currently in the root of that

537
00:18:39,600 --> 00:18:41,080
container and then what we're going to

538
00:18:41,080 --> 00:18:42,919
do also is we're going to remove that

539
00:18:42,919 --> 00:18:44,960
first container so again we're going to

540
00:18:44,960 --> 00:18:46,440
go Docker

541
00:18:46,440 --> 00:18:50,159
RMF and then the first container should

542
00:18:50,159 --> 00:18:52,240
be this one right here so we went ahead

543
00:18:52,240 --> 00:18:54,120
and removed that so the way to process

544
00:18:54,120 --> 00:18:55,880
data in that container is going to be by

545
00:18:55,880 --> 00:18:58,240
creating a volume and it's pretty simple

546
00:18:58,240 --> 00:18:59,760
to do so the first thing we're going to

547
00:18:59,760 --> 00:19:01,880
do is run this Command right here that

548
00:19:01,880 --> 00:19:03,840
they give us essentially we're going to

549
00:19:03,840 --> 00:19:06,520
be creating a volume called Todo hyphen

550
00:19:06,520 --> 00:19:08,400
DB so let me go ahead and open my

551
00:19:08,400 --> 00:19:10,919
terminal here and what we're going to

552
00:19:10,919 --> 00:19:15,039
see in the volumes tab now is a to do I

553
00:19:15,039 --> 00:19:16,960
DB what we're going to have to do is

554
00:19:16,960 --> 00:19:19,520
remove the container that we created

555
00:19:19,520 --> 00:19:20,919
because it is running without a

556
00:19:20,919 --> 00:19:23,000
persistent volume because we created the

557
00:19:23,000 --> 00:19:25,360
volume after container creation so we're

558
00:19:25,360 --> 00:19:27,159
going to have to create a fresh one so

559
00:19:27,159 --> 00:19:30,039
again let me grab the the container ID

560
00:19:30,039 --> 00:19:33,280
of the getting started container and

561
00:19:33,280 --> 00:19:35,919
same thing Docker RM hyphen f and with

562
00:19:35,919 --> 00:19:37,679
the container ID and that should remove

563
00:19:37,679 --> 00:19:40,880
it for other purposes let me also just

564
00:19:40,880 --> 00:19:43,520
remove this as well cool so we have a

565
00:19:43,520 --> 00:19:45,520
clean slate now we're simply going to

566
00:19:45,520 --> 00:19:47,559
copy this command but there's a couple

567
00:19:47,559 --> 00:19:49,840
things here so along with the run and

568
00:19:49,840 --> 00:19:53,120
run command the dnp flags as well as

569
00:19:53,120 --> 00:19:55,120
mounting this or not mounting this but

570
00:19:55,120 --> 00:19:57,480
binding it to the port 3000 we're also

571
00:19:57,480 --> 00:19:59,159
mounting the volume here here which is

572
00:19:59,159 --> 00:20:01,400
going to be the flag here that we see or

573
00:20:01,400 --> 00:20:02,960
the option and we're specifying the

574
00:20:02,960 --> 00:20:04,799
volume that we want to mount so the type

575
00:20:04,799 --> 00:20:06,880
is going to be volume the source of the

576
00:20:06,880 --> 00:20:08,640
volume is going to be the to-do hyphen

577
00:20:08,640 --> 00:20:11,120
DB volume we just created and the target

578
00:20:11,120 --> 00:20:12,960
is going to be where the actual data

579
00:20:12,960 --> 00:20:15,280
sits inside of the container so that is

580
00:20:15,280 --> 00:20:17,320
the path that we're going to do and then

581
00:20:17,320 --> 00:20:18,679
getting started we're actually just

582
00:20:18,679 --> 00:20:21,000
specifying the image that we we're using

583
00:20:21,000 --> 00:20:23,039
or the container so let me go ahead and

584
00:20:23,039 --> 00:20:25,400
copy this command paste it in and now

585
00:20:25,400 --> 00:20:26,880
you can see that we have another

586
00:20:26,880 --> 00:20:28,679
container with getting started and it

587
00:20:28,679 --> 00:20:31,880
will be utilizing the 2db volume that

588
00:20:31,880 --> 00:20:34,039
we've created so now what we can do

589
00:20:34,039 --> 00:20:35,240
since it's running we're going to go

590
00:20:35,240 --> 00:20:37,280
back here to the to-do app and as you

591
00:20:37,280 --> 00:20:39,640
can see I have some data that was in

592
00:20:39,640 --> 00:20:41,440
there and I didn't add anything you saw

593
00:20:41,440 --> 00:20:43,440
that it was empty and there's two tasks

594
00:20:43,440 --> 00:20:45,520
in here that I added previously about I

595
00:20:45,520 --> 00:20:47,480
mean yesterday and they persisted so now

596
00:20:47,480 --> 00:20:49,679
we're able to tap into the volume and

597
00:20:49,679 --> 00:20:51,919
the data and anything that we do from

598
00:20:51,919 --> 00:20:54,200
here on out let's just say I I don't

599
00:20:54,200 --> 00:20:57,559
know go to the gym we want to add that

600
00:20:57,559 --> 00:20:59,159
if we stop this container container and

601
00:20:59,159 --> 00:21:01,320
then start it again and refresh this we

602
00:21:01,320 --> 00:21:03,159
can see that the data is persisting now

603
00:21:03,159 --> 00:21:05,400
so volume creation is going to be the

604
00:21:05,400 --> 00:21:07,520
way to persist databases especially if

605
00:21:07,520 --> 00:21:09,159
you're testing stuff this is a good way

606
00:21:09,159 --> 00:21:11,440
to do that within Docker and it's easy

607
00:21:11,440 --> 00:21:13,320
to play around with servers and actual

608
00:21:13,320 --> 00:21:15,559
databases now that we have data that

609
00:21:15,559 --> 00:21:17,880
persists instead of having to reload and

610
00:21:17,880 --> 00:21:19,559
add more data over and over and over

611
00:21:19,559 --> 00:21:20,840
again so there's a couple other things

612
00:21:20,840 --> 00:21:22,799
that we can see but if you were to run

613
00:21:22,799 --> 00:21:24,880
Docker volume inspect on the volume

614
00:21:24,880 --> 00:21:26,559
itself you can see a couple things of

615
00:21:26,559 --> 00:21:29,000
metadata here but specifically we get to

616
00:21:29,000 --> 00:21:30,840
see the mount point the name the scope

617
00:21:30,840 --> 00:21:32,799
of it and it's created time so those are

618
00:21:32,799 --> 00:21:34,640
a cool couple things if you want to

619
00:21:34,640 --> 00:21:37,120
persist databases within Docker next

620
00:21:37,120 --> 00:21:38,080
thing we're going to do is we're going

621
00:21:38,080 --> 00:21:39,640
to skip over to part seven I don't

622
00:21:39,640 --> 00:21:40,960
really want to touch into the used bind

623
00:21:40,960 --> 00:21:43,200
mounts right now but multicontainer apps

624
00:21:43,200 --> 00:21:45,480
so as I mentioned we may have a couple

625
00:21:45,480 --> 00:21:46,960
things that we're running and so

626
00:21:46,960 --> 00:21:48,240
multiple containers are going to be

627
00:21:48,240 --> 00:21:50,400
needed in this case we have our to-do

628
00:21:50,400 --> 00:21:52,799
app but we also want to create a my sqil

629
00:21:52,799 --> 00:21:55,200
container that runs in tandem with the

630
00:21:55,200 --> 00:21:57,440
to-do app so that we can isolate our

631
00:21:57,440 --> 00:21:59,360
database and our front an app here in

632
00:21:59,360 --> 00:22:01,120
order for these two containers to talk

633
00:22:01,120 --> 00:22:02,919
we're going to need to create a network

634
00:22:02,919 --> 00:22:04,360
and that's exactly what we're going to

635
00:22:04,360 --> 00:22:06,279
do right now so we're going to run this

636
00:22:06,279 --> 00:22:08,279
command Docker Network create and the

637
00:22:08,279 --> 00:22:10,240
Network's name is going to be to-do app

638
00:22:10,240 --> 00:22:13,200
so let me go ahead and run that right

639
00:22:13,200 --> 00:22:15,080
now it's going to give me an error

640
00:22:15,080 --> 00:22:17,279
because I already created this but go

641
00:22:17,279 --> 00:22:18,799
ahead and run that and it will create a

642
00:22:18,799 --> 00:22:20,600
network there for you so now what we're

643
00:22:20,600 --> 00:22:22,679
doing is we're going to create another

644
00:22:22,679 --> 00:22:24,760
container and then attach it to the

645
00:22:24,760 --> 00:22:26,720
network that we just created and so you

646
00:22:26,720 --> 00:22:28,880
can see that we have a couple Flags here

647
00:22:28,880 --> 00:22:30,159
first ones are going to be the network

648
00:22:30,159 --> 00:22:31,720
so we're tying the network of this

649
00:22:31,720 --> 00:22:33,600
container to the to-do app Network we

650
00:22:33,600 --> 00:22:35,799
created the Alias of this is going to be

651
00:22:35,799 --> 00:22:37,559
my SQL so when we see the container

652
00:22:37,559 --> 00:22:38,720
through the network we're going to know

653
00:22:38,720 --> 00:22:40,600
that this container here is the MySQL

654
00:22:40,600 --> 00:22:42,360
container some of the variables that we

655
00:22:42,360 --> 00:22:44,200
have here are going to be the volume

656
00:22:44,200 --> 00:22:46,279
that we want to create is going to be

657
00:22:46,279 --> 00:22:49,600
the to-do MySQL hyphen data volume so

658
00:22:49,600 --> 00:22:51,279
we're creating a volume there to persist

659
00:22:51,279 --> 00:22:52,880
the actual database and then we have two

660
00:22:52,880 --> 00:22:55,799
environment Flags specific to my SQL

661
00:22:55,799 --> 00:22:57,440
again if you're using something like

662
00:22:57,440 --> 00:22:59,279
maybe say postgress there's going to be

663
00:22:59,279 --> 00:23:00,799
some different environment variables you

664
00:23:00,799 --> 00:23:02,799
need to attach to this container two of

665
00:23:02,799 --> 00:23:05,320
the first ones being in my SQL are going

666
00:23:05,320 --> 00:23:06,760
to be the root password as well as the

667
00:23:06,760 --> 00:23:08,320
database name so we know that our

668
00:23:08,320 --> 00:23:09,679
password Here is secret and then the

669
00:23:09,679 --> 00:23:11,159
name of our database is going to be

670
00:23:11,159 --> 00:23:12,799
to-dos and we're going to be pulling the

671
00:23:12,799 --> 00:23:15,520
MySQL version 8 Docker image so what

672
00:23:15,520 --> 00:23:18,240
we're going to do is copy this over and

673
00:23:18,240 --> 00:23:19,760
we're going to go into our terminal and

674
00:23:19,760 --> 00:23:22,159
create that and now we can see we have a

675
00:23:22,159 --> 00:23:24,000
MySQL image again I've downloaded

676
00:23:24,000 --> 00:23:25,840
locally already and the container is now

677
00:23:25,840 --> 00:23:27,360
running to confirm that we have the

678
00:23:27,360 --> 00:23:28,760
database running we're going to this

679
00:23:28,760 --> 00:23:31,600
command here so we're exing hyphen it

680
00:23:31,600 --> 00:23:33,880
and the container ID will go right after

681
00:23:33,880 --> 00:23:35,880
that then it will spit out the my SQL

682
00:23:35,880 --> 00:23:38,080
command enter in the user which is root

683
00:23:38,080 --> 00:23:40,360
and then ask us for the password so let

684
00:23:40,360 --> 00:23:42,320
me go ahead and copy this really quick

685
00:23:42,320 --> 00:23:45,080
in here and copy the container ID that

686
00:23:45,080 --> 00:23:47,000
it gave us and now replace the

687
00:23:47,000 --> 00:23:49,240
placeholder enter It'll ask us for the

688
00:23:49,240 --> 00:23:51,240
password and as we saw before it was

689
00:23:51,240 --> 00:23:53,480
secret so let me enter that in and now

690
00:23:53,480 --> 00:23:56,320
we are inside of our mySQL database the

691
00:23:56,320 --> 00:23:58,640
next thing it asks us to do is type in

692
00:23:58,640 --> 00:24:01,400
show databases to confirm that our

693
00:24:01,400 --> 00:24:03,480
databases was created and we see the

694
00:24:03,480 --> 00:24:07,159
to-dos database is here so our commands

695
00:24:07,159 --> 00:24:09,520
ran successfully now we can say exit and

696
00:24:09,520 --> 00:24:11,240
now we have a to-dos database we're

697
00:24:11,240 --> 00:24:13,240
going to skip this part because it's not

698
00:24:13,240 --> 00:24:15,400
really necessary but if you want to

699
00:24:15,400 --> 00:24:18,080
follow it it simply just spins up a DNS

700
00:24:18,080 --> 00:24:20,640
tool that will allow you to see the IP

701
00:24:20,640 --> 00:24:23,320
address of the container and show you

702
00:24:23,320 --> 00:24:25,360
that each container has its own IP

703
00:24:25,360 --> 00:24:27,559
address so this networking step really

704
00:24:27,559 --> 00:24:29,600
is crucial for these two containers to

705
00:24:29,600 --> 00:24:30,880
talk to each other so what I'm going to

706
00:24:30,880 --> 00:24:32,520
do here is I'm actually going to first

707
00:24:32,520 --> 00:24:34,880
remove the container of the getting

708
00:24:34,880 --> 00:24:36,840
started app that we created first

709
00:24:36,840 --> 00:24:38,320
because it's not tied to this network

710
00:24:38,320 --> 00:24:40,320
yet so let me go ahead and remove it

711
00:24:40,320 --> 00:24:41,559
first and then we're going to create

712
00:24:41,559 --> 00:24:43,640
another one using this command here and

713
00:24:43,640 --> 00:24:45,600
as you can see we're doing the same run

714
00:24:45,600 --> 00:24:47,120
command here but with a couple other

715
00:24:47,120 --> 00:24:49,080
flags so there's just you know we're

716
00:24:49,080 --> 00:24:50,480
tying it to the network here there's a

717
00:24:50,480 --> 00:24:52,080
couple other environments like hooking

718
00:24:52,080 --> 00:24:53,760
it up to the mySQL database so that

719
00:24:53,760 --> 00:24:55,840
we're actually able to push data to the

720
00:24:55,840 --> 00:24:57,360
database same thing with the node

721
00:24:57,360 --> 00:24:59,919
versions and then initializing the

722
00:24:59,919 --> 00:25:01,600
application with yarn install and and

723
00:25:01,600 --> 00:25:04,000
run Dev so let me go ahead and copy and

724
00:25:04,000 --> 00:25:06,159
paste this over and there we go we

725
00:25:06,159 --> 00:25:08,200
should have another container built with

726
00:25:08,200 --> 00:25:10,919
the note 18 Alpine image instead now if

727
00:25:10,919 --> 00:25:12,880
we want to connect to the mySQL database

728
00:25:12,880 --> 00:25:15,360
let's go ahead and do that here so we're

729
00:25:15,360 --> 00:25:18,200
going to copy this command again copy

730
00:25:18,200 --> 00:25:19,760
and paste this and then we need to get

731
00:25:19,760 --> 00:25:21,919
into the mySQL database so let me copy

732
00:25:21,919 --> 00:25:25,399
and paste that

733
00:25:28,960 --> 00:25:31,320
enter the password here and it is secret

734
00:25:31,320 --> 00:25:33,360
so now that we're in so we're going to

735
00:25:33,360 --> 00:25:36,279
do the select function here and we're

736
00:25:36,279 --> 00:25:41,159
going to select all from to doore items

737
00:25:41,159 --> 00:25:43,440
and we can see that the three items that

738
00:25:43,440 --> 00:25:46,120
we created inside of the application are

739
00:25:46,120 --> 00:25:48,000
now here inside of the database so we're

740
00:25:48,000 --> 00:25:49,919
confirming that the data that we created

741
00:25:49,919 --> 00:25:52,279
in the volume is now inside of our my

742
00:25:52,279 --> 00:25:54,399
SQL database and that right there is the

743
00:25:54,399 --> 00:25:56,200
power of networking earlier in this

744
00:25:56,200 --> 00:25:58,760
module I also mentioned Docker composed

745
00:25:58,760 --> 00:26:00,960
and it makes this whole process that we

746
00:26:00,960 --> 00:26:03,399
just did with this application 10 times

747
00:26:03,399 --> 00:26:05,360
easier again as I mentioned before also

748
00:26:05,360 --> 00:26:06,880
is that Docker compose is a tool that

749
00:26:06,880 --> 00:26:08,640
helps you to find and share multiple

750
00:26:08,640 --> 00:26:11,080
container applications and so we're

751
00:26:11,080 --> 00:26:12,440
going to be doing that right now this

752
00:26:12,440 --> 00:26:13,960
right here was the old command that we

753
00:26:13,960 --> 00:26:16,000
had to run inside of our terminal to get

754
00:26:16,000 --> 00:26:18,880
everything running for the MySQL and to

755
00:26:18,880 --> 00:26:21,240
do app but we can simply do that all of

756
00:26:21,240 --> 00:26:23,480
this in one Docker file and the docker

757
00:26:23,480 --> 00:26:25,880
file now changes to a Docker composed.

758
00:26:25,880 --> 00:26:28,000
yl file or you can shorten it to compose

759
00:26:28,000 --> 00:26:29,799
y so we're going to head back into our

760
00:26:29,799 --> 00:26:31,880
terminal here and inside of the rout

761
00:26:31,880 --> 00:26:34,480
where we initially put our Docker file

762
00:26:34,480 --> 00:26:36,120
we're going to create a new file and

763
00:26:36,120 --> 00:26:39,440
call it compose do yaml and what Docker

764
00:26:39,440 --> 00:26:40,919
has provided us with were a couple

765
00:26:40,919 --> 00:26:42,120
things so we're going to go ahead and

766
00:26:42,120 --> 00:26:43,960
copy and paste this now make sure it

767
00:26:43,960 --> 00:26:45,760
added to space here but it will air out

768
00:26:45,760 --> 00:26:47,640
if it has an empty space so cover that

769
00:26:47,640 --> 00:26:50,200
space again yaml is very strict with

770
00:26:50,200 --> 00:26:52,360
spacing and indentation so keep that in

771
00:26:52,360 --> 00:26:53,600
mind but the first thing here we're

772
00:26:53,600 --> 00:26:57,039
going to do is specify Services of our

773
00:26:57,039 --> 00:26:58,559
compose file the first one is is going

774
00:26:58,559 --> 00:27:00,360
to be our app which is going to contain

775
00:27:00,360 --> 00:27:03,080
the image of the node version 18 so

776
00:27:03,080 --> 00:27:04,440
we're going to run node in this

777
00:27:04,440 --> 00:27:06,080
container next thing we're going to do

778
00:27:06,080 --> 00:27:08,360
is add the command so the command we

779
00:27:08,360 --> 00:27:09,720
want to run is going to be the yarn

780
00:27:09,720 --> 00:27:12,240
install and and run the dev environment

781
00:27:12,240 --> 00:27:13,679
there so we're going to add that here

782
00:27:13,679 --> 00:27:15,039
next thing is we're going to open up the

783
00:27:15,039 --> 00:27:17,039
ports and it's going to be the same port

784
00:27:17,039 --> 00:27:20,960
the 127 on Port 3000 so now we're moving

785
00:27:20,960 --> 00:27:23,279
the working directory to the volume

786
00:27:23,279 --> 00:27:25,240
mapping uh and by doing that we're going

787
00:27:25,240 --> 00:27:26,919
to add the working directory and then

788
00:27:26,919 --> 00:27:29,279
the volumes so let me go ahead and add

789
00:27:29,279 --> 00:27:30,919
that as well and then finally we're

790
00:27:30,919 --> 00:27:33,000
going to add the environments so these

791
00:27:33,000 --> 00:27:34,679
environment variables are all going to

792
00:27:34,679 --> 00:27:37,799
be the MySQL environment variables so

793
00:27:37,799 --> 00:27:40,519
that we can access the database through

794
00:27:40,519 --> 00:27:42,200
the application itself when we add a

795
00:27:42,200 --> 00:27:44,760
need todos so again the host the user

796
00:27:44,760 --> 00:27:46,720
password database name these are all

797
00:27:46,720 --> 00:27:48,640
there and are going to specified for

798
00:27:48,640 --> 00:27:51,080
this app container now we're going to do

799
00:27:51,080 --> 00:27:54,080
the same but for my SQL so we saw the

800
00:27:54,080 --> 00:27:56,919
app container but now if we back up a

801
00:27:56,919 --> 00:27:59,039
couple spaces we're going to add the

802
00:27:59,039 --> 00:28:00,559
MySQL container so you can see that

803
00:28:00,559 --> 00:28:02,320
these two are on the same line one being

804
00:28:02,320 --> 00:28:04,720
app with all of its information here and

805
00:28:04,720 --> 00:28:06,760
then MySQL will contain the same but now

806
00:28:06,760 --> 00:28:09,200
we're pulling the MySQL version 8 image

807
00:28:09,200 --> 00:28:11,679
the volumes that we want to use for this

808
00:28:11,679 --> 00:28:14,399
container is going to be the to-do MySQL

809
00:28:14,399 --> 00:28:16,679
data so let me go ahead and add that and

810
00:28:16,679 --> 00:28:18,640
then the overall volumes here are going

811
00:28:18,640 --> 00:28:21,919
to be outside of that and then finally

812
00:28:21,919 --> 00:28:24,039
what we need to do is we're going to add

813
00:28:24,039 --> 00:28:25,799
the environment variables for the

814
00:28:25,799 --> 00:28:28,760
specific container so we can access

815
00:28:28,760 --> 00:28:31,200
now everything in your composed. file

816
00:28:31,200 --> 00:28:33,000
should look like this again the top

817
00:28:33,000 --> 00:28:35,120
level is identifying what services that

818
00:28:35,120 --> 00:28:37,799
we want this file to create the first

819
00:28:37,799 --> 00:28:39,919
one being our app container using the

820
00:28:39,919 --> 00:28:42,080
node 18 image this is the command we

821
00:28:42,080 --> 00:28:43,919
want to run this is the port that we

822
00:28:43,919 --> 00:28:46,559
want to expose and use to access this

823
00:28:46,559 --> 00:28:48,279
application our working directory is

824
00:28:48,279 --> 00:28:49,760
going to be this root directory that

825
00:28:49,760 --> 00:28:51,519
contains everything here the volumes

826
00:28:51,519 --> 00:28:53,200
we're mapping is going to use the app

827
00:28:53,200 --> 00:28:54,799
this is the environment variables we use

828
00:28:54,799 --> 00:28:57,600
to connect to our MySQL container that

829
00:28:57,600 --> 00:28:59,960
also contains its own information and so

830
00:28:59,960 --> 00:29:02,279
now it's much easier with Docker compose

831
00:29:02,279 --> 00:29:04,039
to run this application now that we have

832
00:29:04,039 --> 00:29:06,559
our composed. yl file I can open up my

833
00:29:06,559 --> 00:29:09,720
terminal here let me exit my SQL clear

834
00:29:09,720 --> 00:29:12,080
this now all I have to do is run Docker

835
00:29:12,080 --> 00:29:15,159
compose up and I can add The Hyphen D

836
00:29:15,159 --> 00:29:17,120
flag to make sure that this runs in the

837
00:29:17,120 --> 00:29:19,240
background and what that's did just now

838
00:29:19,240 --> 00:29:22,000
was literally spit out two containers

839
00:29:22,000 --> 00:29:24,120
one it looks like it failed because I

840
00:29:24,120 --> 00:29:26,480
have a container running already that

841
00:29:26,480 --> 00:29:30,039
has 3,000 so let me go ahead and just

842
00:29:30,039 --> 00:29:33,159
delete this and delete this from the

843
00:29:33,159 --> 00:29:34,600
docker desktop app so we can have a

844
00:29:34,600 --> 00:29:36,240
clean slate and let me run the same

845
00:29:36,240 --> 00:29:38,480
thing and there we go now it's spit out

846
00:29:38,480 --> 00:29:39,880
the getting started app and it contains

847
00:29:39,880 --> 00:29:42,000
our app and my SQL container both of

848
00:29:42,000 --> 00:29:43,720
them running and we have opened on Port

849
00:29:43,720 --> 00:29:47,240
3000 and if I head over into our Local

850
00:29:47,240 --> 00:29:49,240
Host Port 3000 I'm refreshing and you

851
00:29:49,240 --> 00:29:51,600
can see it's all fresh so we are no

852
00:29:51,600 --> 00:29:53,600
we're using a different volume here but

853
00:29:53,600 --> 00:29:55,440
the application is now running

854
00:29:55,440 --> 00:29:57,679
successfully it is attached to our mySQL

855
00:29:57,679 --> 00:29:59,960
database and we can continue and now add

856
00:29:59,960 --> 00:30:02,519
data here that will persist because we

857
00:30:02,519 --> 00:30:06,080
have tied a volume here to both of these

858
00:30:06,080 --> 00:30:07,679
containers now if we wanted to tear it

859
00:30:07,679 --> 00:30:09,320
down all we would have to do is Docker

860
00:30:09,320 --> 00:30:12,679
compose down and that will shut down and

861
00:30:12,679 --> 00:30:14,440
stop our containers from running and

862
00:30:14,440 --> 00:30:16,640
that right there is a simple rundown of

863
00:30:16,640 --> 00:30:18,480
how you can create images and a

864
00:30:18,480 --> 00:30:20,919
container through Docker using Docker

865
00:30:20,919 --> 00:30:23,720
files or a composed. yl file and then

866
00:30:23,720 --> 00:30:25,679
accessing those containers to do certain

867
00:30:25,679 --> 00:30:28,600
things we ran a application in the form

868
00:30:28,600 --> 00:30:30,799
of a to-do app and we also created a

869
00:30:30,799 --> 00:30:33,039
mySQL database pretty quickly here in

870
00:30:33,039 --> 00:30:34,960
their own environments and that way we

871
00:30:34,960 --> 00:30:36,320
have co-workers that are working on the

872
00:30:36,320 --> 00:30:37,919
same thing they can run the same image

873
00:30:37,919 --> 00:30:39,519
that we're on using the same environment

874
00:30:39,519 --> 00:30:42,320
variables using the same dependencies

875
00:30:42,320 --> 00:30:44,799
and essentially be able to recreate any

876
00:30:44,799 --> 00:30:46,399
problems or just have the same

877
00:30:46,399 --> 00:30:48,480
environment that we're running on every

878
00:30:48,480 --> 00:30:50,279
single time and that is the power of

879
00:30:50,279 --> 00:30:52,080
containerization through Docker we're

880
00:30:52,080 --> 00:30:53,760
going to be using a lot of these skills

881
00:30:53,760 --> 00:30:55,880
in the coming lessons so hopefully that

882
00:30:55,880 --> 00:30:58,279
helps but now let's move on to the SQL

883
00:30:58,279 --> 00:31:00,960
module where we're going to be using SQL

884
00:31:00,960 --> 00:31:02,399
but we're also going to start our own

885
00:31:02,399 --> 00:31:04,559
little database inside Docker as well so

886
00:31:04,559 --> 00:31:06,360
let's get to it so now that we have

887
00:31:06,360 --> 00:31:07,840
Docker set up and we know the basics

888
00:31:07,840 --> 00:31:10,320
we're going to move it on to SQL or SQL

889
00:31:10,320 --> 00:31:12,360
however else you want to call it but SQL

890
00:31:12,360 --> 00:31:14,360
stands for structured query language

891
00:31:14,360 --> 00:31:15,760
it's a standard language used for

892
00:31:15,760 --> 00:31:17,840
database creation and manipulation

893
00:31:17,840 --> 00:31:20,919
databases like MySQL or postgress use

894
00:31:20,919 --> 00:31:23,279
SQL for you to query any of the data

895
00:31:23,279 --> 00:31:25,159
within their own tables so let's go

896
00:31:25,159 --> 00:31:26,480
ahead and start our playground we're

897
00:31:26,480 --> 00:31:28,080
going to set up a database using

898
00:31:28,080 --> 00:31:30,440
postgress within a Docker container and

899
00:31:30,440 --> 00:31:32,440
then we can create our own tables with

900
00:31:32,440 --> 00:31:34,440
fake data to play around with and we'll

901
00:31:34,440 --> 00:31:36,320
use them later on in the course as well

902
00:31:36,320 --> 00:31:37,639
all right so first things first is I

903
00:31:37,639 --> 00:31:40,000
have a terminal open and I've created a

904
00:31:40,000 --> 00:31:43,080
data engineering database directory

905
00:31:43,080 --> 00:31:44,799
because we're using Docker we do not

906
00:31:44,799 --> 00:31:46,519
have to install postgress locally what

907
00:31:46,519 --> 00:31:49,679
we can do is run the command Docker pull

908
00:31:49,679 --> 00:31:51,880
postgress and what that's going to do is

909
00:31:51,880 --> 00:31:54,760
look up the image of postgress on the

910
00:31:54,760 --> 00:31:57,519
docker Hub pull the latest version of

911
00:31:57,519 --> 00:32:00,159
that down and now we can actually create

912
00:32:00,159 --> 00:32:02,519
a container that's running the postest

913
00:32:02,519 --> 00:32:04,440
image so now we got to start our postest

914
00:32:04,440 --> 00:32:05,760
container now that we have the image so

915
00:32:05,760 --> 00:32:08,120
I'm going to say Docker run the name of

916
00:32:08,120 --> 00:32:11,000
this container is going to be data

917
00:32:11,000 --> 00:32:13,760
engineering postgress uh the environment

918
00:32:13,760 --> 00:32:15,559
variables that we that I want are going

919
00:32:15,559 --> 00:32:17,440
to be related to postgress which is

920
00:32:17,440 --> 00:32:19,159
going to be

921
00:32:19,159 --> 00:32:22,360
postgress password and what that's going

922
00:32:22,360 --> 00:32:24,200
to be is just going to be

923
00:32:24,200 --> 00:32:27,279
secret and then I'm going to do the D

924
00:32:27,279 --> 00:32:29,639
flag and we're going to say we're going

925
00:32:29,639 --> 00:32:32,679
to use the postgress image go ahead and

926
00:32:32,679 --> 00:32:35,639
run that now I have my container now

927
00:32:35,639 --> 00:32:37,320
what I want to do is I want to create a

928
00:32:37,320 --> 00:32:40,159
new database inside of postgress so I'm

929
00:32:40,159 --> 00:32:44,799
going to say Docker exec hyph U for the

930
00:32:44,799 --> 00:32:48,360
user which is just postgress as default

931
00:32:48,360 --> 00:32:50,279
the name of the container which is just

932
00:32:50,279 --> 00:32:53,039
data engineering of

933
00:32:53,039 --> 00:32:58,519
postgress going say create DB

934
00:32:58,519 --> 00:33:01,440
and the name of the database is going to

935
00:33:01,440 --> 00:33:04,440
be

936
00:33:04,519 --> 00:33:06,760
postgress

937
00:33:06,760 --> 00:33:08,880
DV now that we've run that we've created

938
00:33:08,880 --> 00:33:10,639
a sample database inside now let's go

939
00:33:10,639 --> 00:33:12,639
ahead and connect to it so I'm going to

940
00:33:12,639 --> 00:33:14,399
say Docker

941
00:33:14,399 --> 00:33:16,120
exec

942
00:33:16,120 --> 00:33:18,960
slit data

943
00:33:18,960 --> 00:33:21,039
engineering

944
00:33:21,039 --> 00:33:23,240
postgress

945
00:33:23,240 --> 00:33:27,360
psql hyphen U for the user on postgress

946
00:33:27,360 --> 00:33:29,039
and the name of the database which is

947
00:33:29,039 --> 00:33:31,320
going to be

948
00:33:31,320 --> 00:33:34,159
postgress now we are inside as you can

949
00:33:34,159 --> 00:33:37,039
see of the postgress database if I do

950
00:33:37,039 --> 00:33:39,799
/dt no current tables as of right now so

951
00:33:39,799 --> 00:33:41,200
that's exactly what we're going to do

952
00:33:41,200 --> 00:33:43,039
we're going to create our first table I

953
00:33:43,039 --> 00:33:45,159
have these commands already written out

954
00:33:45,159 --> 00:33:47,519
so I don't waste as much time so the

955
00:33:47,519 --> 00:33:50,039
first thing I'm going to do just for an

956
00:33:50,039 --> 00:33:52,440
example is create a table called users

957
00:33:52,440 --> 00:33:54,639
so inside this command you see a couple

958
00:33:54,639 --> 00:33:57,159
things so we have an ID of the type

959
00:33:57,159 --> 00:33:59,240
serial which is also our primary key

960
00:33:59,240 --> 00:34:01,720
here as an identifier we have a first

961
00:34:01,720 --> 00:34:04,600
name which is at most 50 characters we

962
00:34:04,600 --> 00:34:06,320
have a last name which is the same thing

963
00:34:06,320 --> 00:34:09,679
we have an email that is also characters

964
00:34:09,679 --> 00:34:12,280
but we want it to at least be 100 and

965
00:34:12,280 --> 00:34:13,839
then we have a date of birth which is

966
00:34:13,839 --> 00:34:15,159
just in the type of date so we're going

967
00:34:15,159 --> 00:34:17,440
to hit enter it's going to show us that

968
00:34:17,440 --> 00:34:20,480
we have a table so now if I do /dt we

969
00:34:20,480 --> 00:34:22,760
can see that the users table is now

970
00:34:22,760 --> 00:34:24,639
created and populated inside of this

971
00:34:24,639 --> 00:34:26,720
database I'm going to go ahead and copy

972
00:34:26,720 --> 00:34:28,800
in some fake data as well and don't

973
00:34:28,800 --> 00:34:30,159
worry this will all be in the

974
00:34:30,159 --> 00:34:32,320
description below so that way you can

975
00:34:32,320 --> 00:34:34,159
copy and paste this in as you follow

976
00:34:34,159 --> 00:34:35,520
along so I'm going to and copy and paste

977
00:34:35,520 --> 00:34:38,079
this and this is simply just user so it

978
00:34:38,079 --> 00:34:40,399
contains a first name a last name an

979
00:34:40,399 --> 00:34:43,200
email and date of birth so let me go

980
00:34:43,200 --> 00:34:44,839
ahead and enter and you can see it

981
00:34:44,839 --> 00:34:46,919
entered in 14 records so now this brings

982
00:34:46,919 --> 00:34:48,800
us into the First Command we're going to

983
00:34:48,800 --> 00:34:49,919
learn so the First Command we're going

984
00:34:49,919 --> 00:34:51,839
to want to learn is the select command

985
00:34:51,839 --> 00:34:53,839
and it's pretty self-explanatory as you

986
00:34:53,839 --> 00:34:55,919
saw already we entered in 14 rows of

987
00:34:55,919 --> 00:34:59,400
data and if I wanted to select anything

988
00:34:59,400 --> 00:35:01,720
from that table I'm going to need to use

989
00:35:01,720 --> 00:35:05,599
the select command so I'm going to say

990
00:35:05,599 --> 00:35:08,160
select and I'm going to add this

991
00:35:08,160 --> 00:35:10,359
asterisk what the asterisk typically

992
00:35:10,359 --> 00:35:12,800
means is a wild card pretty much meaning

993
00:35:12,800 --> 00:35:14,560
you want all of the columns within a

994
00:35:14,560 --> 00:35:16,640
table so you can read this query as

995
00:35:16,640 --> 00:35:19,839
select all now I'm going to add from and

996
00:35:19,839 --> 00:35:21,160
then the last part of this is going to

997
00:35:21,160 --> 00:35:23,119
be the table name so I'm going to say

998
00:35:23,119 --> 00:35:25,560
users and do not forget this is very

999
00:35:25,560 --> 00:35:27,720
important that every query needs to end

1000
00:35:27,720 --> 00:35:30,200
in a semicolon otherwise the query won't

1001
00:35:30,200 --> 00:35:32,119
go through so make sure you always add a

1002
00:35:32,119 --> 00:35:34,280
semicolon at the end of every query so

1003
00:35:34,280 --> 00:35:35,320
once I hit enter you're going to see

1004
00:35:35,320 --> 00:35:38,480
that I get back a formatted view of the

1005
00:35:38,480 --> 00:35:40,320
table that I just queried we saw before

1006
00:35:40,320 --> 00:35:42,440
that we entered in 14 rows of data and I

1007
00:35:42,440 --> 00:35:45,280
see that I get exactly 14 rows back all

1008
00:35:45,280 --> 00:35:47,560
having the ID first name last name email

1009
00:35:47,560 --> 00:35:50,800
and date of birth formatted in a much

1010
00:35:50,800 --> 00:35:52,640
more pleasing way than what we see up

1011
00:35:52,640 --> 00:35:54,160
here the select query is going to be a

1012
00:35:54,160 --> 00:35:56,880
frequently used command by everybody who

1013
00:35:56,880 --> 00:35:59,760
uses SQL so make sure you know it and

1014
00:35:59,760 --> 00:36:01,280
understand it but again very

1015
00:36:01,280 --> 00:36:03,040
straightforward another command that

1016
00:36:03,040 --> 00:36:04,920
gets used in conjunction with select is

1017
00:36:04,920 --> 00:36:06,760
also going to be distinct we use

1018
00:36:06,760 --> 00:36:08,640
distinct in conjunction with select if

1019
00:36:08,640 --> 00:36:11,119
we want a specified value within a very

1020
00:36:11,119 --> 00:36:13,119
particular column so let's say we want

1021
00:36:13,119 --> 00:36:15,480
every single email within the users's

1022
00:36:15,480 --> 00:36:17,200
table what we'll say is we're going to

1023
00:36:17,200 --> 00:36:20,920
say select

1024
00:36:21,280 --> 00:36:24,920
distinct email

1025
00:36:24,920 --> 00:36:27,280
from and then we're going to say users

1026
00:36:27,280 --> 00:36:29,640
table so again we're reading this back

1027
00:36:29,640 --> 00:36:31,160
if you haven't noticed already you

1028
00:36:31,160 --> 00:36:33,400
typically all the SQL commands are going

1029
00:36:33,400 --> 00:36:35,960
to be in all caps keep in mind you do

1030
00:36:35,960 --> 00:36:38,839
not need this but it is much easier and

1031
00:36:38,839 --> 00:36:41,240
it is probably best practice to

1032
00:36:41,240 --> 00:36:43,960
capitalize every command that is SQL and

1033
00:36:43,960 --> 00:36:45,400
lowercase everything that is either a

1034
00:36:45,400 --> 00:36:47,040
table or some type of value that you

1035
00:36:47,040 --> 00:36:48,319
need but if we're reading this back we

1036
00:36:48,319 --> 00:36:50,400
want to select distinct emails from the

1037
00:36:50,400 --> 00:36:52,280
user's table so again it reads just like

1038
00:36:52,280 --> 00:36:55,040
English we add the semicolon if we hit

1039
00:36:55,040 --> 00:36:57,119
enter it's going to give us just the

1040
00:36:57,119 --> 00:37:00,400
emails in every single distinct email

1041
00:37:00,400 --> 00:37:02,440
now keep in mind this is not in order

1042
00:37:02,440 --> 00:37:04,359
but we do get 14 rows of data back we

1043
00:37:04,359 --> 00:37:06,160
can see that the query was successful so

1044
00:37:06,160 --> 00:37:07,640
that's how you can select data from the

1045
00:37:07,640 --> 00:37:09,880
whole table to get a better view or

1046
00:37:09,880 --> 00:37:11,480
select distinct values within a

1047
00:37:11,480 --> 00:37:13,640
particular column but let's move on to

1048
00:37:13,640 --> 00:37:15,400
other commands so now that we have our

1049
00:37:15,400 --> 00:37:17,720
users table that has data that exists in

1050
00:37:17,720 --> 00:37:19,880
there what if we wanted to update some

1051
00:37:19,880 --> 00:37:22,359
information say an email if a user

1052
00:37:22,359 --> 00:37:24,359
changed their email or a date of birth

1053
00:37:24,359 --> 00:37:26,040
if they entered it wrong this is where

1054
00:37:26,040 --> 00:37:27,680
the update command comes in handy so

1055
00:37:27,680 --> 00:37:29,240
let's say for example if we go back up

1056
00:37:29,240 --> 00:37:32,119
to our table that we wanted to change

1057
00:37:32,119 --> 00:37:34,560
John's email so what we're going to do

1058
00:37:34,560 --> 00:37:36,640
is we're going to say update so the

1059
00:37:36,640 --> 00:37:38,400
query starts with update now after

1060
00:37:38,400 --> 00:37:39,880
update we're going to enter the table

1061
00:37:39,880 --> 00:37:42,040
name so we're going to say users and

1062
00:37:42,040 --> 00:37:43,480
then we're going to say set so now we

1063
00:37:43,480 --> 00:37:46,359
want to address what column and value we

1064
00:37:46,359 --> 00:37:48,480
want to change in the users table so

1065
00:37:48,480 --> 00:37:50,920
we're going to say email and then that's

1066
00:37:50,920 --> 00:37:52,839
going to equal whatever our value is

1067
00:37:52,839 --> 00:37:54,880
going to be inside of single quotes so

1068
00:37:54,880 --> 00:37:57,800
for example we can just say you know new

1069
00:37:57,800 --> 00:38:00,800
uncore mail@gmail.com

1070
00:38:00,800 --> 00:38:03,119
the problem with this query is if we

1071
00:38:03,119 --> 00:38:05,240
were to hit enter on this it would

1072
00:38:05,240 --> 00:38:08,440
change the emails for every single row

1073
00:38:08,440 --> 00:38:10,599
inside of the user's table which isn't

1074
00:38:10,599 --> 00:38:12,520
exactly what we want and if you were

1075
00:38:12,520 --> 00:38:14,760
doing this in a production database it

1076
00:38:14,760 --> 00:38:17,200
would probably go Haywire so how can we

1077
00:38:17,200 --> 00:38:19,520
modify this query for it to actually

1078
00:38:19,520 --> 00:38:22,319
only update one person's email inside

1079
00:38:22,319 --> 00:38:24,760
the table what we can do is introduce

1080
00:38:24,760 --> 00:38:27,040
the wear command so after we set the

1081
00:38:27,040 --> 00:38:28,960
email to the new value we're going to

1082
00:38:28,960 --> 00:38:31,280
say where and then we're going to say

1083
00:38:31,280 --> 00:38:33,599
first uncore

1084
00:38:33,599 --> 00:38:36,640
name so now we're saying where the first

1085
00:38:36,640 --> 00:38:39,040
name so we're selecting a particular

1086
00:38:39,040 --> 00:38:41,920
first name is equals to and the first

1087
00:38:41,920 --> 00:38:44,440
name in this case is going to be John

1088
00:38:44,440 --> 00:38:45,680
and we're going to hit a semicolon so

1089
00:38:45,680 --> 00:38:47,119
again we're going to backtrack here

1090
00:38:47,119 --> 00:38:48,960
we're going to update the users table

1091
00:38:48,960 --> 00:38:51,119
we're going to set the email so we're

1092
00:38:51,119 --> 00:38:54,599
selecting the column email to newor

1093
00:38:54,599 --> 00:38:55,960
mail@gmail.com

1094
00:38:55,960 --> 00:38:59,920
where are the first name is equals to JN

1095
00:38:59,920 --> 00:39:01,359
so that means that we're going to look

1096
00:39:01,359 --> 00:39:04,280
for JN inside of the first name column

1097
00:39:04,280 --> 00:39:06,160
once we find JN we're going to go to his

1098
00:39:06,160 --> 00:39:09,119
email and change the email over to the

1099
00:39:09,119 --> 00:39:12,359
new value so if I hit enter we can see

1100
00:39:12,359 --> 00:39:14,400
that we have one updated change now if I

1101
00:39:14,400 --> 00:39:17,520
say select go back to the cap select all

1102
00:39:17,520 --> 00:39:21,560
from users table we're going to see that

1103
00:39:21,560 --> 00:39:23,079
John's actually changed so he gets moved

1104
00:39:23,079 --> 00:39:25,200
down he still has an ID of one but his

1105
00:39:25,200 --> 00:39:28,240
email is now newor Emil mail.com so

1106
00:39:28,240 --> 00:39:30,040
again if we're using the update command

1107
00:39:30,040 --> 00:39:33,079
it's very helpful if anything changes in

1108
00:39:33,079 --> 00:39:35,640
terms of data and we need to update

1109
00:39:35,640 --> 00:39:37,200
something that's where we' use the

1110
00:39:37,200 --> 00:39:39,280
update command now let's say you wanted

1111
00:39:39,280 --> 00:39:42,079
to enter in new data into a table well

1112
00:39:42,079 --> 00:39:43,960
that's where the insert command comes in

1113
00:39:43,960 --> 00:39:45,119
if you're starting to see the pattern

1114
00:39:45,119 --> 00:39:46,400
here SQL commands are very

1115
00:39:46,400 --> 00:39:48,160
self-explanatory and the fact that they

1116
00:39:48,160 --> 00:39:50,480
read English and kind of like python so

1117
00:39:50,480 --> 00:39:52,200
if you want to insert new values you

1118
00:39:52,200 --> 00:39:53,640
would reach for the insert command so

1119
00:39:53,640 --> 00:39:55,040
we're going to create a new table called

1120
00:39:55,040 --> 00:39:57,400
the films table add some films and then

1121
00:39:57,400 --> 00:39:59,440
then show the insert command but go more

1122
00:39:59,440 --> 00:40:01,040
in depth into it all right so we are

1123
00:40:01,040 --> 00:40:02,839
back in our database and I have the

1124
00:40:02,839 --> 00:40:04,560
command here already I'm going to create

1125
00:40:04,560 --> 00:40:07,040
the table of films again so create table

1126
00:40:07,040 --> 00:40:08,359
is also a command that we didn't get

1127
00:40:08,359 --> 00:40:10,079
really into but again self-explanatory

1128
00:40:10,079 --> 00:40:11,520
we're just creating a table here called

1129
00:40:11,520 --> 00:40:14,040
films within the parentheses we're going

1130
00:40:14,040 --> 00:40:16,680
to see the film ID with a type we have a

1131
00:40:16,680 --> 00:40:18,800
title a release date a price which is

1132
00:40:18,800 --> 00:40:20,760
new that we're seeing a decimal type we

1133
00:40:20,760 --> 00:40:22,960
have a rating and then a user rating the

1134
00:40:22,960 --> 00:40:24,520
one thing to note within the user rating

1135
00:40:24,520 --> 00:40:25,599
is that we're checking to see if the

1136
00:40:25,599 --> 00:40:27,359
number value that goes into user rating

1137
00:40:27,359 --> 00:40:30,520
rating is greater than or equals to 1

1138
00:40:30,520 --> 00:40:32,920
and that the user rating is less than or

1139
00:40:32,920 --> 00:40:35,680
equals to 5 so obviously we want to go

1140
00:40:35,680 --> 00:40:38,119
between 1 and 5 here so if I hit enter

1141
00:40:38,119 --> 00:40:40,760
we're going to see that if I do /dt

1142
00:40:40,760 --> 00:40:43,760
which is like LS in a normal bash

1143
00:40:43,760 --> 00:40:45,560
terminal is kind of like listing every

1144
00:40:45,560 --> 00:40:47,440
table inside of a database we see that

1145
00:40:47,440 --> 00:40:49,880
the films table is now created so let me

1146
00:40:49,880 --> 00:40:52,599
go ahead and copy my insert command here

1147
00:40:52,599 --> 00:40:55,760
and we see that we have insert into so

1148
00:40:55,760 --> 00:40:57,720
again self-explanatory want to insert

1149
00:40:57,720 --> 00:41:00,640
values into the films table within the

1150
00:41:00,640 --> 00:41:02,359
first set of parentheses we see the

1151
00:41:02,359 --> 00:41:04,640
names of the columns that we want to add

1152
00:41:04,640 --> 00:41:07,480
and again those are fitting and matching

1153
00:41:07,480 --> 00:41:10,000
exactly what we have on this side right

1154
00:41:10,000 --> 00:41:12,119
here when we created the table after the

1155
00:41:12,119 --> 00:41:14,480
first set of parentheses we have a

1156
00:41:14,480 --> 00:41:17,599
values command and after that everything

1157
00:41:17,599 --> 00:41:19,760
inside of the parentheses are values

1158
00:41:19,760 --> 00:41:23,480
that have to match the order in which

1159
00:41:23,480 --> 00:41:27,560
you placed every single column so the

1160
00:41:27,560 --> 00:41:29,839
first one we have is a title which is

1161
00:41:29,839 --> 00:41:32,280
these are all not fake data but I have

1162
00:41:32,280 --> 00:41:34,359
them generated so we have Inception the

1163
00:41:34,359 --> 00:41:36,359
release date which is right here in the

1164
00:41:36,359 --> 00:41:38,920
date format we have its price in a

1165
00:41:38,920 --> 00:41:41,040
decibel format we have the rating of the

1166
00:41:41,040 --> 00:41:43,560
movie as well as the user rating of the

1167
00:41:43,560 --> 00:41:46,280
movie and so you can see it fits within

1168
00:41:46,280 --> 00:41:48,040
this set of parenthesis it fits the

1169
00:41:48,040 --> 00:41:50,480
order of this set of parenthesis so if

1170
00:41:50,480 --> 00:41:52,400
we hit enter right now you can see that

1171
00:41:52,400 --> 00:41:54,800
we've entered in 20 rows of data if I

1172
00:41:54,800 --> 00:41:57,440
say select

1173
00:41:57,440 --> 00:41:59,480
all from

1174
00:41:59,480 --> 00:42:03,359
films we can see that a little out of

1175
00:42:03,359 --> 00:42:05,960
place here because my terminal is a

1176
00:42:05,960 --> 00:42:08,000
little big but we can scroll down and we

1177
00:42:08,000 --> 00:42:10,160
can see that all the data was entered in

1178
00:42:10,160 --> 00:42:11,720
go ahead and skip this line let me make

1179
00:42:11,720 --> 00:42:14,520
it smaller so that we can see more of it

1180
00:42:14,520 --> 00:42:17,880
but if I hit that again we can see the

1181
00:42:17,880 --> 00:42:21,359
table is formatted properly the same way

1182
00:42:21,359 --> 00:42:23,200
that the user's table was but that right

1183
00:42:23,200 --> 00:42:26,200
there is how you can insert data into a

1184
00:42:26,200 --> 00:42:28,760
table it's doesn't have to be that big

1185
00:42:28,760 --> 00:42:30,400
every single time if we just wanted to

1186
00:42:30,400 --> 00:42:33,720
insert one more row it would just be the

1187
00:42:33,720 --> 00:42:36,200
exact query back here except just one

1188
00:42:36,200 --> 00:42:38,280
more line another really useful command

1189
00:42:38,280 --> 00:42:39,760
that you should know is going to be the

1190
00:42:39,760 --> 00:42:41,440
limit command imagine you have a

1191
00:42:41,440 --> 00:42:43,280
database that has thousands upon

1192
00:42:43,280 --> 00:42:45,680
thousands of Records but you only need a

1193
00:42:45,680 --> 00:42:47,359
certain amount so you want to limit the

1194
00:42:47,359 --> 00:42:49,680
query to that amount that's where limit

1195
00:42:49,680 --> 00:42:51,599
comes in so as we saw in the new films

1196
00:42:51,599 --> 00:42:53,640
table we saw that we have 20 rows but

1197
00:42:53,640 --> 00:42:56,040
what if we only want less than 20 so

1198
00:42:56,040 --> 00:42:58,319
let's say five that's where we would use

1199
00:42:58,319 --> 00:43:00,880
limit so let's do select

1200
00:43:00,880 --> 00:43:03,040
all from we're going to go into the

1201
00:43:03,040 --> 00:43:06,160
films table but after films typically we

1202
00:43:06,160 --> 00:43:07,520
would have that semicolon to end the

1203
00:43:07,520 --> 00:43:10,520
query but now we're going to add a limit

1204
00:43:10,520 --> 00:43:12,520
and then the value of what we want the

1205
00:43:12,520 --> 00:43:14,880
limit the query to so because we have 20

1206
00:43:14,880 --> 00:43:17,119
we want less than 20 here let's just say

1207
00:43:17,119 --> 00:43:19,559
I only want five records to come back if

1208
00:43:19,559 --> 00:43:21,480
I hit enter you're going to see that I

1209
00:43:21,480 --> 00:43:23,839
only get the first five records in the

1210
00:43:23,839 --> 00:43:26,720
table to come back so that is a very

1211
00:43:26,720 --> 00:43:29,280
easy easy to understand command here and

1212
00:43:29,280 --> 00:43:31,599
very useful to limit the amount of

1213
00:43:31,599 --> 00:43:33,079
records that come back cuz you could

1214
00:43:33,079 --> 00:43:34,839
imagine as I said before if you're

1215
00:43:34,839 --> 00:43:37,160
trying to query a database or a table

1216
00:43:37,160 --> 00:43:39,000
that has thousands of records that query

1217
00:43:39,000 --> 00:43:40,559
could take a very long time so if you

1218
00:43:40,559 --> 00:43:42,040
want that to speed up a little bit and

1219
00:43:42,040 --> 00:43:43,800
you only need a certain amount to see

1220
00:43:43,800 --> 00:43:45,280
what the data looks like if it's

1221
00:43:45,280 --> 00:43:47,440
formatted properly the limit command is

1222
00:43:47,440 --> 00:43:48,880
going to be your best friend the next

1223
00:43:48,880 --> 00:43:50,640
thing we're going to cover is going to

1224
00:43:50,640 --> 00:43:52,480
include some math here but we're going

1225
00:43:52,480 --> 00:43:55,200
to go over aggregate functions in SQL

1226
00:43:55,200 --> 00:43:57,119
aggregate functions in SQL allow us to

1227
00:43:57,119 --> 00:43:59,079
do computations on top of a single

1228
00:43:59,079 --> 00:44:01,480
column through every single row of a

1229
00:44:01,480 --> 00:44:03,800
table it's incredibly useful in data

1230
00:44:03,800 --> 00:44:05,640
analytics where it allows us to

1231
00:44:05,640 --> 00:44:07,720
calculate important metrics and gain

1232
00:44:07,720 --> 00:44:10,200
insights from our data so let's get into

1233
00:44:10,200 --> 00:44:11,960
the first one the first one is going to

1234
00:44:11,960 --> 00:44:14,640
be count now the count function allows

1235
00:44:14,640 --> 00:44:17,319
us to count the number of rows depending

1236
00:44:17,319 --> 00:44:19,119
on if it matches the condition that we

1237
00:44:19,119 --> 00:44:20,680
give it so now that we have our films

1238
00:44:20,680 --> 00:44:22,079
table let's say we wanted to count the

1239
00:44:22,079 --> 00:44:24,280
amount of films if we don't know how

1240
00:44:24,280 --> 00:44:26,640
many are inside the table let's start

1241
00:44:26,640 --> 00:44:29,680
the query here so let's say select right

1242
00:44:29,680 --> 00:44:31,960
after the select statement we would say

1243
00:44:31,960 --> 00:44:35,359
count in the parentheses we would count

1244
00:44:35,359 --> 00:44:36,960
however many we want but if I add an

1245
00:44:36,960 --> 00:44:39,520
asterisk here that's going to say count

1246
00:44:39,520 --> 00:44:42,760
every single record inside of this table

1247
00:44:42,760 --> 00:44:44,520
if it matches the condition I'm about to

1248
00:44:44,520 --> 00:44:47,640
give it so we're going to say count from

1249
00:44:47,640 --> 00:44:51,520
film's table so again this is selecting

1250
00:44:51,520 --> 00:44:54,079
the number of Records within this

1251
00:44:54,079 --> 00:44:55,440
condition here and what we give it is an

1252
00:44:55,440 --> 00:44:57,599
asterisk for all from the films and what

1253
00:44:57,599 --> 00:44:59,480
this should give me back is the number

1254
00:44:59,480 --> 00:45:01,720
20 because we have 20 rows inside this

1255
00:45:01,720 --> 00:45:03,359
column so just remember within this

1256
00:45:03,359 --> 00:45:05,000
parenthesis here is going to be the

1257
00:45:05,000 --> 00:45:06,599
condition depending on what that

1258
00:45:06,599 --> 00:45:08,480
condition is it will spit back to you

1259
00:45:08,480 --> 00:45:10,720
always a number depending on if it's

1260
00:45:10,720 --> 00:45:12,520
true within that condition and count is

1261
00:45:12,520 --> 00:45:14,040
really useful for that the next

1262
00:45:14,040 --> 00:45:15,400
aggregate function we're going to look

1263
00:45:15,400 --> 00:45:17,319
at is going to be the sum function now

1264
00:45:17,319 --> 00:45:20,119
we would use sum to calculate the sum of

1265
00:45:20,119 --> 00:45:22,520
all the numbers in a numeric column so

1266
00:45:22,520 --> 00:45:25,079
if we take a look here we have a prices

1267
00:45:25,079 --> 00:45:27,240
column so now if we wanted to let say

1268
00:45:27,240 --> 00:45:29,960
calculate the sum of every single price

1269
00:45:29,960 --> 00:45:33,760
in this column we would say select sum

1270
00:45:33,760 --> 00:45:36,119
inside the parentheses we would say

1271
00:45:36,119 --> 00:45:37,839
price because we want to use the price

1272
00:45:37,839 --> 00:45:41,319
column from the films table so now if we

1273
00:45:41,319 --> 00:45:42,960
look back at this we're selecting the

1274
00:45:42,960 --> 00:45:45,800
sum function is going to look into the

1275
00:45:45,800 --> 00:45:48,559
price column and add up every single

1276
00:45:48,559 --> 00:45:50,800
number value within it and it will spit

1277
00:45:50,800 --> 00:45:54,200
back to us the total sum of every single

1278
00:45:54,200 --> 00:45:56,319
movie that we have inside this table so

1279
00:45:56,319 --> 00:45:58,480
if you were to have gone to every single

1280
00:45:58,480 --> 00:46:00,559
one of these movies at this price you

1281
00:46:00,559 --> 00:46:02,079
would have spent

1282
00:46:02,079 --> 00:46:04,400
$228.8 now let's say we want to get the

1283
00:46:04,400 --> 00:46:06,520
average of something inside of our table

1284
00:46:06,520 --> 00:46:08,680
say for example we want the average user

1285
00:46:08,680 --> 00:46:12,079
rating of movies in this table well

1286
00:46:12,079 --> 00:46:14,119
that's where the average statement or

1287
00:46:14,119 --> 00:46:16,280
the average function comes in it's going

1288
00:46:16,280 --> 00:46:19,119
to look the exact same as the sum

1289
00:46:19,119 --> 00:46:20,800
function so we're going to say select

1290
00:46:20,800 --> 00:46:22,359
but instead of sum we're going to say

1291
00:46:22,359 --> 00:46:24,520
average or AVG and inside the

1292
00:46:24,520 --> 00:46:26,079
parenthesis we're going to enter in the

1293
00:46:26,079 --> 00:46:27,240
column that we want to take take a look

1294
00:46:27,240 --> 00:46:29,240
at which is going to be user uncore

1295
00:46:29,240 --> 00:46:31,880
rating close the parenthesis there and

1296
00:46:31,880 --> 00:46:34,359
then we're going to say from the films

1297
00:46:34,359 --> 00:46:37,480
table and that then gives us an average

1298
00:46:37,480 --> 00:46:39,680
of every single user rating that the

1299
00:46:39,680 --> 00:46:43,280
movies have which is going to be 4.6 and

1300
00:46:43,280 --> 00:46:45,119
lastly one of the more useful ones is

1301
00:46:45,119 --> 00:46:47,319
going to be Max and min max and Min are

1302
00:46:47,319 --> 00:46:49,000
used to find the highest and lowest

1303
00:46:49,000 --> 00:46:51,160
numeric value within a column so let's

1304
00:46:51,160 --> 00:46:52,680
look at our price column again if we

1305
00:46:52,680 --> 00:46:54,319
wanted to get the lowest and the highest

1306
00:46:54,319 --> 00:46:56,400
values in the prices column our query

1307
00:46:56,400 --> 00:46:57,960
would look something like select and

1308
00:46:57,960 --> 00:47:00,079
then we would say Max inside the max

1309
00:47:00,079 --> 00:47:02,119
column our condition would be the column

1310
00:47:02,119 --> 00:47:05,200
we want so we want price we're going to

1311
00:47:05,200 --> 00:47:06,960
add a comma here and we're going to say

1312
00:47:06,960 --> 00:47:09,440
Min again parenthesis and looking at the

1313
00:47:09,440 --> 00:47:10,760
prices

1314
00:47:10,760 --> 00:47:14,359
column from the films table now if I hit

1315
00:47:14,359 --> 00:47:16,920
enter here we're going to see the max

1316
00:47:16,920 --> 00:47:20,240
value here was $4.99 and the minimum was

1317
00:47:20,240 --> 00:47:23,559
$7.99 so the the cheapest movie out here

1318
00:47:23,559 --> 00:47:25,240
that was in the table was

1319
00:47:25,240 --> 00:47:28,960
$77.99 and the max was $4.99 so very

1320
00:47:28,960 --> 00:47:31,040
helpful to sift through a big table if

1321
00:47:31,040 --> 00:47:32,240
you're just trying to find the highest

1322
00:47:32,240 --> 00:47:33,839
value and the lowest value another

1323
00:47:33,839 --> 00:47:36,319
useful statement in SQL is going to be

1324
00:47:36,319 --> 00:47:39,119
group by we use Group by to get

1325
00:47:39,119 --> 00:47:41,599
identical data into groups it's also

1326
00:47:41,599 --> 00:47:43,640
typically used with aggregate functions

1327
00:47:43,640 --> 00:47:46,160
like the ones we just did like count sum

1328
00:47:46,160 --> 00:47:48,800
min max average so that we can group the

1329
00:47:48,800 --> 00:47:50,760
result sets into one or more columns

1330
00:47:50,760 --> 00:47:52,160
let's take a look at how this would look

1331
00:47:52,160 --> 00:47:54,520
if we were to use Group by with the

1332
00:47:54,520 --> 00:47:56,559
average aggregate function let's take a

1333
00:47:56,559 --> 00:47:58,760
look at the films table again and let's

1334
00:47:58,760 --> 00:48:01,319
say we want to group the average user

1335
00:48:01,319 --> 00:48:04,240
rating based off of the movie's actual

1336
00:48:04,240 --> 00:48:05,599
rating how would we do that we're going

1337
00:48:05,599 --> 00:48:07,559
to select the rating column here and

1338
00:48:07,559 --> 00:48:09,200
then we're going to add a comma and add

1339
00:48:09,200 --> 00:48:10,599
our aggregate function since we're

1340
00:48:10,599 --> 00:48:12,640
stringing together two selects and

1341
00:48:12,640 --> 00:48:15,160
inside the condition of the average

1342
00:48:15,160 --> 00:48:19,480
function we're going to put in the user

1343
00:48:19,480 --> 00:48:22,079
uncore rating

1344
00:48:22,079 --> 00:48:26,079
column from the films Table after that

1345
00:48:26,079 --> 00:48:27,920
we're going to say Group

1346
00:48:27,920 --> 00:48:30,480
by and what we wanted to group that by

1347
00:48:30,480 --> 00:48:32,920
is by the rating so we're going to get

1348
00:48:32,920 --> 00:48:36,040
the average of every user rating inside

1349
00:48:36,040 --> 00:48:38,680
of the film's table and then group the

1350
00:48:38,680 --> 00:48:41,559
results by each individual rating so we

1351
00:48:41,559 --> 00:48:45,000
have PG-13 we have R and we have G npg

1352
00:48:45,000 --> 00:48:48,559
so we should see four rows inside of the

1353
00:48:48,559 --> 00:48:50,359
results after I had enter you can see

1354
00:48:50,359 --> 00:48:52,440
the average rating for R-rated movies

1355
00:48:52,440 --> 00:48:53,240
was

1356
00:48:53,240 --> 00:48:57,200
4.61 the average rating for PG-13 is 4.5

1357
00:48:57,200 --> 00:49:00,760
PG was 4.8 and G was 4.4 so now you can

1358
00:49:00,760 --> 00:49:02,640
see how this could be useful to group

1359
00:49:02,640 --> 00:49:05,319
together identical forms of data and

1360
00:49:05,319 --> 00:49:07,240
compare them against each other this is

1361
00:49:07,240 --> 00:49:09,480
especially important in data analysis

1362
00:49:09,480 --> 00:49:11,440
again it allows us to organize the data

1363
00:49:11,440 --> 00:49:13,079
into a different way and then run

1364
00:49:13,079 --> 00:49:14,960
computation on top of that especially

1365
00:49:14,960 --> 00:49:16,720
with them being in groups it's also

1366
00:49:16,720 --> 00:49:18,680
important to note the order that we did

1367
00:49:18,680 --> 00:49:21,440
this query if we were to have switch the

1368
00:49:21,440 --> 00:49:23,920
rating and the average functions here we

1369
00:49:23,920 --> 00:49:26,119
would have got a different result so the

1370
00:49:26,119 --> 00:49:28,720
order of the the query does matter

1371
00:49:28,720 --> 00:49:30,599
depending on how you want to format your

1372
00:49:30,599 --> 00:49:32,160
data so keep that in mind one cool

1373
00:49:32,160 --> 00:49:35,200
feature you can do in SQL is join two

1374
00:49:35,200 --> 00:49:37,559
different tables that have different

1375
00:49:37,559 --> 00:49:41,000
data sets and get a result that combines

1376
00:49:41,000 --> 00:49:42,920
both of the data you need into a

1377
00:49:42,920 --> 00:49:44,520
formatted table there are two different

1378
00:49:44,520 --> 00:49:46,160
commands that we can use for this and

1379
00:49:46,160 --> 00:49:47,640
we're going to go over those right now

1380
00:49:47,640 --> 00:49:49,520
the first one being in join and the left

1381
00:49:49,520 --> 00:49:52,240
one being left join they do very similar

1382
00:49:52,240 --> 00:49:55,480
things but there are key differences

1383
00:49:55,480 --> 00:49:57,640
that make them unique so let's go over

1384
00:49:57,640 --> 00:49:59,079
what those are right now but before we

1385
00:49:59,079 --> 00:50:00,680
do that we're going to need to create

1386
00:50:00,680 --> 00:50:03,319
another table that we can use data

1387
00:50:03,319 --> 00:50:06,000
against alongside our existing films

1388
00:50:06,000 --> 00:50:07,960
table so let's first create the film

1389
00:50:07,960 --> 00:50:10,200
category table so I'm going to go ahead

1390
00:50:10,200 --> 00:50:11,760
and copy and paste this so we have a

1391
00:50:11,760 --> 00:50:14,079
category ID a film ID and the category

1392
00:50:14,079 --> 00:50:16,040
name these categories match every single

1393
00:50:16,040 --> 00:50:18,440
movie that we currently have inside of

1394
00:50:18,440 --> 00:50:20,640
the films table now I'm going to go

1395
00:50:20,640 --> 00:50:23,240
ahead and insert our values here so let

1396
00:50:23,240 --> 00:50:27,280
me go ahead and do that hit enter enter

1397
00:50:27,280 --> 00:50:29,640
we have 39 records here so now if I do

1398
00:50:29,640 --> 00:50:35,160
select all from the Filmore category

1399
00:50:35,160 --> 00:50:37,400
table now we can see that we have our

1400
00:50:37,400 --> 00:50:40,319
category IDs and we have our film IDs as

1401
00:50:40,319 --> 00:50:43,040
well as their category names go ahead

1402
00:50:43,040 --> 00:50:45,559
and Skip all these lines here so now we

1403
00:50:45,559 --> 00:50:48,799
have two tables that we can use to join

1404
00:50:48,799 --> 00:50:51,119
with each other if we want a table where

1405
00:50:51,119 --> 00:50:54,720
we have all the movies as well as the

1406
00:50:54,720 --> 00:50:56,760
film categories we're going to learn

1407
00:50:56,760 --> 00:50:57,599
about two things right now we're going

1408
00:50:57,599 --> 00:50:59,480
to learn about how in join works and

1409
00:50:59,480 --> 00:51:02,160
we're going to learn about how aliases

1410
00:51:02,160 --> 00:51:05,359
work in your SQL queries so let's go

1411
00:51:05,359 --> 00:51:07,559
ahead and get to that so in order to

1412
00:51:07,559 --> 00:51:10,359
understand how joins work we need to

1413
00:51:10,359 --> 00:51:12,920
First create some tables that go against

1414
00:51:12,920 --> 00:51:14,640
the data that we have currently in all

1415
00:51:14,640 --> 00:51:17,319
those tables and insert some new ones so

1416
00:51:17,319 --> 00:51:19,160
that we can join them together so the

1417
00:51:19,160 --> 00:51:21,000
first table we're going to create is

1418
00:51:21,000 --> 00:51:23,400
going to be the actor's table so this is

1419
00:51:23,400 --> 00:51:24,960
going to have an actor ID and the actor

1420
00:51:24,960 --> 00:51:27,520
name I'm going to have all the actors

1421
00:51:27,520 --> 00:51:29,559
from every single film that we have

1422
00:51:29,559 --> 00:51:31,640
currently and then we're also going to

1423
00:51:31,640 --> 00:51:34,280
create the film actors table and this

1424
00:51:34,280 --> 00:51:36,799
will make sense in a second so this one

1425
00:51:36,799 --> 00:51:38,640
is going to have the film ID and actor

1426
00:51:38,640 --> 00:51:42,079
ID as well as a primary key and now into

1427
00:51:42,079 --> 00:51:45,960
the actors table are going to go every

1428
00:51:45,960 --> 00:51:48,359
single name of each actor that are

1429
00:51:48,359 --> 00:51:51,280
associated with the specific films let

1430
00:51:51,280 --> 00:51:53,280
me go ahead and insert those and now we

1431
00:51:53,280 --> 00:51:54,960
also have the film actors which are

1432
00:51:54,960 --> 00:51:57,280
going to include their ID

1433
00:51:57,280 --> 00:52:00,000
as well as the film IDs so now you can

1434
00:52:00,000 --> 00:52:01,480
see that we have two separate tables

1435
00:52:01,480 --> 00:52:04,760
that we just created if I do select all

1436
00:52:04,760 --> 00:52:09,520
from the actors table we can see that we

1437
00:52:09,520 --> 00:52:12,880
have actor ID as well as the actor name

1438
00:52:12,880 --> 00:52:15,240
all in this table and then if we say

1439
00:52:15,240 --> 00:52:19,520
select all from Filmore actors table you

1440
00:52:19,520 --> 00:52:21,319
can see that we have a film ID and an

1441
00:52:21,319 --> 00:52:23,760
actor ID so this goes with multiple

1442
00:52:23,760 --> 00:52:24,839
different tables that we have

1443
00:52:24,839 --> 00:52:26,920
relationships with and now we can focus

1444
00:52:26,920 --> 00:52:29,960
on how to join all this data together

1445
00:52:29,960 --> 00:52:31,720
and make sense of inner join and left

1446
00:52:31,720 --> 00:52:33,160
join okay so like I said we're going to

1447
00:52:33,160 --> 00:52:35,559
focus on the inner join and we're also

1448
00:52:35,559 --> 00:52:38,079
going to add some aliases and what those

1449
00:52:38,079 --> 00:52:39,440
are going to look like let me copy and

1450
00:52:39,440 --> 00:52:41,960
paste this in here so we can go over

1451
00:52:41,960 --> 00:52:43,839
what this looks like first we have our

1452
00:52:43,839 --> 00:52:46,079
select statement and now we're going to

1453
00:52:46,079 --> 00:52:48,280
go into what we're selecting so we have

1454
00:52:48,280 --> 00:52:50,640
f. film ID and this will make sense in a

1455
00:52:50,640 --> 00:52:54,119
second we have f. tile we have a. actor

1456
00:52:54,119 --> 00:52:56,480
name so we're selecting the film ID

1457
00:52:56,480 --> 00:52:58,440
we're selecting the title name as well

1458
00:52:58,440 --> 00:53:00,119
as the actor name that's what the

1459
00:53:00,119 --> 00:53:02,240
results are going to look like now we're

1460
00:53:02,240 --> 00:53:05,079
going to select from the films table and

1461
00:53:05,079 --> 00:53:07,359
after the films table is a space and an

1462
00:53:07,359 --> 00:53:09,839
F so the Alias that we want to give our

1463
00:53:09,839 --> 00:53:12,720
films table is f so now that anytime we

1464
00:53:12,720 --> 00:53:15,440
want to access the films table all we

1465
00:53:15,440 --> 00:53:18,799
have to do is type f as we can see here

1466
00:53:18,799 --> 00:53:20,920
after we select the films table and add

1467
00:53:20,920 --> 00:53:22,960
the Alias we're going to do an add our

1468
00:53:22,960 --> 00:53:25,240
inner join statement this is where we're

1469
00:53:25,240 --> 00:53:27,720
going to add different tables and join

1470
00:53:27,720 --> 00:53:30,200
them together so after you say in join

1471
00:53:30,200 --> 00:53:32,839
we're going to take on the film actors

1472
00:53:32,839 --> 00:53:34,160
table and we're going to give it an

1473
00:53:34,160 --> 00:53:37,480
alias of fa so short for film actors and

1474
00:53:37,480 --> 00:53:40,079
we're going to join these two tables on

1475
00:53:40,079 --> 00:53:41,920
which is why we have on so we're going

1476
00:53:41,920 --> 00:53:44,319
to select the film's table and then the

1477
00:53:44,319 --> 00:53:46,799
film ID from the film's table if it

1478
00:53:46,799 --> 00:53:48,839
equals the same film ID from the film

1479
00:53:48,839 --> 00:53:50,119
actor's table that's where we're going

1480
00:53:50,119 --> 00:53:52,119
to join those rows and columns on we're

1481
00:53:52,119 --> 00:53:54,200
going to add another inner join we can

1482
00:53:54,200 --> 00:53:56,280
string on as many joins as we want so in

1483
00:53:56,280 --> 00:53:57,599
this this case we're going to do two

1484
00:53:57,599 --> 00:53:59,400
because we're bringing on the actor's

1485
00:53:59,400 --> 00:54:01,920
table so we're going to join the actor's

1486
00:54:01,920 --> 00:54:03,040
table and we're going to give it an

1487
00:54:03,040 --> 00:54:05,960
alias of a on the fact that any actor

1488
00:54:05,960 --> 00:54:09,520
IDs from the film actor table is also

1489
00:54:09,520 --> 00:54:13,599
equals to the actor IDs from the actor's

1490
00:54:13,599 --> 00:54:16,160
table and lastly we see order by that's

1491
00:54:16,160 --> 00:54:17,960
a statement we haven't gone over yet but

1492
00:54:17,960 --> 00:54:20,400
we're going to order them by the film

1493
00:54:20,400 --> 00:54:22,040
IDs from the film table so we're going

1494
00:54:22,040 --> 00:54:24,720
to order them by those film IDs but

1495
00:54:24,720 --> 00:54:27,160
we're going to go from the film table so

1496
00:54:27,160 --> 00:54:28,920
I know that's a lot to take in but let's

1497
00:54:28,920 --> 00:54:31,640
go over it one more time the final table

1498
00:54:31,640 --> 00:54:33,160
that we are going to see we're going to

1499
00:54:33,160 --> 00:54:35,000
have three different columns we're going

1500
00:54:35,000 --> 00:54:38,079
to see the film ID from the film's table

1501
00:54:38,079 --> 00:54:39,920
we're going to see the title from the

1502
00:54:39,920 --> 00:54:42,640
film's table and then the actor name

1503
00:54:42,640 --> 00:54:44,119
from the actor's table and now the

1504
00:54:44,119 --> 00:54:46,160
reason we're not seeing the film actor's

1505
00:54:46,160 --> 00:54:47,680
table in the select column is because

1506
00:54:47,680 --> 00:54:49,960
one we're using the film actor's table

1507
00:54:49,960 --> 00:54:53,359
as a bridge to connect the actor names

1508
00:54:53,359 --> 00:54:55,640
to their correct films that's what we

1509
00:54:55,640 --> 00:54:58,520
did here on the join as we took our film

1510
00:54:58,520 --> 00:55:00,119
actors and if we look up at the film

1511
00:55:00,119 --> 00:55:02,200
actors table we can see that we only

1512
00:55:02,200 --> 00:55:05,000
have a film ID and an actor ID each of

1513
00:55:05,000 --> 00:55:06,520
them are just numbers but they

1514
00:55:06,520 --> 00:55:08,839
correspond to an actor as well as a

1515
00:55:08,839 --> 00:55:10,799
movie so we took the data that we have

1516
00:55:10,799 --> 00:55:12,920
from the film actor table and we joined

1517
00:55:12,920 --> 00:55:16,200
it on top of the film table now if there

1518
00:55:16,200 --> 00:55:18,960
was a film ID that matches any of the

1519
00:55:18,960 --> 00:55:22,039
movies inside of the movies or I'm sorry

1520
00:55:22,039 --> 00:55:24,160
inside of the films table then we're

1521
00:55:24,160 --> 00:55:26,599
going to match those together take take

1522
00:55:26,599 --> 00:55:28,920
that data and use it for the results

1523
00:55:28,920 --> 00:55:31,480
section here now that bridge allows us

1524
00:55:31,480 --> 00:55:34,039
to say okay well now we want to join the

1525
00:55:34,039 --> 00:55:36,039
actors table on top of the film actor's

1526
00:55:36,039 --> 00:55:39,039
table now now we can associate actors

1527
00:55:39,039 --> 00:55:40,880
with the correct movies now that we have

1528
00:55:40,880 --> 00:55:43,000
the film IDs and the actors that go with

1529
00:55:43,000 --> 00:55:45,039
them so we're taking on the actor's

1530
00:55:45,039 --> 00:55:46,920
table in the form of or in the Alias of

1531
00:55:46,920 --> 00:55:49,480
a on top of film actors and now if we

1532
00:55:49,480 --> 00:55:52,480
have any actor IDs that match the film

1533
00:55:52,480 --> 00:55:57,160
IDs in the film ID or in the film actors

1534
00:55:57,160 --> 00:55:59,359
table we're going to take that data and

1535
00:55:59,359 --> 00:56:01,319
then use that here and then we'll

1536
00:56:01,319 --> 00:56:03,240
obviously again order them by the film

1537
00:56:03,240 --> 00:56:05,599
ID in the films table a lot to take in

1538
00:56:05,599 --> 00:56:07,559
again but if I hit enter we're going to

1539
00:56:07,559 --> 00:56:10,960
see that we have a very nice formatted

1540
00:56:10,960 --> 00:56:13,319
table here like I said we're ordering by

1541
00:56:13,319 --> 00:56:15,559
the f. film ID which we use up here as

1542
00:56:15,559 --> 00:56:17,440
well so everything is ordered

1543
00:56:17,440 --> 00:56:19,920
chronologically or you know in numerical

1544
00:56:19,920 --> 00:56:22,799
order 1 2 3 4 and then that film ID will

1545
00:56:22,799 --> 00:56:25,359
match Inception and then Leonardo

1546
00:56:25,359 --> 00:56:28,520
DiCaprio checks out was in Inception Tim

1547
00:56:28,520 --> 00:56:30,440
Robbins was in Shashank Redemption

1548
00:56:30,440 --> 00:56:33,200
Marlon Brando was in Godfather so you

1549
00:56:33,200 --> 00:56:35,039
can see on and on that this does make

1550
00:56:35,039 --> 00:56:38,760
sense and now if we were to go and do

1551
00:56:38,760 --> 00:56:44,000
select all from the films

1552
00:56:44,039 --> 00:56:46,559
table we can see that Inception had a

1553
00:56:46,559 --> 00:56:49,400
film ID of one so that checks out right

1554
00:56:49,400 --> 00:56:53,440
there um and then if we go to

1555
00:56:53,440 --> 00:56:58,280
select all from the actor's

1556
00:56:58,280 --> 00:57:00,680
table we can see that Leonardo DiCaprio

1557
00:57:00,680 --> 00:57:03,599
had an actor IDF one so all of that data

1558
00:57:03,599 --> 00:57:05,839
that we just took in actor idea of one

1559
00:57:05,839 --> 00:57:08,400
and film idea of one matches exactly

1560
00:57:08,400 --> 00:57:10,760
what it was between all the three

1561
00:57:10,760 --> 00:57:11,760
different tables that we had a

1562
00:57:11,760 --> 00:57:14,839
relationship with all to give us one

1563
00:57:14,839 --> 00:57:17,839
very nice table that we can now use for

1564
00:57:17,839 --> 00:57:21,160
any form of data analysis or what any

1565
00:57:21,160 --> 00:57:23,359
sort of computation that any of your

1566
00:57:23,359 --> 00:57:27,480
teams need and that's really a awesome

1567
00:57:27,480 --> 00:57:29,520
way to join multiple different tables

1568
00:57:29,520 --> 00:57:31,839
this was an example of inner join left

1569
00:57:31,839 --> 00:57:33,960
joins do something similar but there is

1570
00:57:33,960 --> 00:57:35,640
a catch between the two that make them

1571
00:57:35,640 --> 00:57:37,480
unique as I mentioned before so let's

1572
00:57:37,480 --> 00:57:39,319
take a look at what left joins look like

1573
00:57:39,319 --> 00:57:41,160
so in order for joins to make sense we

1574
00:57:41,160 --> 00:57:44,039
need to add another entry into the films

1575
00:57:44,039 --> 00:57:46,480
table so let's go ahead and do that I

1576
00:57:46,480 --> 00:57:49,319
have here a single entry that I will

1577
00:57:49,319 --> 00:57:51,480
copy and paste right now so I am simply

1578
00:57:51,480 --> 00:57:53,680
going back into the films table and

1579
00:57:53,680 --> 00:57:55,799
entering the mystical Adventures movie

1580
00:57:55,799 --> 00:57:58,240
so me go ahead and hit enter and then if

1581
00:57:58,240 --> 00:58:02,760
we do select all from films we can see

1582
00:58:02,760 --> 00:58:04,680
that the mythical Advent or mystical

1583
00:58:04,680 --> 00:58:06,520
Adventures is now added at the very

1584
00:58:06,520 --> 00:58:09,119
bottom so now we have 21 so now let me

1585
00:58:09,119 --> 00:58:12,480
copy the left join query that we want to

1586
00:58:12,480 --> 00:58:14,720
do here and now it's going to look very

1587
00:58:14,720 --> 00:58:16,200
similar to the inner join where we're

1588
00:58:16,200 --> 00:58:18,520
taking the film ID from the films table

1589
00:58:18,520 --> 00:58:21,000
the title from the films table and the

1590
00:58:21,000 --> 00:58:23,440
actor name from the actor's table again

1591
00:58:23,440 --> 00:58:25,400
we're adding the aliases here with the

1592
00:58:25,400 --> 00:58:27,319
letter f for the the film's table we're

1593
00:58:27,319 --> 00:58:30,720
left joining the film actors table again

1594
00:58:30,720 --> 00:58:32,760
using that as the bridge uh it's

1595
00:58:32,760 --> 00:58:34,480
essentially going to be the same query

1596
00:58:34,480 --> 00:58:36,240
but if we were to hit enter on this

1597
00:58:36,240 --> 00:58:38,559
right now you can see that we still do

1598
00:58:38,559 --> 00:58:40,799
have the table filled out properly and

1599
00:58:40,799 --> 00:58:42,880
formatted properly but we have mystical

1600
00:58:42,880 --> 00:58:46,200
Adventures but with no actor so the

1601
00:58:46,200 --> 00:58:48,240
thing with left joins is even if there

1602
00:58:48,240 --> 00:58:51,480
is a null value or it's missing a value

1603
00:58:51,480 --> 00:58:54,599
the result table will still show even if

1604
00:58:54,599 --> 00:58:57,079
there isn't an exact match now if we

1605
00:58:57,079 --> 00:58:59,599
were to go back up to the query where we

1606
00:58:59,599 --> 00:59:01,039
do the inner

1607
00:59:01,039 --> 00:59:04,440
join after we've now added the new movie

1608
00:59:04,440 --> 00:59:06,680
we can see that it doesn't show up so in

1609
00:59:06,680 --> 00:59:09,280
join if there is a null value and the

1610
00:59:09,280 --> 00:59:10,760
condition doesn't the condition isn't

1611
00:59:10,760 --> 00:59:12,880
fully met we will not see that in the

1612
00:59:12,880 --> 00:59:15,200
result table so for the result table you

1613
00:59:15,200 --> 00:59:16,839
see that we only have 20 entries as

1614
00:59:16,839 --> 00:59:18,559
opposed to the left join where we have

1615
00:59:18,559 --> 00:59:20,920
the 21 but we just have a missing actor

1616
00:59:20,920 --> 00:59:23,640
so to now show that this is actually

1617
00:59:23,640 --> 00:59:26,119
true we're going to insert a new Act

1618
00:59:26,119 --> 00:59:29,480
actor as well as the new actor IDs to

1619
00:59:29,480 --> 00:59:32,559
populate the movie so the movie we added

1620
00:59:32,559 --> 00:59:34,480
was a fictional movie so let's go ahead

1621
00:59:34,480 --> 00:59:36,119
and add the actor's name so we're going

1622
00:59:36,119 --> 00:59:38,240
to add Jane do and John Smith and we're

1623
00:59:38,240 --> 00:59:41,039
also going to add the film actors as

1624
00:59:41,039 --> 00:59:44,720
well so 21 and22 so if we were to run

1625
00:59:44,720 --> 00:59:47,880
our left join command again we're going

1626
00:59:47,880 --> 00:59:49,599
to see that mystical Adventures actually

1627
00:59:49,599 --> 00:59:51,880
does populate now but we're going to see

1628
00:59:51,880 --> 00:59:53,799
that the mystical Adventures actually

1629
00:59:53,799 --> 00:59:56,559
does populate now with the actor name

1630
00:59:56,559 --> 00:59:59,000
so this kind of just proves that no

1631
00:59:59,000 --> 01:00:02,440
matter what left joins will always show

1632
01:00:02,440 --> 01:00:04,599
the result table even if the conditions

1633
01:00:04,599 --> 01:00:06,319
aren't meant and there is a null value

1634
01:00:06,319 --> 01:00:07,599
there's two more commands we're going to

1635
01:00:07,599 --> 01:00:09,480
go over the first one is going to be

1636
01:00:09,480 --> 01:00:11,079
Union and the second one is going to be

1637
01:00:11,079 --> 01:00:13,400
Union all these do get a little mixed up

1638
01:00:13,400 --> 01:00:14,640
with the inner joint and left joint

1639
01:00:14,640 --> 01:00:16,359
since they kind of function the same way

1640
01:00:16,359 --> 01:00:19,119
in terms of how they work but they are

1641
01:00:19,119 --> 01:00:20,640
completely different and let's go over

1642
01:00:20,640 --> 01:00:22,160
what makes them unique here so the next

1643
01:00:22,160 --> 01:00:23,880
two commands are going to be Union and

1644
01:00:23,880 --> 01:00:25,240
Union all these are going to be the last

1645
01:00:25,240 --> 01:00:26,920
commands that we go over so we actually

1646
01:00:26,920 --> 01:00:29,480
use the union operator to string

1647
01:00:29,480 --> 01:00:31,760
together two select statements but with

1648
01:00:31,760 --> 01:00:34,640
the Union statement it actually removes

1649
01:00:34,640 --> 01:00:36,920
any duplicate rows with the same values

1650
01:00:36,920 --> 01:00:38,359
but with Union all you're going to get

1651
01:00:38,359 --> 01:00:40,359
duplicate rows in the result set table

1652
01:00:40,359 --> 01:00:42,720
so it kind of functions the same way as

1653
01:00:42,720 --> 01:00:44,520
in join and left join in terms of their

1654
01:00:44,520 --> 01:00:46,880
differences but the queries are going to

1655
01:00:46,880 --> 01:00:48,319
be very different so let's go ahead and

1656
01:00:48,319 --> 01:00:49,559
take a look at what that looks like all

1657
01:00:49,559 --> 01:00:50,880
right so back in the terminal we're

1658
01:00:50,880 --> 01:00:52,839
going to copy this Union command and

1659
01:00:52,839 --> 01:00:55,599
we're going to go over every single line

1660
01:00:55,599 --> 01:00:56,720
so with this command we're going to

1661
01:00:56,720 --> 01:01:00,319
select title as name from film so we're

1662
01:01:00,319 --> 01:01:03,480
going to use the name Alias we never use

1663
01:01:03,480 --> 01:01:06,000
the as operator it is completely

1664
01:01:06,000 --> 01:01:08,359
optional when giving aliases to use as

1665
01:01:08,359 --> 01:01:10,480
so you can omit this when doing it but

1666
01:01:10,480 --> 01:01:12,480
it makes a little bit more clear if we

1667
01:01:12,480 --> 01:01:15,359
say Select Title as name so instead of

1668
01:01:15,359 --> 01:01:17,720
the column being named title we're it's

1669
01:01:17,720 --> 01:01:19,760
going to be called name when we get the

1670
01:01:19,760 --> 01:01:22,440
result table from the films table and

1671
01:01:22,440 --> 01:01:24,200
then we're going to add the union

1672
01:01:24,200 --> 01:01:26,200
operator here and then string on on

1673
01:01:26,200 --> 01:01:28,480
another select statement so we're going

1674
01:01:28,480 --> 01:01:31,640
to select the actor name as name from

1675
01:01:31,640 --> 01:01:33,039
the actor's table and we're going to

1676
01:01:33,039 --> 01:01:35,400
order them by name so if I hit enter

1677
01:01:35,400 --> 01:01:37,599
here you're going to see that doesn't

1678
01:01:37,599 --> 01:01:38,880
really make too much sense but we can

1679
01:01:38,880 --> 01:01:41,319
see how it works kind of we have one

1680
01:01:41,319 --> 01:01:44,079
column since we named them both name

1681
01:01:44,079 --> 01:01:45,760
down here and we're putting down this is

1682
01:01:45,760 --> 01:01:48,920
an actor this is an actor this is the

1683
01:01:48,920 --> 01:01:51,440
name of the movie so we put together a

1684
01:01:51,440 --> 01:01:52,799
bunch of names and we order them

1685
01:01:52,799 --> 01:01:54,880
alphabetically by name now if we were to

1686
01:01:54,880 --> 01:01:57,200
do that again

1687
01:01:57,200 --> 01:02:01,760
but instead we were to change the actor

1688
01:02:01,760 --> 01:02:05,200
name to actor and hit enter and it would

1689
01:02:05,200 --> 01:02:07,359
be the same thing for Union all except

1690
01:02:07,359 --> 01:02:09,400
remember there are going to be duplicate

1691
01:02:09,400 --> 01:02:12,119
rows or duplicate values within here so

1692
01:02:12,119 --> 01:02:13,799
if we were to scroll down you can see

1693
01:02:13,799 --> 01:02:16,000
that we get Tom Hanks twice whereas in

1694
01:02:16,000 --> 01:02:18,920
the table above we only got Tom Hanks

1695
01:02:18,920 --> 01:02:22,400
once so again this is a prime example of

1696
01:02:22,400 --> 01:02:24,599
Union and Union all so we're putting

1697
01:02:24,599 --> 01:02:27,160
together all the data that we're

1698
01:02:27,160 --> 01:02:29,359
grabbing using two select statements

1699
01:02:29,359 --> 01:02:31,720
into one result table another cool

1700
01:02:31,720 --> 01:02:33,480
little thing you can do in SQL that's

1701
01:02:33,480 --> 01:02:35,359
actually going to be very useful later

1702
01:02:35,359 --> 01:02:36,839
down the line especially as a data

1703
01:02:36,839 --> 01:02:38,920
engineer is going to be something called

1704
01:02:38,920 --> 01:02:40,680
subqueries we've seen them a little bit

1705
01:02:40,680 --> 01:02:42,880
here by using the parentheses but let me

1706
01:02:42,880 --> 01:02:44,760
go ahead and show you what one looks

1707
01:02:44,760 --> 01:02:46,760
like and then we'll go over it so let me

1708
01:02:46,760 --> 01:02:49,240
copy and paste it over so as you can see

1709
01:02:49,240 --> 01:02:51,799
here we have first a select statement

1710
01:02:51,799 --> 01:02:53,760
where we're selecting the title now

1711
01:02:53,760 --> 01:02:55,520
inside of that we have a par or we have

1712
01:02:55,520 --> 01:02:57,520
a Comm and then inside a set of

1713
01:02:57,520 --> 01:02:59,839
parentheses we're using another select

1714
01:02:59,839 --> 01:03:01,400
statement but we're selecting the actor

1715
01:03:01,400 --> 01:03:04,079
name and again using aliases and a join

1716
01:03:04,079 --> 01:03:07,240
so from actors Alias of a we're joining

1717
01:03:07,240 --> 01:03:08,760
the film actors again using it as a

1718
01:03:08,760 --> 01:03:11,279
bridge and then the final result from

1719
01:03:11,279 --> 01:03:13,359
this select statement is going to be the

1720
01:03:13,359 --> 01:03:15,240
actor name and then we're pulling this

1721
01:03:15,240 --> 01:03:18,480
from films using the Alias F so this is

1722
01:03:18,480 --> 01:03:21,319
just a string select statement but a

1723
01:03:21,319 --> 01:03:23,960
subquery so before this finishes we're

1724
01:03:23,960 --> 01:03:26,559
going to run and find the title from the

1725
01:03:26,559 --> 01:03:28,799
films table but then we're also going to

1726
01:03:28,799 --> 01:03:31,760
look here SQL will go ahead and execute

1727
01:03:31,760 --> 01:03:33,920
this query and then add it into the

1728
01:03:33,920 --> 01:03:35,799
results table so right now what this is

1729
01:03:35,799 --> 01:03:38,279
doing is it's retrieving the films title

1730
01:03:38,279 --> 01:03:40,480
along with the name of one of its actors

1731
01:03:40,480 --> 01:03:42,079
so if we go ahead and hit enter you can

1732
01:03:42,079 --> 01:03:44,000
see that it's kind of the same thing

1733
01:03:44,000 --> 01:03:45,920
what we did earlier in the course where

1734
01:03:45,920 --> 01:03:48,760
we joined two different tables but we

1735
01:03:48,760 --> 01:03:51,640
used a subquery instead subqueries can

1736
01:03:51,640 --> 01:03:53,359
be used in multiple different ways we

1737
01:03:53,359 --> 01:03:55,440
saw this being used in the select Clause

1738
01:03:55,440 --> 01:03:57,359
here but we can actually use this also

1739
01:03:57,359 --> 01:03:59,559
with the in operator so if we wanted to

1740
01:03:59,559 --> 01:04:01,960
retrieve films that have either you know

1741
01:04:01,960 --> 01:04:05,160
let's say Leonardo DiCaprio or Tom Hanks

1742
01:04:05,160 --> 01:04:07,119
this is what the query would actually

1743
01:04:07,119 --> 01:04:08,799
look like so let me go ahead and show

1744
01:04:08,799 --> 01:04:10,160
you so we're selecting the title from

1745
01:04:10,160 --> 01:04:13,440
the films table where the film ID in and

1746
01:04:13,440 --> 01:04:14,839
then this is where our subquery would

1747
01:04:14,839 --> 01:04:17,039
start this is where we're going to say

1748
01:04:17,039 --> 01:04:19,400
hey we're looking for any films and

1749
01:04:19,400 --> 01:04:21,760
we're want the name of them if the

1750
01:04:21,760 --> 01:04:24,160
condition is met here where the actor's

1751
01:04:24,160 --> 01:04:26,640
name is either Leonardo Caprio or Tom

1752
01:04:26,640 --> 01:04:28,079
Hanks so we're looking for both of these

1753
01:04:28,079 --> 01:04:29,880
movies so we're going to say Obviously

1754
01:04:29,880 --> 01:04:32,079
go into the film actors table and do

1755
01:04:32,079 --> 01:04:34,359
another join here so we're adding that

1756
01:04:34,359 --> 01:04:36,960
condition by joining in other tables and

1757
01:04:36,960 --> 01:04:39,279
that's where subquery can really become

1758
01:04:39,279 --> 01:04:41,000
useful here so if I enter you're going

1759
01:04:41,000 --> 01:04:42,240
to see that we're only going to get the

1760
01:04:42,240 --> 01:04:44,319
titles back and Inception Force gum and

1761
01:04:44,319 --> 01:04:46,039
Toy Story are going to be the three

1762
01:04:46,039 --> 01:04:49,119
movies that contain Leonard DiCaprio or

1763
01:04:49,119 --> 01:04:51,200
Tom Hanks and obviously most of us have

1764
01:04:51,200 --> 01:04:53,160
seen that so that checks out but that is

1765
01:04:53,160 --> 01:04:55,920
a quick little intro and awesome little

1766
01:04:55,920 --> 01:04:59,119
thing we can do in SQL

1767
01:04:59,119 --> 01:05:01,039
subqueries all right so now that we've

1768
01:05:01,039 --> 01:05:03,240
gone through SQL we can finally get into

1769
01:05:03,240 --> 01:05:05,760
building our first data pipeline this is

1770
01:05:05,760 --> 01:05:08,880
going to evolve as the course progresses

1771
01:05:08,880 --> 01:05:10,440
but we're going to start off by building

1772
01:05:10,440 --> 01:05:13,319
this data pipeline from scratch using a

1773
01:05:13,319 --> 01:05:16,079
python script and moving data that way

1774
01:05:16,079 --> 01:05:17,359
we're also going to be using Docker to

1775
01:05:17,359 --> 01:05:19,799
host both of our source and destination

1776
01:05:19,799 --> 01:05:21,839
databases using postgress so you'll get

1777
01:05:21,839 --> 01:05:24,240
to see how this all coincides and works

1778
01:05:24,240 --> 01:05:25,960
together with Docker one thing to note

1779
01:05:25,960 --> 01:05:27,880
before we keep moving on is there is a

1780
01:05:27,880 --> 01:05:30,599
repo for this whole project you can see

1781
01:05:30,599 --> 01:05:32,400
it here with a read me on how to get

1782
01:05:32,400 --> 01:05:34,799
started and how everything works if you

1783
01:05:34,799 --> 01:05:36,520
go up here to the branches you can see

1784
01:05:36,520 --> 01:05:39,640
the evolution of this project so first

1785
01:05:39,640 --> 01:05:42,400
we're going to be starting with just the

1786
01:05:42,400 --> 01:05:44,599
main elt script and then we're going to

1787
01:05:44,599 --> 01:05:46,839
be adding on a Cron job to show

1788
01:05:46,839 --> 01:05:48,880
orchestration from there we're going to

1789
01:05:48,880 --> 01:05:51,720
be adding DBT to the mix which we'll get

1790
01:05:51,720 --> 01:05:53,720
into later and then also airflow and

1791
01:05:53,720 --> 01:05:55,680
then eventually air bite so there's

1792
01:05:55,680 --> 01:05:57,079
going to be this progression of the

1793
01:05:57,079 --> 01:06:00,799
course to show kind of how a main elt

1794
01:06:00,799 --> 01:06:03,000
script uh that's created manually would

1795
01:06:03,000 --> 01:06:05,839
look and then as we add in more open

1796
01:06:05,839 --> 01:06:07,319
source tooling you'll kind of see the

1797
01:06:07,319 --> 01:06:09,920
power of how everything works together

1798
01:06:09,920 --> 01:06:12,200
and why you know we are using these open

1799
01:06:12,200 --> 01:06:14,160
source tools in the first place so just

1800
01:06:14,160 --> 01:06:16,720
for your reference make sure to look in

1801
01:06:16,720 --> 01:06:18,440
the description and you can find this

1802
01:06:18,440 --> 01:06:20,760
link here to my GitHub repo with

1803
01:06:20,760 --> 01:06:22,200
everything you need to see just in case

1804
01:06:22,200 --> 01:06:23,799
you get stuck on something but for the

1805
01:06:23,799 --> 01:06:25,039
rest of this project I'm going to be

1806
01:06:25,039 --> 01:06:27,279
creating a new directory but it will

1807
01:06:27,279 --> 01:06:29,480
directly reference this project so just

1808
01:06:29,480 --> 01:06:31,000
keep an eye on this when you're working

1809
01:06:31,000 --> 01:06:31,880
through it all right so I have my

1810
01:06:31,880 --> 01:06:33,359
terminal open so let's go ahead and

1811
01:06:33,359 --> 01:06:35,680
create our first directory here I'm

1812
01:06:35,680 --> 01:06:37,960
going to say make and then for here I'm

1813
01:06:37,960 --> 01:06:40,960
going to say elt and then we're going to

1814
01:06:40,960 --> 01:06:43,440
CD into elt um and then from there we're

1815
01:06:43,440 --> 01:06:45,240
going to say touch

1816
01:06:45,240 --> 01:06:47,119
eltor

1817
01:06:47,119 --> 01:06:50,000
script.py let's also create a Docker

1818
01:06:50,000 --> 01:06:51,960
file so I'm going to use Docker compose

1819
01:06:51,960 --> 01:06:53,920
in this so I'm going to say Docker

1820
01:06:53,920 --> 01:06:56,599
compose and let's go ahead and open that

1821
01:06:56,599 --> 01:06:58,400
up okay so now you can see we have two

1822
01:06:58,400 --> 01:07:00,119
files that we just created we have the

1823
01:07:00,119 --> 01:07:02,279
elt script and then we also have the

1824
01:07:02,279 --> 01:07:04,880
docker compos file all empty but we're

1825
01:07:04,880 --> 01:07:06,039
going to fill this out now the first

1826
01:07:06,039 --> 01:07:07,440
thing we're going to do is actually fill

1827
01:07:07,440 --> 01:07:10,039
out this Docker compose file in order to

1828
01:07:10,039 --> 01:07:13,000
have the two databases that we need one

1829
01:07:13,000 --> 01:07:15,000
being our source where our data is

1830
01:07:15,000 --> 01:07:17,039
coming from and the destination where we

1831
01:07:17,039 --> 01:07:18,799
want to send data to so that way we can

1832
01:07:18,799 --> 01:07:20,760
use the alt script to move data between

1833
01:07:20,760 --> 01:07:22,039
those two now we're going to use

1834
01:07:22,039 --> 01:07:23,720
postgress for this example because we

1835
01:07:23,720 --> 01:07:25,279
can use it as an open source database

1836
01:07:25,279 --> 01:07:26,480
and so so let's go ahead and fill this

1837
01:07:26,480 --> 01:07:27,720
out so the first thing we need is going

1838
01:07:27,720 --> 01:07:29,559
to be the version and uh version three

1839
01:07:29,559 --> 01:07:30,559
is going to be what I'm going to be

1840
01:07:30,559 --> 01:07:32,559
using for the doc compos file now we

1841
01:07:32,559 --> 01:07:34,920
list our services so in here this is

1842
01:07:34,920 --> 01:07:37,240
where we name our first service and in

1843
01:07:37,240 --> 01:07:38,599
this case I'm going to name it Source

1844
01:07:38,599 --> 01:07:39,880
postgress that's going to be our first

1845
01:07:39,880 --> 01:07:42,160
service now remember with yo files it is

1846
01:07:42,160 --> 01:07:44,720
very crucial for you to have proper

1847
01:07:44,720 --> 01:07:47,839
spacing within the file itself if not

1848
01:07:47,839 --> 01:07:49,440
the yl file is not going to read

1849
01:07:49,440 --> 01:07:51,400
properly and it'll actually error out if

1850
01:07:51,400 --> 01:07:53,400
you don't follow the correct tabbing and

1851
01:07:53,400 --> 01:07:55,680
indentation so keep that in mind um so

1852
01:07:55,680 --> 01:07:56,599
the first thing we're going to do is

1853
01:07:56,599 --> 01:07:58,839
list the image and for the image here

1854
01:07:58,839 --> 01:08:00,520
I'm just going to say we want to pull

1855
01:08:00,520 --> 01:08:03,119
from dockerhub the postgress image and

1856
01:08:03,119 --> 01:08:05,000
the latest version of it so that way

1857
01:08:05,000 --> 01:08:07,119
we're always up to date the ports so

1858
01:08:07,119 --> 01:08:08,920
this is going to be very important for

1859
01:08:08,920 --> 01:08:11,839
us in terms of accessing the actual

1860
01:08:11,839 --> 01:08:13,680
service itself so with the source and

1861
01:08:13,680 --> 01:08:15,599
the destination databases we need to

1862
01:08:15,599 --> 01:08:17,679
expose the ports so that we can actually

1863
01:08:17,679 --> 01:08:20,000
access them on the local host and so for

1864
01:08:20,000 --> 01:08:21,880
this I'm going to say we're going to

1865
01:08:21,880 --> 01:08:23,239
open this up on

1866
01:08:23,239 --> 01:08:27,480
5433 and by default we need do 5432 I

1867
01:08:27,480 --> 01:08:29,560
believe so let's go ahead and do that

1868
01:08:29,560 --> 01:08:31,400
now for the networks we're going to

1869
01:08:31,400 --> 01:08:33,120
create a network for all of our

1870
01:08:33,120 --> 01:08:36,159
containers so you can look at all these

1871
01:08:36,159 --> 01:08:39,239
Services as a single container in each

1872
01:08:39,239 --> 01:08:41,040
single container contains an image that

1873
01:08:41,040 --> 01:08:43,080
the runtime is going to use and so we

1874
01:08:43,080 --> 01:08:44,839
actually need to create a network for

1875
01:08:44,839 --> 01:08:46,199
all of these different containers to

1876
01:08:46,199 --> 01:08:48,839
talk to now I'm going to name it _

1877
01:08:48,839 --> 01:08:51,319
Network and we will see that at the end

1878
01:08:51,319 --> 01:08:54,120
of this file we're going to have a well

1879
01:08:54,120 --> 01:08:55,440
I can actually just do this right now so

1880
01:08:55,440 --> 01:08:57,920
we're going to have a networks section

1881
01:08:57,920 --> 01:09:01,199
and in there we'll list the _ network we

1882
01:09:01,199 --> 01:09:03,239
also have to specify this is going to be

1883
01:09:03,239 --> 01:09:04,920
a bridge driver um you don't have to

1884
01:09:04,920 --> 01:09:06,040
worry about that what that means but

1885
01:09:06,040 --> 01:09:08,000
just know that within the network all of

1886
01:09:08,000 --> 01:09:09,759
the containers are going to recognize

1887
01:09:09,759 --> 01:09:11,679
that this is the network we wanted to

1888
01:09:11,679 --> 01:09:13,759
talk uh remember that is outside of the

1889
01:09:13,759 --> 01:09:15,960
services tab this is going to be its own

1890
01:09:15,960 --> 01:09:17,799
section here with its own properties so

1891
01:09:17,799 --> 01:09:19,319
make sure that you're doing that there

1892
01:09:19,319 --> 01:09:22,040
now within the source postest service

1893
01:09:22,040 --> 01:09:23,400
we're going to do some environment

1894
01:09:23,400 --> 01:09:25,000
variables here that are going to be very

1895
01:09:25,000 --> 01:09:26,920
important for the first one we're going

1896
01:09:26,920 --> 01:09:28,759
to do the

1897
01:09:28,759 --> 01:09:31,120
postgress database so this is going to

1898
01:09:31,120 --> 01:09:32,719
the name of our database and for the

1899
01:09:32,719 --> 01:09:35,040
name we're going to say sourcecore DB

1900
01:09:35,040 --> 01:09:36,600
keep it very simple uh the next one

1901
01:09:36,600 --> 01:09:38,279
we're going to do is going to be the

1902
01:09:38,279 --> 01:09:41,560
user so postgress user and this one let

1903
01:09:41,560 --> 01:09:44,319
me uh actually should be this way not an

1904
01:09:44,319 --> 01:09:46,839
equal sign it should be a colon my bad

1905
01:09:46,839 --> 01:09:49,159
this is going to be user postgress as

1906
01:09:49,159 --> 01:09:51,400
default and then obviously the next one

1907
01:09:51,400 --> 01:09:53,359
is going to be password this you can

1908
01:09:53,359 --> 01:09:55,760
change to however you want it to be I'm

1909
01:09:55,760 --> 01:09:58,080
going to say secret for this one and now

1910
01:09:58,080 --> 01:09:59,760
for the volumes this is going to make

1911
01:09:59,760 --> 01:10:02,040
way more sense and I I should actually

1912
01:10:02,040 --> 01:10:05,520
create this um this folder now but we're

1913
01:10:05,520 --> 01:10:07,560
going to create an elt folder we're

1914
01:10:07,560 --> 01:10:09,480
actually going to drag this elt script

1915
01:10:09,480 --> 01:10:11,000
into that folder just so we can have

1916
01:10:11,000 --> 01:10:12,920
some separation between everything the

1917
01:10:12,920 --> 01:10:15,040
docker composed file will remain in the

1918
01:10:15,040 --> 01:10:18,520
root but um for the next one we're going

1919
01:10:18,520 --> 01:10:20,120
to say volumes and if we remember what

1920
01:10:20,120 --> 01:10:21,920
we were talking about in the docker

1921
01:10:21,920 --> 01:10:24,640
section the volumes is how we were able

1922
01:10:24,640 --> 01:10:27,360
to persist data so each container can

1923
01:10:27,360 --> 01:10:29,280
create a volume and then whatever we're

1924
01:10:29,280 --> 01:10:31,520
doing inside of that Docker container

1925
01:10:31,520 --> 01:10:33,840
will contain the data that we're

1926
01:10:33,840 --> 01:10:36,080
utilizing within that volume so that

1927
01:10:36,080 --> 01:10:37,880
data will always persist as long as we

1928
01:10:37,880 --> 01:10:39,640
do not delete it from within Docker what

1929
01:10:39,640 --> 01:10:41,080
I'm going to do here is I'm going to

1930
01:10:41,080 --> 01:10:44,000
specify the path of so Source this will

1931
01:10:44,000 --> 01:10:45,199
make a lot more sense in a second so

1932
01:10:45,199 --> 01:10:47,560
Source IND justy uh init so we're

1933
01:10:47,560 --> 01:10:49,679
actually going to have some data that

1934
01:10:49,679 --> 01:10:52,239
we're going to initialize this postgress

1935
01:10:52,239 --> 01:10:56,600
database with and the init SQL folder or

1936
01:10:56,600 --> 01:10:58,719
file sorry that we're going to create

1937
01:10:58,719 --> 01:11:01,679
inside of the source DB in nit folder is

1938
01:11:01,679 --> 01:11:03,440
what we're going to utilize and so after

1939
01:11:03,440 --> 01:11:05,360
we've done that we're going to map this

1940
01:11:05,360 --> 01:11:07,600
uh so if you see the colon after this

1941
01:11:07,600 --> 01:11:09,960
this uh directory we're actually mapping

1942
01:11:09,960 --> 01:11:12,880
this to the directory within the docker

1943
01:11:12,880 --> 01:11:15,560
container so you could see this as this

1944
01:11:15,560 --> 01:11:17,640
is our local directory and we're going

1945
01:11:17,640 --> 01:11:19,480
to map this over into the docker

1946
01:11:19,480 --> 01:11:21,080
directory and where this is going to go

1947
01:11:21,080 --> 01:11:22,840
is going to go into the docker entry

1948
01:11:22,840 --> 01:11:28,679
point innit db. d/ init SQL okay so this

1949
01:11:28,679 --> 01:11:30,320
should be exactly what it looks like for

1950
01:11:30,320 --> 01:11:33,760
you and this is going to be the same it

1951
01:11:33,760 --> 01:11:35,480
pretty much looks identical so we're

1952
01:11:35,480 --> 01:11:36,600
actually going to do this and I'm going

1953
01:11:36,600 --> 01:11:39,800
to do shift option down to duplicate

1954
01:11:39,800 --> 01:11:41,600
this we're going to add a space here so

1955
01:11:41,600 --> 01:11:43,679
this is going to be our very first

1956
01:11:43,679 --> 01:11:45,239
service here which is going to be the

1957
01:11:45,239 --> 01:11:47,639
source database and now what we want to

1958
01:11:47,639 --> 01:11:48,719
create here is going to be the

1959
01:11:48,719 --> 01:11:51,080
destination database uh and we're going

1960
01:11:51,080 --> 01:11:53,000
to change the port here to

1961
01:11:53,000 --> 01:11:55,440
5434 we're going to keep this on the

1962
01:11:55,440 --> 01:11:57,600
network on the elt network now this also

1963
01:11:57,600 --> 01:11:59,880
needs to change so this is going to be

1964
01:11:59,880 --> 01:12:02,280
destination ZB we'll keep user and

1965
01:12:02,280 --> 01:12:04,120
password the same and we actually don't

1966
01:12:04,120 --> 01:12:07,280
want any volume section here why because

1967
01:12:07,280 --> 01:12:08,960
we don't want to save the data every

1968
01:12:08,960 --> 01:12:11,360
single time for testing purposes I want

1969
01:12:11,360 --> 01:12:13,320
to make sure that the elt script runs

1970
01:12:13,320 --> 01:12:15,440
every single time successfully and so if

1971
01:12:15,440 --> 01:12:17,199
the data persists I can't confirm or

1972
01:12:17,199 --> 01:12:19,679
deny that the elt script is actually

1973
01:12:19,679 --> 01:12:21,320
working so that every single time we

1974
01:12:21,320 --> 01:12:23,239
kill this Docker container I want the

1975
01:12:23,239 --> 01:12:25,000
data to vanish so that's what we're

1976
01:12:25,000 --> 01:12:26,560
doing here for the next service and the

1977
01:12:26,560 --> 01:12:27,960
last one we're going to do for this

1978
01:12:27,960 --> 01:12:30,040
section is going to be the elt script

1979
01:12:30,040 --> 01:12:32,239
now why do we need to create one here

1980
01:12:32,239 --> 01:12:34,280
well we need to create one in order for

1981
01:12:34,280 --> 01:12:36,199
Docker to see that we're actually

1982
01:12:36,199 --> 01:12:39,159
utilizing a script here to send data

1983
01:12:39,159 --> 01:12:40,800
from the source and destination

1984
01:12:40,800 --> 01:12:42,880
databases so we actually have to use

1985
01:12:42,880 --> 01:12:44,560
Docker for this and use it for the

1986
01:12:44,560 --> 01:12:47,520
runtime to actually run the script

1987
01:12:47,520 --> 01:12:49,040
itself instead of us having to manually

1988
01:12:49,040 --> 01:12:51,239
do it so what we're going to do here is

1989
01:12:51,239 --> 01:12:54,600
utilize the manual Docker files at the

1990
01:12:54,600 --> 01:12:58,199
same time of using Docker compos there's

1991
01:12:58,199 --> 01:13:00,239
different reasons for for doing this I

1992
01:13:00,239 --> 01:13:01,960
think it's just easier to run certain

1993
01:13:01,960 --> 01:13:03,840
commands utilizing it this way and we'll

1994
01:13:03,840 --> 01:13:05,560
actually see what what this is doing so

1995
01:13:05,560 --> 01:13:06,639
it's going to look a little different so

1996
01:13:06,639 --> 01:13:08,239
we're going to say build under the build

1997
01:13:08,239 --> 01:13:10,360
property we're going to add some context

1998
01:13:10,360 --> 01:13:12,120
uh and the context is essentially what

1999
01:13:12,120 --> 01:13:14,199
file we're we're building off of and so

2000
01:13:14,199 --> 01:13:17,440
we're going to say ltor script inside of

2001
01:13:17,440 --> 01:13:19,480
the root folder so uh it's going to be

2002
01:13:19,480 --> 01:13:21,040
here and it's going to be root in

2003
01:13:21,040 --> 01:13:22,760
reference to where the docker file is

2004
01:13:22,760 --> 01:13:24,400
and we're just going to say Docker file

2005
01:13:24,400 --> 01:13:26,600
but I'm going to Capital I the D here um

2006
01:13:26,600 --> 01:13:28,000
cuz that's what I'm going to do when we

2007
01:13:28,000 --> 01:13:29,719
create it now the command we're going to

2008
01:13:29,719 --> 01:13:32,639
run I think that's changed it the

2009
01:13:32,639 --> 01:13:34,360
command we're going to run and we're

2010
01:13:34,360 --> 01:13:35,960
going to put this in early brackets

2011
01:13:35,960 --> 01:13:37,480
we're going to say python since this is

2012
01:13:37,480 --> 01:13:39,600
a python file and then

2013
01:13:39,600 --> 01:13:41,320
eltor

2014
01:13:41,320 --> 01:13:44,719
script same thing with the networks so

2015
01:13:44,719 --> 01:13:47,360
we're going to say networks and then _

2016
01:13:47,360 --> 01:13:49,120
Network there now this is going to be

2017
01:13:49,120 --> 01:13:50,880
one thing that we learned in Docker so

2018
01:13:50,880 --> 01:13:53,400
the depends on property here is that

2019
01:13:53,400 --> 01:13:55,360
this container depends on other

2020
01:13:55,360 --> 01:13:57,320
containers and so if it has any

2021
01:13:57,320 --> 01:13:59,159
dependencies this container won't

2022
01:13:59,159 --> 01:14:01,600
initialize until the other containers it

2023
01:14:01,600 --> 01:14:04,040
depends on are finished building and so

2024
01:14:04,040 --> 01:14:06,320
if I say this depends on both the source

2025
01:14:06,320 --> 01:14:08,280
as well as the

2026
01:14:08,280 --> 01:14:11,280
destination services this script will

2027
01:14:11,280 --> 01:14:14,120
not run until these two are finished

2028
01:14:14,120 --> 01:14:15,920
initializing in which it does take time

2029
01:14:15,920 --> 01:14:17,560
which would make sense right because we

2030
01:14:17,560 --> 01:14:19,320
need to initialize the destination

2031
01:14:19,320 --> 01:14:22,679
database because there is no way for us

2032
01:14:22,679 --> 01:14:24,840
to move data if there is no data in here

2033
01:14:24,840 --> 01:14:26,960
yet and this isn't even ready we don't

2034
01:14:26,960 --> 01:14:28,360
want the script to run or else we're

2035
01:14:28,360 --> 01:14:30,239
going to run into a lot of errors here

2036
01:14:30,239 --> 01:14:33,280
so this is exactly why I wanted to use a

2037
01:14:33,280 --> 01:14:34,840
Docker container for the elt script so

2038
01:14:34,840 --> 01:14:36,679
that way we can control the way that it

2039
01:14:36,679 --> 01:14:38,719
functions so now that we have this going

2040
01:14:38,719 --> 01:14:40,080
on we're going to create a new file here

2041
01:14:40,080 --> 01:14:42,080
we're going to say Docker file just like

2042
01:14:42,080 --> 01:14:43,960
we said and now within the docker file

2043
01:14:43,960 --> 01:14:45,159
this is where we're going to specify a

2044
01:14:45,159 --> 01:14:47,159
couple things so obviously the structure

2045
01:14:47,159 --> 01:14:48,920
is going to look a little different here

2046
01:14:48,920 --> 01:14:51,679
but from is going to be the actual image

2047
01:14:51,679 --> 01:14:54,600
we want to use so we're going to say 3.8

2048
01:14:54,600 --> 01:14:55,639
h

2049
01:14:55,639 --> 01:14:58,080
slim is going to be the first one that

2050
01:14:58,080 --> 01:14:59,840
we're going to use here now what we want

2051
01:14:59,840 --> 01:15:02,040
to do is we want to install postest with

2052
01:15:02,040 --> 01:15:03,840
some command line tools so we're going

2053
01:15:03,840 --> 01:15:07,159
to say run um and apt get since it's

2054
01:15:07,159 --> 01:15:09,560
running off of Linux apt get update and

2055
01:15:09,560 --> 01:15:14,760
and apt get install y

2056
01:15:14,760 --> 01:15:16,639
postgress so that's going to install the

2057
01:15:16,639 --> 01:15:18,840
postgress client there we're also going

2058
01:15:18,840 --> 01:15:20,760
to copy so we're going to copy the

2059
01:15:20,760 --> 01:15:22,679
contents of the actual elt script so

2060
01:15:22,679 --> 01:15:24,719
that the docker container has access to

2061
01:15:24,719 --> 01:15:27,960
it and so we're going to say elt or

2062
01:15:27,960 --> 01:15:30,280
script.py this so make sure you have

2063
01:15:30,280 --> 01:15:31,920
that period at the end and then the

2064
01:15:31,920 --> 01:15:34,000
command we're going to run is again

2065
01:15:34,000 --> 01:15:35,880
python

2066
01:15:35,880 --> 01:15:38,560
_ so that is going to be the structure

2067
01:15:38,560 --> 01:15:40,400
here now the next thing we're going to

2068
01:15:40,400 --> 01:15:43,639
do is actually create our source

2069
01:15:43,639 --> 01:15:45,560
destination and initialize it with some

2070
01:15:45,560 --> 01:15:47,159
data so let's go ahead and do that so if

2071
01:15:47,159 --> 01:15:50,040
you go over to the repo of the custom

2072
01:15:50,040 --> 01:15:51,360
elt project you're going to see this

2073
01:15:51,360 --> 01:15:53,360
folder called sourcecore

2074
01:15:53,360 --> 01:15:56,239
dbor nit now now what this is primarily

2075
01:15:56,239 --> 01:15:59,080
holding is a SQL file that contains all

2076
01:15:59,080 --> 01:16:00,480
fake data so we're going to create a

2077
01:16:00,480 --> 01:16:03,159
couple tables and then insert values

2078
01:16:03,159 --> 01:16:04,639
into them so that's exactly what we're

2079
01:16:04,639 --> 01:16:06,440
going to go do so let me go back and

2080
01:16:06,440 --> 01:16:08,520
switch I'm going to create a new folder

2081
01:16:08,520 --> 01:16:10,960
and we're going to name it Source dbor

2082
01:16:10,960 --> 01:16:12,760
init as we just saw inside of there I'm

2083
01:16:12,760 --> 01:16:15,560
going to do init SQL and if you remember

2084
01:16:15,560 --> 01:16:17,600
it's exactly what we did here so we're

2085
01:16:17,600 --> 01:16:21,719
pointing that exact file over into this

2086
01:16:21,719 --> 01:16:23,719
directory of the container so that we

2087
01:16:23,719 --> 01:16:25,159
have access to it we're creating a a

2088
01:16:25,159 --> 01:16:28,920
mapping of this over into the docker

2089
01:16:28,920 --> 01:16:30,199
container so that way we can actually

2090
01:16:30,199 --> 01:16:32,520
run the commands to initialize the

2091
01:16:32,520 --> 01:16:34,920
source database from there now inside of

2092
01:16:34,920 --> 01:16:36,400
this what we're going to do is just go

2093
01:16:36,400 --> 01:16:38,600
in here and copy I believe I can just

2094
01:16:38,600 --> 01:16:40,920
copy everything here and paste it so

2095
01:16:40,920 --> 01:16:42,199
that's exactly what you're going to do

2096
01:16:42,199 --> 01:16:43,800
just make sure you have access to this

2097
01:16:43,800 --> 01:16:45,239
copy everything that you see inside the

2098
01:16:45,239 --> 01:16:46,960
folder so we can save some time going to

2099
01:16:46,960 --> 01:16:49,239
create a couple tables and insert some

2100
01:16:49,239 --> 01:16:50,600
fake data for us like I mentioned we're

2101
01:16:50,600 --> 01:16:52,639
going to save that and now we can

2102
01:16:52,639 --> 01:16:55,040
actually go about running this and and

2103
01:16:55,040 --> 01:16:56,760
creating everything so the way to do

2104
01:16:56,760 --> 01:16:58,400
that is going to be inside of our elt

2105
01:16:58,400 --> 01:17:01,000
script so let's fill out elt script now

2106
01:17:01,000 --> 01:17:02,880
all right so we are in our elt script

2107
01:17:02,880 --> 01:17:04,120
here and there's a couple things that

2108
01:17:04,120 --> 01:17:05,920
we're going to import so we're going to

2109
01:17:05,920 --> 01:17:08,360
import the subprocess first so this is

2110
01:17:08,360 --> 01:17:10,400
how we're allowing to control inputs and

2111
01:17:10,400 --> 01:17:12,400
outputs and things like that we're also

2112
01:17:12,400 --> 01:17:14,400
going to import time um this is going to

2113
01:17:14,400 --> 01:17:16,280
be make sense a little bit later but the

2114
01:17:16,280 --> 01:17:18,280
first thing we want to do is obviously

2115
01:17:18,280 --> 01:17:19,880
double check and I know that the docker

2116
01:17:19,880 --> 01:17:22,920
composed file checks to make sure that

2117
01:17:22,920 --> 01:17:25,199
the elt script will not run un unless

2118
01:17:25,199 --> 01:17:27,159
the source and the destination database

2119
01:17:27,159 --> 01:17:28,639
are working but we can also run a

2120
01:17:28,639 --> 01:17:30,199
fallback just in case so we're going to

2121
01:17:30,199 --> 01:17:33,080
create this function here called weight

2122
01:17:33,080 --> 01:17:35,960
_ 4ore postgress and uh some of the

2123
01:17:35,960 --> 01:17:37,080
variables we need are going to be the

2124
01:17:37,080 --> 01:17:40,040
host we're going to need the maxcore

2125
01:17:40,040 --> 01:17:42,280
retries the default value here is going

2126
01:17:42,280 --> 01:17:45,080
to be five delay in seconds we're going

2127
01:17:45,080 --> 01:17:47,600
to leave at five so after that what goes

2128
01:17:47,600 --> 01:17:49,639
inside this function uh we're going to

2129
01:17:49,639 --> 01:17:50,639
say

2130
01:17:50,639 --> 01:17:53,639
retries is zero while retries is less

2131
01:17:53,639 --> 01:17:55,400
than Max retries

2132
01:17:55,400 --> 01:17:59,760
we are going to say try results equals

2133
01:17:59,760 --> 01:18:03,120
subprocess run and then in here we're

2134
01:18:03,120 --> 01:18:04,920
going to say

2135
01:18:04,920 --> 01:18:10,560
PG is ready this say hyphen H going to

2136
01:18:10,560 --> 01:18:13,840
post here check equals true now this is

2137
01:18:13,840 --> 01:18:16,719
all going to be correlated to postest

2138
01:18:16,719 --> 01:18:20,400
directly capture output true and then

2139
01:18:20,400 --> 01:18:23,679
the text is true there a couple checks

2140
01:18:23,679 --> 01:18:26,239
here right I think I forgot something

2141
01:18:26,239 --> 01:18:27,920
here move this over and then we're also

2142
01:18:27,920 --> 01:18:29,800
going to put an if condition here if

2143
01:18:29,800 --> 01:18:32,199
accepting connections so obviously we're

2144
01:18:32,199 --> 01:18:34,920
pinging the actual database itself to

2145
01:18:34,920 --> 01:18:36,679
make sure that it's ready to go or if it

2146
01:18:36,679 --> 01:18:38,239
is accepting connections we're going to

2147
01:18:38,239 --> 01:18:42,120
say print successfully uh connected to

2148
01:18:42,120 --> 01:18:44,120
postest and then we're also going to

2149
01:18:44,120 --> 01:18:48,880
return true here and accept subprocess

2150
01:18:48,880 --> 01:18:53,800
do called process error as e we're going

2151
01:18:53,800 --> 01:18:55,880
to say print

2152
01:18:55,880 --> 01:19:00,400
and F error connecting to post address

2153
01:19:00,400 --> 01:19:03,199
colon here I'm going to use that F here

2154
01:19:03,199 --> 01:19:06,159
or sorry e for the error oh this to be

2155
01:19:06,159 --> 01:19:07,480
inside

2156
01:19:07,480 --> 01:19:09,800
retries if it errors we're going to add

2157
01:19:09,800 --> 01:19:12,400
one to the retry plus equals 1 also

2158
01:19:12,400 --> 01:19:13,880
going to add another print statement

2159
01:19:13,880 --> 01:19:17,000
here and we're going to say f retrying

2160
01:19:17,000 --> 01:19:19,920
in play seconds

2161
01:19:19,920 --> 01:19:23,280
attempt rri this is all just for logging

2162
01:19:23,280 --> 01:19:25,360
here and then Mac r

2163
01:19:25,360 --> 01:19:29,120
eyes here see where this isue here

2164
01:19:29,120 --> 01:19:30,600
outside of the print we're going to say

2165
01:19:30,600 --> 01:19:35,280
time do sleep delay seconds and then

2166
01:19:35,280 --> 01:19:39,840
outside of the accept print Max retries

2167
01:19:39,840 --> 01:19:43,320
reached exiting in case all else fails

2168
01:19:43,320 --> 01:19:44,679
and then we're going to return false

2169
01:19:44,679 --> 01:19:46,440
Okay cool so that is going to be our

2170
01:19:46,440 --> 01:19:48,520
check function here so I know that was a

2171
01:19:48,520 --> 01:19:52,560
lot but we tries spelled that wrong both

2172
01:19:52,560 --> 01:19:56,360
times all good okay that fix it well now

2173
01:19:56,360 --> 01:19:58,480
we don't have any weird Squigly now

2174
01:19:58,480 --> 01:20:00,280
we're going to get into actually

2175
01:20:00,280 --> 01:20:02,719
building out the initialization of the

2176
01:20:02,719 --> 01:20:04,159
source database and then moving on to

2177
01:20:04,159 --> 01:20:05,920
the destination well we can also add

2178
01:20:05,920 --> 01:20:07,840
this so we're going to say if not wait

2179
01:20:07,840 --> 01:20:11,679
uh underscore 4ore postgress post equals

2180
01:20:11,679 --> 01:20:14,040
sourcecore postgress then we're going to

2181
01:20:14,040 --> 01:20:16,960
say exit with the eror with code one

2182
01:20:16,960 --> 01:20:21,440
print um starting elt script well now we

2183
01:20:21,440 --> 01:20:23,080
can actually do this so uh we're going

2184
01:20:23,080 --> 01:20:25,159
to say sourcecore config

2185
01:20:25,159 --> 01:20:27,239
open this object here and so the first

2186
01:20:27,239 --> 01:20:29,040
thing we need to specify is going to be

2187
01:20:29,040 --> 01:20:30,920
the DB name and we're going to be using

2188
01:20:30,920 --> 01:20:32,520
dump files here if you're familiar with

2189
01:20:32,520 --> 01:20:34,679
postgress we can use dump files to

2190
01:20:34,679 --> 01:20:36,760
initialize the actual database but also

2191
01:20:36,760 --> 01:20:39,320
use those and dump files into the

2192
01:20:39,320 --> 01:20:40,840
destination so that's exactly how we're

2193
01:20:40,840 --> 01:20:42,840
going to be using this batch script here

2194
01:20:42,840 --> 01:20:45,719
for our elt and so we're going to say uh

2195
01:20:45,719 --> 01:20:48,280
Source DB is going to be the name of our

2196
01:20:48,280 --> 01:20:51,360
DB name it's actually not a uh sign it's

2197
01:20:51,360 --> 01:20:54,080
going to be that and then uh let me add

2198
01:20:54,080 --> 01:20:56,679
our here same thing here so we're going

2199
01:20:56,679 --> 01:20:58,639
to say user is going to be what we

2200
01:20:58,639 --> 01:21:00,480
specified so these are all information

2201
01:21:00,480 --> 01:21:03,239
that we had in the docker compos file

2202
01:21:03,239 --> 01:21:05,280
this is going to be the password um and

2203
01:21:05,280 --> 01:21:07,960
then the password was secret now for

2204
01:21:07,960 --> 01:21:10,199
this next one we're going to say host

2205
01:21:10,199 --> 01:21:12,280
now the host should be the name of the

2206
01:21:12,280 --> 01:21:14,920
service uh that we put inside of the

2207
01:21:14,920 --> 01:21:16,520
dock compost file so we're going to say

2208
01:21:16,520 --> 01:21:18,080
sourcecore poost that is going to be the

2209
01:21:18,080 --> 01:21:19,679
source config now we're going to do the

2210
01:21:19,679 --> 01:21:22,320
exact same thing for the destination

2211
01:21:22,320 --> 01:21:25,800
config DB name is

2212
01:21:25,800 --> 01:21:29,920
destination DB username is if I can type

2213
01:21:29,920 --> 01:21:32,920
properly post address password is going

2214
01:21:32,920 --> 01:21:35,920
to secret as well and then the host is

2215
01:21:35,920 --> 01:21:39,480
going to destination underscore this

2216
01:21:39,480 --> 01:21:42,639
destination yep no typos there perfect

2217
01:21:42,639 --> 01:21:45,719
now we need to create the dump command

2218
01:21:45,719 --> 01:21:47,920
for initializing The Source data so

2219
01:21:47,920 --> 01:21:49,600
underneath here we're going to say dump

2220
01:21:49,600 --> 01:21:52,239
uncore command we're going to say PG

2221
01:21:52,239 --> 01:21:54,679
uncore dump which is the command here

2222
01:21:54,679 --> 01:21:57,480
that we're going to use um the H flag

2223
01:21:57,480 --> 01:22:00,480
hyphen H we'll use the sourcecore config

2224
01:22:00,480 --> 01:22:01,920
and we're going to point to the host

2225
01:22:01,920 --> 01:22:04,480
since that's our host um let me make

2226
01:22:04,480 --> 01:22:08,280
sure that this has a comma for the user

2227
01:22:08,280 --> 01:22:09,639
so we're going to say hyphen you we're

2228
01:22:09,639 --> 01:22:11,400
going to say Source config and we're

2229
01:22:11,400 --> 01:22:13,239
going to point it to user so you can see

2230
01:22:13,239 --> 01:22:14,920
kind of what we're mapping each

2231
01:22:14,920 --> 01:22:17,920
individual flag so the host user

2232
01:22:17,920 --> 01:22:20,440
password all that stuff too so we're

2233
01:22:20,440 --> 01:22:23,040
going to also do hyphen D for the

2234
01:22:23,040 --> 01:22:24,520
database name and we're going to point

2235
01:22:24,520 --> 01:22:28,159
point to sourcecore config Dame hyphen f

2236
01:22:28,159 --> 01:22:29,719
is going to be the file that we're going

2237
01:22:29,719 --> 01:22:31,560
to use and where we're pointing that is

2238
01:22:31,560 --> 01:22:34,600
going to be data uncore dump needs to be

2239
01:22:34,600 --> 01:22:35,840
single quotes

2240
01:22:35,840 --> 01:22:37,760
dataor

2241
01:22:37,760 --> 01:22:41,239
dump. if we add this flag high and W it

2242
01:22:41,239 --> 01:22:42,679
will not prompt us for the password

2243
01:22:42,679 --> 01:22:44,199
which we don't have to do every single

2244
01:22:44,199 --> 01:22:46,159
time which is nice so the other thing

2245
01:22:46,159 --> 01:22:47,840
too is we're going to set the

2246
01:22:47,840 --> 01:22:49,360
environment variable to avoid the

2247
01:22:49,360 --> 01:22:50,800
password dump so we're going to say

2248
01:22:50,800 --> 01:22:55,560
subprocessor EnV equals di uh PG

2249
01:22:55,560 --> 01:22:59,560
password equals sourcecore config

2250
01:22:59,560 --> 01:23:01,920
password so now we we've created a

2251
01:23:01,920 --> 01:23:04,280
password RPG password environment

2252
01:23:04,280 --> 01:23:05,840
variable that will not ask us for the

2253
01:23:05,840 --> 01:23:07,600
password every single time now we're

2254
01:23:07,600 --> 01:23:09,120
going to execute this dump command so

2255
01:23:09,120 --> 01:23:11,760
we're going to say subprocess dot run

2256
01:23:11,760 --> 01:23:13,440
dump command which is the one we just

2257
01:23:13,440 --> 01:23:14,800
created point it to the environment

2258
01:23:14,800 --> 01:23:16,320
variable that we just created so

2259
01:23:16,320 --> 01:23:19,040
subprocessor EnV and then check equals

2260
01:23:19,040 --> 01:23:21,120
true so that's going to dump everything

2261
01:23:21,120 --> 01:23:23,840
into the source database now we actually

2262
01:23:23,840 --> 01:23:25,800
need to get everything from the source

2263
01:23:25,800 --> 01:23:28,360
database over to the destination so

2264
01:23:28,360 --> 01:23:31,760
we're going to create a load command and

2265
01:23:31,760 --> 01:23:34,000
it's going to look pretty much identical

2266
01:23:34,000 --> 01:23:37,400
to this so what I'm going to do is copy

2267
01:23:37,400 --> 01:23:39,199
and paste everything here but we're

2268
01:23:39,199 --> 01:23:40,639
going to make some slight modifications

2269
01:23:40,639 --> 01:23:43,080
so instead of PG dump we're going to say

2270
01:23:43,080 --> 01:23:44,760
psql so we're actually going to get into

2271
01:23:44,760 --> 01:23:47,320
the SQL command line tool we're going to

2272
01:23:47,320 --> 01:23:49,199
point it to the host but instead of

2273
01:23:49,199 --> 01:23:50,960
source it needs to be destination the

2274
01:23:50,960 --> 01:23:54,440
user is also the same so we need to

2275
01:23:54,440 --> 01:23:57,800
point it to the destination database

2276
01:23:57,800 --> 01:24:00,350
name is going to be the

2277
01:24:00,350 --> 01:24:02,199
[Music]

2278
01:24:02,199 --> 01:24:05,440
same now we need to or well we don't

2279
01:24:05,440 --> 01:24:06,800
need this since we're not pointing it to

2280
01:24:06,800 --> 01:24:09,199
a file well we do what we're actually

2281
01:24:09,199 --> 01:24:11,400
going to do is concatenate this so we're

2282
01:24:11,400 --> 01:24:13,880
going to put two commands here we're

2283
01:24:13,880 --> 01:24:17,040
going to do hyphen a comma F we're going

2284
01:24:17,040 --> 01:24:19,159
to delete the W uh and then we're still

2285
01:24:19,159 --> 01:24:22,400
pointing it to the data. dump. SQL file

2286
01:24:22,400 --> 01:24:24,760
now we're going to do the same

2287
01:24:24,760 --> 01:24:27,320
environment variable with

2288
01:24:27,320 --> 01:24:29,639
subprocessor EnV

2289
01:24:29,639 --> 01:24:32,239
equals we're actually copy and paste

2290
01:24:32,239 --> 01:24:34,360
this over again cuz I mean it's

2291
01:24:34,360 --> 01:24:37,199
literally the exact same thing except

2292
01:24:37,199 --> 01:24:39,880
we're going to be using the destination

2293
01:24:39,880 --> 01:24:43,280
here destination config now we need to

2294
01:24:43,280 --> 01:24:45,639
execute the load command um so what

2295
01:24:45,639 --> 01:24:47,320
we're going to do is we're going to say

2296
01:24:47,320 --> 01:24:51,480
subprocess do run load command EnV is

2297
01:24:51,480 --> 01:24:54,719
going to equal subprocessor EnV and then

2298
01:24:54,719 --> 01:24:56,760
we're going to do the check equals true

2299
01:24:56,760 --> 01:24:59,320
again and we're going to print just for

2300
01:24:59,320 --> 01:25:04,840
our own purposes ending elt script cool

2301
01:25:04,840 --> 01:25:08,400
so now this is going to be our full on

2302
01:25:08,400 --> 01:25:12,080
elt script now how do we run this well

2303
01:25:12,080 --> 01:25:14,719
what we're going to do is use Docker to

2304
01:25:14,719 --> 01:25:16,639
completely run everything here so let's

2305
01:25:16,639 --> 01:25:17,760
go ahead and take a look at what that

2306
01:25:17,760 --> 01:25:20,360
looks like because we've made everything

2307
01:25:20,360 --> 01:25:22,600
and hooked everything up with Docker

2308
01:25:22,600 --> 01:25:25,239
compos it's going to be a simple as this

2309
01:25:25,239 --> 01:25:27,199
all we have to do inside of our terminal

2310
01:25:27,199 --> 01:25:29,119
obviously make sure that we're in the

2311
01:25:29,119 --> 01:25:30,960
directory that we created I'm going to

2312
01:25:30,960 --> 01:25:34,199
run Docker compose up uh I forgot to do

2313
01:25:34,199 --> 01:25:36,760
this so I forgot to change the host to

2314
01:25:36,760 --> 01:25:38,440
postgress here um let me make sure

2315
01:25:38,440 --> 01:25:40,679
that's that okay so I had a slight error

2316
01:25:40,679 --> 01:25:42,080
but all we have to do is we're going to

2317
01:25:42,080 --> 01:25:45,239
do Docker compose up what Docker compose

2318
01:25:45,239 --> 01:25:47,639
all services. Source oh does it not need

2319
01:25:47,639 --> 01:25:49,960
this uh I might have screwed up here

2320
01:25:49,960 --> 01:25:52,560
again which is fine we all make mistakes

2321
01:25:52,560 --> 01:25:54,840
so it doesn't actually need this

2322
01:25:54,840 --> 01:25:57,880
section here uh let's see if that will

2323
01:25:57,880 --> 01:25:59,840
fix it we're going to leave this in here

2324
01:25:59,840 --> 01:26:01,639
all we're running into a couple things

2325
01:26:01,639 --> 01:26:05,080
here so _ script so let's do let's just

2326
01:26:05,080 --> 01:26:08,840
debug this live cuz why not/ scripts so

2327
01:26:08,840 --> 01:26:11,000
this should just be elt I pretty sure

2328
01:26:11,000 --> 01:26:13,000
there you go okay so just a couple

2329
01:26:13,000 --> 01:26:14,960
errors here but hey nothing that's going

2330
01:26:14,960 --> 01:26:16,560
to shake us up but so now that we've run

2331
01:26:16,560 --> 01:26:17,880
Docker compose up we're actually going

2332
01:26:17,880 --> 01:26:20,440
to go through and build out the images

2333
01:26:20,440 --> 01:26:22,199
so we're pulling down from the docker

2334
01:26:22,199 --> 01:26:25,119
compos or from Docker Hub to to uh build

2335
01:26:25,119 --> 01:26:27,159
out these images so now what we can see

2336
01:26:27,159 --> 01:26:28,560
is we might be running into something

2337
01:26:28,560 --> 01:26:30,760
here but as you can see in the logs and

2338
01:26:30,760 --> 01:26:31,840
let me pull this over so you can

2339
01:26:31,840 --> 01:26:34,719
actually see it so through the logs what

2340
01:26:34,719 --> 01:26:38,239
we've done is we have we've initialized

2341
01:26:38,239 --> 01:26:40,880
the destination database and the source

2342
01:26:40,880 --> 01:26:43,239
database which is good and then we've

2343
01:26:43,239 --> 01:26:45,119
also created the database we've inserted

2344
01:26:45,119 --> 01:26:47,360
a couple tables and then the values for

2345
01:26:47,360 --> 01:26:49,440
them but it looks like we ran into an

2346
01:26:49,440 --> 01:26:52,280
issue with the elt script uh starting

2347
01:26:52,280 --> 01:26:53,920
elt script so it looks like that was

2348
01:26:53,920 --> 01:26:56,239
good Trace back on line

2349
01:26:56,239 --> 01:26:58,680
54

2350
01:26:58,680 --> 01:27:01,280
[Music]

2351
01:27:01,280 --> 01:27:04,679
uh okay so let's look at our PG script

2352
01:27:04,679 --> 01:27:06,719
so you can kind of see like all the

2353
01:27:06,719 --> 01:27:08,480
little nuances here with creating a

2354
01:27:08,480 --> 01:27:11,000
batch script and like this is on purpose

2355
01:27:11,000 --> 01:27:13,000
uh I I wanted to make sure that we ran

2356
01:27:13,000 --> 01:27:14,760
into some issues here I mean obviously I

2357
01:27:14,760 --> 01:27:17,119
would like to not run into issues but

2358
01:27:17,119 --> 01:27:18,920
comes with coding comes with building

2359
01:27:18,920 --> 01:27:20,960
out these things manually uh and we'll

2360
01:27:20,960 --> 01:27:22,800
see that it gets a little bit easier to

2361
01:27:22,800 --> 01:27:24,840
deal with later down the line

2362
01:27:24,840 --> 01:27:27,360
um so on line 54 is when it said that we

2363
01:27:27,360 --> 01:27:29,440
had a bug here so subprocess run dump

2364
01:27:29,440 --> 01:27:33,159
command I think this should be a i u or

2365
01:27:33,159 --> 01:27:35,159
capital u here go ahead and try this one

2366
01:27:35,159 --> 01:27:37,040
more time so what we're going to do is

2367
01:27:37,040 --> 01:27:39,440
Docker compose

2368
01:27:39,440 --> 01:27:42,440
down type oh my God okay so the source

2369
01:27:42,440 --> 01:27:44,199
is ready to connect still running into

2370
01:27:44,199 --> 01:27:47,360
an issue here um on the subprocess still

2371
01:27:47,360 --> 01:27:48,400
on line

2372
01:27:48,400 --> 01:27:51,199
54 so we've started the elt script

2373
01:27:51,199 --> 01:27:53,600
return nonzero exit status let's try

2374
01:27:53,600 --> 01:27:55,400
without the chck back here that's not it

2375
01:27:55,400 --> 01:27:59,960
DB name sourcecore DB post you got

2376
01:27:59,960 --> 01:28:03,960
secret Source postgress

2377
01:28:03,960 --> 01:28:07,159
destination for postgress okay so I've

2378
01:28:07,159 --> 01:28:09,159
deleted the image on Docker let's try

2379
01:28:09,159 --> 01:28:11,639
running this one more time let's build

2380
01:28:11,639 --> 01:28:15,119
the image again and see if it fixes it e

2381
01:28:15,119 --> 01:28:18,400
error oh I see the issue okay so I screw

2382
01:28:18,400 --> 01:28:20,119
that up I think that should be good now

2383
01:28:20,119 --> 01:28:24,639
so let's Docker comos down again dock ER

2384
01:28:24,639 --> 01:28:27,719
compose up just a casual typo error here

2385
01:28:27,719 --> 01:28:29,560
I believe it's still not going to work

2386
01:28:29,560 --> 01:28:31,960
here cuz I think it's still read the old

2387
01:28:31,960 --> 01:28:34,400
one so what I'm going to do is kill this

2388
01:28:34,400 --> 01:28:36,600
Docker compose up or sorry Docker

2389
01:28:36,600 --> 01:28:38,840
compose down rid of these now let's go

2390
01:28:38,840 --> 01:28:41,000
into Docker and you can see kind of like

2391
01:28:41,000 --> 01:28:42,800
what the troubleshooting so we built

2392
01:28:42,800 --> 01:28:44,119
this image and I don't think it's

2393
01:28:44,119 --> 01:28:46,880
changed it so I'm going to delete that

2394
01:28:46,880 --> 01:28:48,880
um we're going to go back into the

2395
01:28:48,880 --> 01:28:53,560
terminal here say Docker compos up so

2396
01:28:53,560 --> 01:28:56,080
we're going to re build the image and it

2397
01:28:56,080 --> 01:28:58,840
should there we go okay so now you can

2398
01:28:58,840 --> 01:29:00,159
see after some troubleshooting and then

2399
01:29:00,159 --> 01:29:02,600
some small typos here and there uh we

2400
01:29:02,600 --> 01:29:03,560
have

2401
01:29:03,560 --> 01:29:06,000
successfully gotten our logs back and

2402
01:29:06,000 --> 01:29:08,159
then at the end we had our ending elt

2403
01:29:08,159 --> 01:29:11,080
script so the way to check our work now

2404
01:29:11,080 --> 01:29:13,159
is if we open a new terminal let me make

2405
01:29:13,159 --> 01:29:15,000
this a little bit bigger let go back

2406
01:29:15,000 --> 01:29:17,920
into our other directory so CDT I'm

2407
01:29:17,920 --> 01:29:19,679
going to say Docker exact and this is

2408
01:29:19,679 --> 01:29:21,119
from what we learned in the other

2409
01:29:21,119 --> 01:29:23,520
tutorial on Docker so Docker exact and

2410
01:29:23,520 --> 01:29:25,760
we're going to use the interactive flag

2411
01:29:25,760 --> 01:29:30,320
here uh we're going to grab the name of

2412
01:29:30,320 --> 01:29:34,520
our _ script one so I believe the full

2413
01:29:34,520 --> 01:29:37,000
name of it should be this so we're going

2414
01:29:37,000 --> 01:29:38,920
to grab I'm sorry we're not grabbing

2415
01:29:38,920 --> 01:29:41,280
this we want to grab the destination

2416
01:29:41,280 --> 01:29:43,840
name so we're going to grab _ postgress

2417
01:29:43,840 --> 01:29:46,000
one so that's going to be the name then

2418
01:29:46,000 --> 01:29:48,600
we're going to say psql we want to run

2419
01:29:48,600 --> 01:29:50,159
the command line the postgress command

2420
01:29:50,159 --> 01:29:53,119
line hyphen you with the user postgress

2421
01:29:53,119 --> 01:29:54,600
now if I hit enter we're going to be in

2422
01:29:54,600 --> 01:29:56,800
here the one thing we do need to do is

2423
01:29:56,800 --> 01:30:00,560
we're going to say/ C for connect do the

2424
01:30:00,560 --> 01:30:03,320
destination DB so now we can see that we

2425
01:30:03,320 --> 01:30:05,760
are in the destination database now if I

2426
01:30:05,760 --> 01:30:08,560
do slash this is back slash by the way

2427
01:30:08,560 --> 01:30:11,679
or forward forward slash I think uh is/

2428
01:30:11,679 --> 01:30:14,199
DT you can see that all of the tables

2429
01:30:14,199 --> 01:30:16,520
are now inside of the destination

2430
01:30:16,520 --> 01:30:19,520
database now if I do select all from

2431
01:30:19,520 --> 01:30:21,520
actors now I need to add the semicolon

2432
01:30:21,520 --> 01:30:23,040
you can see that all the data that we

2433
01:30:23,040 --> 01:30:25,080
inserted into the Source database is now

2434
01:30:25,080 --> 01:30:27,360
into the destination database this is

2435
01:30:27,360 --> 01:30:30,199
now fully working it is not automated at

2436
01:30:30,199 --> 01:30:33,040
all but you can see that our bat script

2437
01:30:33,040 --> 01:30:34,960
is now successfully working just by

2438
01:30:34,960 --> 01:30:36,760
simply taking the dump commands that are

2439
01:30:36,760 --> 01:30:38,840
built into postgress and then moving

2440
01:30:38,840 --> 01:30:42,159
those in to the destination database now

2441
01:30:42,159 --> 01:30:43,880
this is postest to postest so this is

2442
01:30:43,880 --> 01:30:45,719
very very simple but you can see that

2443
01:30:45,719 --> 01:30:47,639
even this is a very basic script but

2444
01:30:47,639 --> 01:30:49,920
there's a lot of moving Parts when it

2445
01:30:49,920 --> 01:30:52,199
comes to building out a script manually

2446
01:30:52,199 --> 01:30:53,600
and so when things change or if you're

2447
01:30:53,600 --> 01:30:56,000
trying to connect postgress over into

2448
01:30:56,000 --> 01:30:57,760
let's say another database type where

2449
01:30:57,760 --> 01:30:59,480
you potentially have to match schema and

2450
01:30:59,480 --> 01:31:01,159
things like that in this case we didn't

2451
01:31:01,159 --> 01:31:02,840
have to worry about that because the

2452
01:31:02,840 --> 01:31:04,199
same database same protocol and

2453
01:31:04,199 --> 01:31:05,360
everything but if we're working with

2454
01:31:05,360 --> 01:31:07,360
something else it can get very very

2455
01:31:07,360 --> 01:31:09,719
tricky so that's why we're going to be

2456
01:31:09,719 --> 01:31:11,080
implementing a lot more open source

2457
01:31:11,080 --> 01:31:13,119
tooling but for this next part we're

2458
01:31:13,119 --> 01:31:15,520
actually going to add a Cron job to this

2459
01:31:15,520 --> 01:31:17,719
to automate the script a little bit

2460
01:31:17,719 --> 01:31:21,480
because as of right now we are simply

2461
01:31:21,480 --> 01:31:23,920
just manually triggering this so if we

2462
01:31:23,920 --> 01:31:26,520
we needed to do this every day every 3

2463
01:31:26,520 --> 01:31:29,320
days we could actually add that in here

2464
01:31:29,320 --> 01:31:31,360
so let's go ahead and do that now okay

2465
01:31:31,360 --> 01:31:33,719
so actually iine the next evolution is

2466
01:31:33,719 --> 01:31:35,400
not going to be the KRON job next it's

2467
01:31:35,400 --> 01:31:38,280
actually going to be DBT DBT is going to

2468
01:31:38,280 --> 01:31:40,040
be an open source tool that we can

2469
01:31:40,040 --> 01:31:43,199
utilize here in order to write custom

2470
01:31:43,199 --> 01:31:45,800
Transformations or custom models on top

2471
01:31:45,800 --> 01:31:48,000
of the data that we've just sent into

2472
01:31:48,000 --> 01:31:50,280
the destination database so you can take

2473
01:31:50,280 --> 01:31:53,000
for example that we had a use case where

2474
01:31:53,000 --> 01:31:55,960
this destination database is primarily

2475
01:31:55,960 --> 01:31:58,679
going to be used by data analysts or

2476
01:31:58,679 --> 01:32:00,560
some sort of data scientists and they

2477
01:32:00,560 --> 01:32:03,119
need their data formatted or structured

2478
01:32:03,119 --> 01:32:04,840
in a certain way where we're combining

2479
01:32:04,840 --> 01:32:06,639
certain tables together they can't write

2480
01:32:06,639 --> 01:32:08,280
SQL or something like that and they

2481
01:32:08,280 --> 01:32:10,480
actually just need it a certain way or

2482
01:32:10,480 --> 01:32:12,560
something along those lines we can use

2483
01:32:12,560 --> 01:32:15,480
DBT to have those custom models so that

2484
01:32:15,480 --> 01:32:17,600
by the time the data is inside the

2485
01:32:17,600 --> 01:32:19,880
destination we can run DBT on top of

2486
01:32:19,880 --> 01:32:22,000
that data and then write custom models

2487
01:32:22,000 --> 01:32:23,679
here creating custom tables and things

2488
01:32:23,679 --> 01:32:25,480
like that and it allows us to have

2489
01:32:25,480 --> 01:32:27,400
certain capabilities it also allows us

2490
01:32:27,400 --> 01:32:29,800
to even write python to run SQL scripts

2491
01:32:29,800 --> 01:32:31,480
and things like that so let's go ahead

2492
01:32:31,480 --> 01:32:32,840
and see what that looks like and

2493
01:32:32,840 --> 01:32:34,719
implement it now there are a couple

2494
01:32:34,719 --> 01:32:36,560
prerequisites you need in order to run

2495
01:32:36,560 --> 01:32:38,760
DBT successfully on your machine or even

2496
01:32:38,760 --> 01:32:40,280
using Docker so let's go ahead and take

2497
01:32:40,280 --> 01:32:41,639
a look at what that looks like and

2498
01:32:41,639 --> 01:32:43,119
actually get it installed all right so

2499
01:32:43,119 --> 01:32:45,159
I'm here on the DPT docs which we will

2500
01:32:45,159 --> 01:32:46,760
also list down in the description just

2501
01:32:46,760 --> 01:32:48,840
so you can get to it pretty easily now

2502
01:32:48,840 --> 01:32:50,920
there is some things you need to do

2503
01:32:50,920 --> 01:32:53,119
locally uh not everything you can do

2504
01:32:53,119 --> 01:32:54,639
here through docker so the first thing

2505
01:32:54,639 --> 01:32:56,400
you need to do is obviously I'm on a Mac

2506
01:32:56,400 --> 01:32:57,880
so most of the instructions here are

2507
01:32:57,880 --> 01:32:59,880
going to be from Mac but you do need to

2508
01:32:59,880 --> 01:33:02,280
have this installed locally and the way

2509
01:33:02,280 --> 01:33:04,360
to do that is if you probably have Pip

2510
01:33:04,360 --> 01:33:05,880
if you have python installed and so

2511
01:33:05,880 --> 01:33:06,880
you're going to follow all these

2512
01:33:06,880 --> 01:33:08,440
instructions I think you could pretty

2513
01:33:08,440 --> 01:33:11,239
much skip these ones right here uh

2514
01:33:11,239 --> 01:33:13,159
you're going to want to follow this one

2515
01:33:13,159 --> 01:33:14,960
for sure I think actually you can

2516
01:33:14,960 --> 01:33:16,440
probably skip that one too the main one

2517
01:33:16,440 --> 01:33:17,920
here is installing the actual adap

2518
01:33:17,920 --> 01:33:20,000
you're not just installing the adapter

2519
01:33:20,000 --> 01:33:22,360
but you're also installing DBT core

2520
01:33:22,360 --> 01:33:25,360
which is the open source version of DBT

2521
01:33:25,360 --> 01:33:26,639
now I've already done this but if you

2522
01:33:26,639 --> 01:33:29,800
run DBT install DBT hyphen postest we're

2523
01:33:29,800 --> 01:33:32,719
installing the adapter of postgress that

2524
01:33:32,719 --> 01:33:35,199
utilizes DBT as well as DBT core you're

2525
01:33:35,199 --> 01:33:37,119
going to go ahead and run that locally

2526
01:33:37,119 --> 01:33:39,320
I've already done that uh as you could

2527
01:33:39,320 --> 01:33:42,000
see here so if I say uh DBT hyen hyen

2528
01:33:42,000 --> 01:33:44,239
version you can see that it's going to

2529
01:33:44,239 --> 01:33:46,560
list pretty much I have 1.62 installed

2530
01:33:46,560 --> 01:33:47,719
I'm not going to update for the sake of

2531
01:33:47,719 --> 01:33:50,280
this tutorial but there's 1.66 and I

2532
01:33:50,280 --> 01:33:52,320
have the postest version installed as

2533
01:33:52,320 --> 01:33:54,320
well so make sure you through this

2534
01:33:54,320 --> 01:33:57,159
installation really quickly and that way

2535
01:33:57,159 --> 01:33:59,080
we can actually go through and create

2536
01:33:59,080 --> 01:34:01,040
our models so make sure you do that that

2537
01:34:01,040 --> 01:34:03,040
is just the only prerequisite for this

2538
01:34:03,040 --> 01:34:05,679
section okay so now that we have DBT

2539
01:34:05,679 --> 01:34:08,360
installed let me go ahead and show you

2540
01:34:08,360 --> 01:34:10,960
how we can initialize a project here so

2541
01:34:10,960 --> 01:34:13,159
it's as simple as DBT innit we're going

2542
01:34:13,159 --> 01:34:15,520
to run DBT in nit inside of the root

2543
01:34:15,520 --> 01:34:17,400
directory excuse me uh now it's going to

2544
01:34:17,400 --> 01:34:19,080
ask us for the name of our project we're

2545
01:34:19,080 --> 01:34:21,600
going to say uh custom I don't know

2546
01:34:21,600 --> 01:34:23,880
custom postgress so it's going to say

2547
01:34:23,880 --> 01:34:25,480
custom _ postgress and you can see it's

2548
01:34:25,480 --> 01:34:27,840
creating these folders here for us now

2549
01:34:27,840 --> 01:34:30,119
we have the database we would like to

2550
01:34:30,119 --> 01:34:31,960
use it's asking us right here for

2551
01:34:31,960 --> 01:34:33,920
postgress and obviously it's the only

2552
01:34:33,920 --> 01:34:35,400
adapter that we installed so we're going

2553
01:34:35,400 --> 01:34:37,119
to hit number one and therefore it's

2554
01:34:37,119 --> 01:34:39,679
created us our it's created two folders

2555
01:34:39,679 --> 01:34:41,040
actually if we take a look on the right

2556
01:34:41,040 --> 01:34:43,480
left hand side it's created logs for us

2557
01:34:43,480 --> 01:34:46,159
so we now have logs for anything

2558
01:34:46,159 --> 01:34:48,960
regarding DBT as well as our project for

2559
01:34:48,960 --> 01:34:51,119
DBT so it has a couple folders here

2560
01:34:51,119 --> 01:34:53,960
analysis macros models seeds snap shots

2561
01:34:53,960 --> 01:34:55,560
and tests primarily what we're going to

2562
01:34:55,560 --> 01:34:58,480
be focusing on is the models and macros

2563
01:34:58,480 --> 01:35:00,560
for now uh and then the the rest of it

2564
01:35:00,560 --> 01:35:02,520
is is kind of like you know you can

2565
01:35:02,520 --> 01:35:05,000
learn as you go but for the sake of this

2566
01:35:05,000 --> 01:35:06,520
tutorial we're going to be focusing on

2567
01:35:06,520 --> 01:35:08,600
these folders here so there are other

2568
01:35:08,600 --> 01:35:09,800
couple things that we need to do in

2569
01:35:09,800 --> 01:35:11,840
order to set up the project itself

2570
01:35:11,840 --> 01:35:13,400
before we actually write our models the

2571
01:35:13,400 --> 01:35:14,600
one thing we actually have to do is

2572
01:35:14,600 --> 01:35:16,280
going to be this so I've just copied and

2573
01:35:16,280 --> 01:35:17,600
pasted this one command but you're going

2574
01:35:17,600 --> 01:35:19,600
to do Nano and inside of the complete

2575
01:35:19,600 --> 01:35:21,199
root of your local machine when you

2576
01:35:21,199 --> 01:35:23,040
install DBT using pip it actually

2577
01:35:23,040 --> 01:35:25,760
creates this DBT directory and inside

2578
01:35:25,760 --> 01:35:28,520
that folder is a profiles. yl file so

2579
01:35:28,520 --> 01:35:30,119
what we're going to do is go in there

2580
01:35:30,119 --> 01:35:31,719
and you can see that I've already set

2581
01:35:31,719 --> 01:35:34,480
this up but inside of the dev profile it

2582
01:35:34,480 --> 01:35:37,360
does say post Crestor Transformations

2583
01:35:37,360 --> 01:35:38,880
I'm going to go ahead and change this

2584
01:35:38,880 --> 01:35:40,960
because this is now different so what

2585
01:35:40,960 --> 01:35:43,719
I've done now is I'm going to do change

2586
01:35:43,719 --> 01:35:45,280
the name of this because it's no longer

2587
01:35:45,280 --> 01:35:46,600
post Transformations that's what I

2588
01:35:46,600 --> 01:35:48,600
normally did uh this is going to be

2589
01:35:48,600 --> 01:35:51,119
custom postgress you can see it's done

2590
01:35:51,119 --> 01:35:53,159
that down here it it is actually done

2591
01:35:53,159 --> 01:35:54,480
that down here here actually you know

2592
01:35:54,480 --> 01:35:55,719
what I'm probably just going to do that

2593
01:35:55,719 --> 01:35:59,679
instead I'm going to

2594
01:36:01,560 --> 01:36:03,760
post so now that we're inside of this

2595
01:36:03,760 --> 01:36:05,119
folder you can see that I've already

2596
01:36:05,119 --> 01:36:07,880
done this prior but if we were to go

2597
01:36:07,880 --> 01:36:10,199
down here into the custom post crust

2598
01:36:10,199 --> 01:36:12,199
profile which is created for me because

2599
01:36:12,199 --> 01:36:13,880
of this new project you can see here

2600
01:36:13,880 --> 01:36:15,360
there there's two different outputs

2601
01:36:15,360 --> 01:36:17,080
there's prod and Dev we're going to be

2602
01:36:17,080 --> 01:36:19,800
primarily focusing on dev and we do need

2603
01:36:19,800 --> 01:36:21,760
to fill out the actual information here

2604
01:36:21,760 --> 01:36:23,880
so inside of host I'm actually to do

2605
01:36:23,880 --> 01:36:26,760
host. doer. internal which is needed in

2606
01:36:26,760 --> 01:36:29,600
order for DBT to actually recognize the

2607
01:36:29,600 --> 01:36:31,679
docker containers that we were trying to

2608
01:36:31,679 --> 01:36:33,600
access here which is going to be our

2609
01:36:33,600 --> 01:36:35,760
destination database so make sure that

2610
01:36:35,760 --> 01:36:38,639
this says host. doer. internal and it'll

2611
01:36:38,639 --> 01:36:41,480
read the actual Network or IP address of

2612
01:36:41,480 --> 01:36:42,880
your Docker container for the

2613
01:36:42,880 --> 01:36:44,880
destination database for the port here

2614
01:36:44,880 --> 01:36:47,080
this is going to be 5434 I'm pretty sure

2615
01:36:47,080 --> 01:36:49,560
for the destination for the user we're

2616
01:36:49,560 --> 01:36:51,639
going to change this over to postest for

2617
01:36:51,639 --> 01:36:53,840
the password

2618
01:36:53,840 --> 01:36:56,119
we're going to change this over to

2619
01:36:56,119 --> 01:37:00,000
secret DB name will be

2620
01:37:00,000 --> 01:37:03,119
destination DB and then I forget what I

2621
01:37:03,119 --> 01:37:05,960
actually put for the schema here uh

2622
01:37:05,960 --> 01:37:08,000
schema should be public and then I

2623
01:37:08,000 --> 01:37:10,239
forgot to fill up the threads here so

2624
01:37:10,239 --> 01:37:12,840
let's change this to one all right so

2625
01:37:12,840 --> 01:37:14,760
and the target here is going to be Dev

2626
01:37:14,760 --> 01:37:16,320
so obviously make sure that says it by

2627
01:37:16,320 --> 01:37:18,119
default it should just Target the dev

2628
01:37:18,119 --> 01:37:19,679
profile but now that we have our

2629
01:37:19,679 --> 01:37:21,679
information filled out here it should

2630
01:37:21,679 --> 01:37:24,360
have the correct information to connect

2631
01:37:24,360 --> 01:37:26,840
to our destination database I believe if

2632
01:37:26,840 --> 01:37:29,320
I do write out maybe not write out but

2633
01:37:29,320 --> 01:37:31,639
if we say x save modified we're going to

2634
01:37:31,639 --> 01:37:34,440
hit yes tab to complete and hit enter

2635
01:37:34,440 --> 01:37:36,679
okay so this should have saved it now

2636
01:37:36,679 --> 01:37:38,480
the other thing to do here is inside of

2637
01:37:38,480 --> 01:37:42,040
the DBT project. file the one thing to

2638
01:37:42,040 --> 01:37:44,280
note is that obviously the profile we

2639
01:37:44,280 --> 01:37:46,760
just wrote is the custom _ postgress you

2640
01:37:46,760 --> 01:37:48,320
don't have to change anything here

2641
01:37:48,320 --> 01:37:50,159
except for this bottom section inside of

2642
01:37:50,159 --> 01:37:51,920
the bottom section is going to be how

2643
01:37:51,920 --> 01:37:54,360
we're forming our models now inside of

2644
01:37:54,360 --> 01:37:55,840
the models folder you can see that

2645
01:37:55,840 --> 01:37:58,159
there's an example folder and then a

2646
01:37:58,159 --> 01:37:59,679
couple of models here what we're

2647
01:37:59,679 --> 01:38:01,840
actually going to do is we're going to

2648
01:38:01,840 --> 01:38:03,920
change this there's a couple options

2649
01:38:03,920 --> 01:38:05,599
inside the material section but because

2650
01:38:05,599 --> 01:38:07,800
we're using postest tables we actually

2651
01:38:07,800 --> 01:38:09,599
want to change this to table if you keep

2652
01:38:09,599 --> 01:38:11,760
it as view we're actually not going to

2653
01:38:11,760 --> 01:38:14,199
see any of the tables that we created

2654
01:38:14,199 --> 01:38:16,199
come through or anything like that or

2655
01:38:16,199 --> 01:38:17,719
DBT is not going to be able to recognize

2656
01:38:17,719 --> 01:38:19,880
it so we have to change it to a table

2657
01:38:19,880 --> 01:38:21,159
now that we've done that we can actually

2658
01:38:21,159 --> 01:38:22,960
go in and write our models so let's go

2659
01:38:22,960 --> 01:38:24,920
ahead and do that all right so we are

2660
01:38:24,920 --> 01:38:27,320
inside of the models folder here and

2661
01:38:27,320 --> 01:38:29,440
inside of this example folder are some

2662
01:38:29,440 --> 01:38:31,800
custom examples that they have created

2663
01:38:31,800 --> 01:38:33,440
for us uh we don't really need to see

2664
01:38:33,440 --> 01:38:34,520
this because we're going to be writing

2665
01:38:34,520 --> 01:38:35,880
our own so I'm actually going to go

2666
01:38:35,880 --> 01:38:38,080
ahead and delete both of these we're

2667
01:38:38,080 --> 01:38:40,960
going to keep the schema. yaml for now

2668
01:38:40,960 --> 01:38:42,679
well we're going to reference that later

2669
01:38:42,679 --> 01:38:44,880
but let's create our models here so you

2670
01:38:44,880 --> 01:38:47,599
can think of models as just SQL files

2671
01:38:47,599 --> 01:38:50,199
we're just querying the data but we're

2672
01:38:50,199 --> 01:38:52,480
morphing the data around to the needs

2673
01:38:52,480 --> 01:38:55,679
that we need so we just do it once here

2674
01:38:55,679 --> 01:38:57,880
and then once the destination database

2675
01:38:57,880 --> 01:39:00,000
has its data everything that we've

2676
01:39:00,000 --> 01:39:02,320
queried here all the modifications and

2677
01:39:02,320 --> 01:39:04,199
the new tables that we've created will

2678
01:39:04,199 --> 01:39:06,440
end up inside of the destination

2679
01:39:06,440 --> 01:39:07,719
database and you'll see what I mean by

2680
01:39:07,719 --> 01:39:09,280
all that once we have it all hooked up

2681
01:39:09,280 --> 01:39:10,719
the first thing we need to do is

2682
01:39:10,719 --> 01:39:13,840
actually Source the data itself because

2683
01:39:13,840 --> 01:39:16,119
it can't just simply reference tables

2684
01:39:16,119 --> 01:39:17,679
inside of a destination database without

2685
01:39:17,679 --> 01:39:19,199
having the actual reference itself so

2686
01:39:19,199 --> 01:39:20,840
what we're going to do is we're going to

2687
01:39:20,840 --> 01:39:22,119
create our first one so we're going to

2688
01:39:22,119 --> 01:39:25,280
say film _ actors which is a table that

2689
01:39:25,280 --> 01:39:26,920
we're actually writing over into the

2690
01:39:26,920 --> 01:39:28,719
destination database and this is simply

2691
01:39:28,719 --> 01:39:30,679
just creating a reference for us to

2692
01:39:30,679 --> 01:39:32,599
create the custom models so this isn't

2693
01:39:32,599 --> 01:39:34,480
necessarily a custom model here um so

2694
01:39:34,480 --> 01:39:36,280
we're going to write some some SQL here

2695
01:39:36,280 --> 01:39:38,320
select all from and then we're going to

2696
01:39:38,320 --> 01:39:40,480
do double curly brackets here and inside

2697
01:39:40,480 --> 01:39:41,960
of that we're going to say the source of

2698
01:39:41,960 --> 01:39:44,159
our data is going to come from

2699
01:39:44,159 --> 01:39:47,840
destination database and the name it for

2700
01:39:47,840 --> 01:39:49,400
this that we're going to reference it

2701
01:39:49,400 --> 01:39:51,119
from is going to be Filmore actors we're

2702
01:39:51,119 --> 01:39:52,880
going to need to wrap both of these in

2703
01:39:52,880 --> 01:39:55,280
single quotes very cool now what we've

2704
01:39:55,280 --> 01:39:57,000
done is we've sourced the destination

2705
01:39:57,000 --> 01:39:59,280
database and we've taken the film actors

2706
01:39:59,280 --> 01:40:00,840
table and now we have a film actors's

2707
01:40:00,840 --> 01:40:02,320
reference let me go ahead and copy and

2708
01:40:02,320 --> 01:40:04,000
paste this we're going to do that again

2709
01:40:04,000 --> 01:40:06,560
for the actors table so actors. SQL

2710
01:40:06,560 --> 01:40:08,040
we're going to paste this in here and

2711
01:40:08,040 --> 01:40:09,840
we're simply going to change this over

2712
01:40:09,840 --> 01:40:12,239
to actors and we're going to do the same

2713
01:40:12,239 --> 01:40:14,639
for films films. SQL so we have our

2714
01:40:14,639 --> 01:40:17,000
references now we can actually create

2715
01:40:17,000 --> 01:40:19,199
our custom models but again before we do

2716
01:40:19,199 --> 01:40:20,599
that we have to have some prerequisite

2717
01:40:20,599 --> 01:40:23,440
work so for the schemas these are our

2718
01:40:23,440 --> 01:40:25,880
custom models here our our DBT models

2719
01:40:25,880 --> 01:40:28,040
and we do have to specify what the

2720
01:40:28,040 --> 01:40:31,400
schema of these are going to be so that

2721
01:40:31,400 --> 01:40:33,199
if we do need to test anything which you

2722
01:40:33,199 --> 01:40:36,000
should be testing you can run a model or

2723
01:40:36,000 --> 01:40:38,719
you can run DBT against all of these SQL

2724
01:40:38,719 --> 01:40:40,480
files and if it doesn't match what we've

2725
01:40:40,480 --> 01:40:42,000
specified inside the schema we're going

2726
01:40:42,000 --> 01:40:43,800
to get thrown back errors so you should

2727
01:40:43,800 --> 01:40:45,920
definitely always do this what I'm going

2728
01:40:45,920 --> 01:40:48,719
to do is I'm going to head over into our

2729
01:40:48,719 --> 01:40:51,960
file here and I'm going to look into the

2730
01:40:51,960 --> 01:40:53,920
models and example fold and we're going

2731
01:40:53,920 --> 01:40:56,000
to have a couple things so schema. AML

2732
01:40:56,000 --> 01:40:57,199
is what we want we see that there's a

2733
01:40:57,199 --> 01:41:00,320
films table here and every bit of schema

2734
01:41:00,320 --> 01:41:02,800
here for that one the actors film actors

2735
01:41:02,800 --> 01:41:04,520
film ratings I think I need the film

2736
01:41:04,520 --> 01:41:07,800
ratings one two as a yeah that's fine so

2737
01:41:07,800 --> 01:41:08,920
what we're going to actually just do

2738
01:41:08,920 --> 01:41:11,040
here is copy and paste this whole thing

2739
01:41:11,040 --> 01:41:12,520
I implore you to do that too we're going

2740
01:41:12,520 --> 01:41:14,199
to paste that in there and now we have

2741
01:41:14,199 --> 01:41:17,320
the schema for all the tables that we

2742
01:41:17,320 --> 01:41:19,360
just add now the other thing too that we

2743
01:41:19,360 --> 01:41:21,800
need to do is we're going to go ahead

2744
01:41:21,800 --> 01:41:24,119
and copy over the sources EML so now

2745
01:41:24,119 --> 01:41:26,320
we're specifying the raw data from the

2746
01:41:26,320 --> 01:41:29,000
destination database so I'm going to

2747
01:41:29,000 --> 01:41:30,639
copy this as well and you can see film

2748
01:41:30,639 --> 01:41:32,960
actor and film actors literally the

2749
01:41:32,960 --> 01:41:35,400
exact tables that we just copied so

2750
01:41:35,400 --> 01:41:37,920
we're going to go in here and create a

2751
01:41:37,920 --> 01:41:41,159
new file called sources. EML and paste

2752
01:41:41,159 --> 01:41:42,639
everything that we just saw so now we

2753
01:41:42,639 --> 01:41:44,800
actually have sources that we can point

2754
01:41:44,800 --> 01:41:47,480
to regarding these files or tables

2755
01:41:47,480 --> 01:41:49,280
essentially that we're querying from so

2756
01:41:49,280 --> 01:41:51,320
you can see if we think about this from

2757
01:41:51,320 --> 01:41:53,560
the top down data is theoretic Ally

2758
01:41:53,560 --> 01:41:54,760
already written inside of the

2759
01:41:54,760 --> 01:41:58,119
destination database DBT is going to run

2760
01:41:58,119 --> 01:42:00,520
after we've moved data over so the data

2761
01:42:00,520 --> 01:42:02,520
is already there and from there what

2762
01:42:02,520 --> 01:42:05,400
we're doing is taking in the data so

2763
01:42:05,400 --> 01:42:07,599
that way we can modify it and create a

2764
01:42:07,599 --> 01:42:10,480
custom model with that data so all we're

2765
01:42:10,480 --> 01:42:12,400
doing here is referencing data that we

2766
01:42:12,400 --> 01:42:14,560
already have now let's go in and create

2767
01:42:14,560 --> 01:42:18,360
the custom models to formulate and

2768
01:42:18,360 --> 01:42:20,440
modify the data we have into a table

2769
01:42:20,440 --> 01:42:23,280
that we want okay so the first model we

2770
01:42:23,280 --> 01:42:24,920
going to create inside of the example

2771
01:42:24,920 --> 01:42:27,800
folder I'm going to name Filmore

2772
01:42:27,800 --> 01:42:30,199
ratings. SQL so what we're going to be

2773
01:42:30,199 --> 01:42:33,199
doing is appending the films as well as

2774
01:42:33,199 --> 01:42:37,599
the actors together to create one table

2775
01:42:37,599 --> 01:42:40,080
but it's going to be primarily focused

2776
01:42:40,080 --> 01:42:43,040
on the film ratings so let's get to it

2777
01:42:43,040 --> 01:42:44,400
all right so what we're going to do

2778
01:42:44,400 --> 01:42:46,159
inside of this file is we're actually

2779
01:42:46,159 --> 01:42:48,119
going to create two different tables and

2780
01:42:48,119 --> 01:42:51,119
then use a join to create one if that

2781
01:42:51,119 --> 01:42:52,920
makes sense so the first one we're going

2782
01:42:52,920 --> 01:42:56,480
to call is with filmscore with ratings

2783
01:42:56,480 --> 01:42:58,440
as and then this is where we're going to

2784
01:42:58,440 --> 01:43:00,599
run our sequel to create this table so

2785
01:43:00,599 --> 01:43:02,280
we're going to say select

2786
01:43:02,280 --> 01:43:05,000
filmcore ID

2787
01:43:05,000 --> 01:43:08,320
title release _ date make sure you're

2788
01:43:08,320 --> 01:43:12,199
adding commas price rating these are all

2789
01:43:12,199 --> 01:43:14,159
from the table that we already have this

2790
01:43:14,159 --> 01:43:16,679
is going to be user rating this is where

2791
01:43:16,679 --> 01:43:19,000
we add something very specific so this

2792
01:43:19,000 --> 01:43:20,800
is going to be a case so what the case

2793
01:43:20,800 --> 01:43:22,840
is kind of like you can think of an if

2794
01:43:22,840 --> 01:43:25,000
state statement per se so we're going to

2795
01:43:25,000 --> 01:43:28,960
say when user rating is greater than or

2796
01:43:28,960 --> 01:43:32,199
equals to uh let's say

2797
01:43:32,199 --> 01:43:35,760
4.5 then we want the rating to say

2798
01:43:35,760 --> 01:43:37,040
excellent uh we're going to add another

2799
01:43:37,040 --> 01:43:39,119
one where user rating is going to be

2800
01:43:39,119 --> 01:43:43,119
greater than or equals to 4.0 so kind of

2801
01:43:43,119 --> 01:43:44,480
like in the in between there and we're

2802
01:43:44,480 --> 01:43:46,360
going to say that we want the rating to

2803
01:43:46,360 --> 01:43:47,679
read good and then the last one we're

2804
01:43:47,679 --> 01:43:49,360
going to do is going to the user rating

2805
01:43:49,360 --> 01:43:51,360
is going to be greater than or equals to

2806
01:43:51,360 --> 01:43:54,159
3.0 then we're we're going to say that

2807
01:43:54,159 --> 01:43:57,320
this is going to be average else we're

2808
01:43:57,320 --> 01:43:59,440
going to label it as poor and we're

2809
01:43:59,440 --> 01:44:03,400
going to end as rating uncore

2810
01:44:03,400 --> 01:44:06,440
category so that ends this case

2811
01:44:06,440 --> 01:44:08,599
statement here and this is where the

2812
01:44:08,599 --> 01:44:10,639
reference comes in so we're going to say

2813
01:44:10,639 --> 01:44:12,599
from and we're going to open the double

2814
01:44:12,599 --> 01:44:14,679
curly brackets again and if we say ref

2815
01:44:14,679 --> 01:44:17,080
parentheses films we're going to be

2816
01:44:17,080 --> 01:44:18,679
pulling from this here because we

2817
01:44:18,679 --> 01:44:20,679
labeled it as films so now we can

2818
01:44:20,679 --> 01:44:23,599
actually reference it here within

2819
01:44:23,599 --> 01:44:25,560
this little query here one thing I

2820
01:44:25,560 --> 01:44:28,119
forgot to mention for this specifically

2821
01:44:28,119 --> 01:44:30,800
is you saw that we say with and as or

2822
01:44:30,800 --> 01:44:33,320
with films with ratings this is actually

2823
01:44:33,320 --> 01:44:35,960
what's referred to as a CTE or comment

2824
01:44:35,960 --> 01:44:38,960
table expression so you can see this as

2825
01:44:38,960 --> 01:44:42,440
a wrapper of this query kind of like a

2826
01:44:42,440 --> 01:44:45,280
subquery per se but it makes it easy to

2827
01:44:45,280 --> 01:44:48,960
write queries that are maintainable and

2828
01:44:48,960 --> 01:44:52,480
they're also scoped just to this CTE so

2829
01:44:52,480 --> 01:44:54,679
it will not like go outside of this so

2830
01:44:54,679 --> 01:44:56,639
this allows us to write subqueries and

2831
01:44:56,639 --> 01:44:59,280
then ultimately reference them later

2832
01:44:59,280 --> 01:45:01,400
inside of this file so it is actually

2833
01:45:01,400 --> 01:45:04,320
really really nice part of DBT that lets

2834
01:45:04,320 --> 01:45:07,000
us write CTE uh to kind of formulate

2835
01:45:07,000 --> 01:45:09,280
these custom models so that's just

2836
01:45:09,280 --> 01:45:10,639
something I forgot to mention when we

2837
01:45:10,639 --> 01:45:12,280
were first writing this but remember

2838
01:45:12,280 --> 01:45:14,800
this is a CTE or Common Table expression

2839
01:45:14,800 --> 01:45:16,000
all right so now that we have our first

2840
01:45:16,000 --> 01:45:18,199
CTE so let's write the second one I

2841
01:45:18,199 --> 01:45:20,159
added a comma after the CTE so that way

2842
01:45:20,159 --> 01:45:21,840
we can string on another one this one is

2843
01:45:21,840 --> 01:45:24,760
going to be films with underscore with

2844
01:45:24,760 --> 01:45:27,119
uncore actors as and then that's going

2845
01:45:27,119 --> 01:45:30,000
to open our CTE here our second one so

2846
01:45:30,000 --> 01:45:31,520
we're going to say select and we're

2847
01:45:31,520 --> 01:45:35,080
going to do the Alias here um f.

2848
01:45:35,080 --> 01:45:38,159
Filmore ID f. tile and then we're going

2849
01:45:38,159 --> 01:45:40,440
to do a string aggregator or string

2850
01:45:40,440 --> 01:45:42,719
aggregation with a.

2851
01:45:42,719 --> 01:45:45,639
actor undor name we're going to pend it

2852
01:45:45,639 --> 01:45:47,920
with a comma there and we're going to do

2853
01:45:47,920 --> 01:45:50,920
as actors so we're aggregating actor

2854
01:45:50,920 --> 01:45:53,320
names for each film here and and then

2855
01:45:53,320 --> 01:45:55,560
we're also going to hit the reference so

2856
01:45:55,560 --> 01:45:57,920
from double curly brackets reference

2857
01:45:57,920 --> 01:45:59,400
films and then obviously we're going to

2858
01:45:59,400 --> 01:46:01,639
enable the Alias here with f my auto

2859
01:46:01,639 --> 01:46:03,239
completes that but there we go so then

2860
01:46:03,239 --> 01:46:05,159
we're also going to left join Filmore

2861
01:46:05,159 --> 01:46:06,679
actors table and we're going to give

2862
01:46:06,679 --> 01:46:11,639
that fa for film actors on f. Filmore ID

2863
01:46:11,639 --> 01:46:15,760
if it equals the film actors. film idect

2864
01:46:15,760 --> 01:46:17,280
uh we're going to do another left join

2865
01:46:17,280 --> 01:46:19,599
here referencing the this left join we

2866
01:46:19,599 --> 01:46:22,080
need to this so let's go ahead and do

2867
01:46:22,080 --> 01:46:24,719
that so forgot the curly brackets or I'm

2868
01:46:24,719 --> 01:46:26,480
sorry the uh parenthesis and single

2869
01:46:26,480 --> 01:46:29,840
quotes there um let's add the actors for

2870
01:46:29,840 --> 01:46:32,320
this reference obviously this one is

2871
01:46:32,320 --> 01:46:37,440
going to be a on fa. actor _ ID if it

2872
01:46:37,440 --> 01:46:40,320
equals the a. actor ID and then we're

2873
01:46:40,320 --> 01:46:44,880
going to group by the f. Filmore ID and

2874
01:46:44,880 --> 01:46:49,440
the f. tile okay so that's going to be

2875
01:46:49,440 --> 01:46:52,000
the second CTE so we have two now

2876
01:46:52,000 --> 01:46:53,719
technically two series films with

2877
01:46:53,719 --> 01:46:55,760
ratings and the films with actors so

2878
01:46:55,760 --> 01:46:58,239
we've taken the film ID and the title

2879
01:46:58,239 --> 01:47:00,239
and we've joined the two tables that we

2880
01:47:00,239 --> 01:47:02,639
had here we have the film actors and the

2881
01:47:02,639 --> 01:47:04,960
actors table so these are obviously you

2882
01:47:04,960 --> 01:47:06,560
know we worked with these before but the

2883
01:47:06,560 --> 01:47:08,880
film actors and the actors is the bridge

2884
01:47:08,880 --> 01:47:10,840
to the films table so now we can

2885
01:47:10,840 --> 01:47:12,679
actually join them to create one so now

2886
01:47:12,679 --> 01:47:14,239
we're going to have the main query here

2887
01:47:14,239 --> 01:47:17,639
we're going to select fwf do asterisk

2888
01:47:17,639 --> 01:47:20,119
here and we're going to say fwa film

2889
01:47:20,119 --> 01:47:25,000
with actors. actors the filmscore with

2890
01:47:25,000 --> 01:47:27,679
now you can see underscore ratings you

2891
01:47:27,679 --> 01:47:29,280
can see how we're referencing the actual

2892
01:47:29,280 --> 01:47:31,400
CTE now and then we're going to label

2893
01:47:31,400 --> 01:47:33,719
this as fwf for the Alias then we're

2894
01:47:33,719 --> 01:47:37,639
going to say left join films with actors

2895
01:47:37,639 --> 01:47:40,800
which we're going to label fwa on

2896
01:47:40,800 --> 01:47:45,639
fwf do Filmore ID if it equals the film

2897
01:47:45,639 --> 01:47:48,639
with actors do

2898
01:47:48,639 --> 01:47:50,960
Filmore now we're creating essentially

2899
01:47:50,960 --> 01:47:53,599
what could be two tables two tables

2900
01:47:53,599 --> 01:47:55,440
using the references we've created and

2901
01:47:55,440 --> 01:47:58,080
now we're actually joining them together

2902
01:47:58,080 --> 01:48:01,199
using this custom model now if we were

2903
01:48:01,199 --> 01:48:04,199
to want to run this we now need to set

2904
01:48:04,199 --> 01:48:06,960
up the dock container for DBT so let's

2905
01:48:06,960 --> 01:48:08,800
go ahead and do that and then run this

2906
01:48:08,800 --> 01:48:10,119
custom model just to see what it would

2907
01:48:10,119 --> 01:48:13,040
look like okay so we are back inside of

2908
01:48:13,040 --> 01:48:15,080
our Docker compos file let's go ahead

2909
01:48:15,080 --> 01:48:17,520
and add the DBT service so underneath

2910
01:48:17,520 --> 01:48:19,960
the elt script I'm going to say DBT

2911
01:48:19,960 --> 01:48:21,119
which is going to be the name of our

2912
01:48:21,119 --> 01:48:23,599
service the image I want to use is going

2913
01:48:23,599 --> 01:48:25,000
to be

2914
01:48:25,000 --> 01:48:31,360
gc. i/ DBT laabs SL DBT postgress and

2915
01:48:31,360 --> 01:48:33,239
then the version is

2916
01:48:33,239 --> 01:48:36,159
1.47 uh this as of right now at the time

2917
01:48:36,159 --> 01:48:37,800
of this recording is most likely out of

2918
01:48:37,800 --> 01:48:40,199
date but it's just what I use so I'm

2919
01:48:40,199 --> 01:48:41,360
going to go ahead and run with it the

2920
01:48:41,360 --> 01:48:43,639
command I'm going to run here uh I'm

2921
01:48:43,639 --> 01:48:45,239
actually going to run a couple now I'm

2922
01:48:45,239 --> 01:48:47,440
going to open this square brackets and

2923
01:48:47,440 --> 01:48:49,040
the first one I'm going to do is run so

2924
01:48:49,040 --> 01:48:51,719
this is technically DBT run DBT run is

2925
01:48:51,719 --> 01:48:53,239
the command you would use

2926
01:48:53,239 --> 01:48:55,560
in order to run your models on top of

2927
01:48:55,560 --> 01:48:57,719
the destination so I'm going to string a

2928
01:48:57,719 --> 01:48:59,000
couple here so we're going to say run

2929
01:48:59,000 --> 01:49:00,480
and then we're actually going to do

2930
01:49:00,480 --> 01:49:02,440
we're going to point to the profiles

2931
01:49:02,440 --> 01:49:05,920
directory so if I do double hyphen

2932
01:49:05,920 --> 01:49:09,639
profiles hypher not period I need a

2933
01:49:09,639 --> 01:49:11,760
comma we're going to say that is going

2934
01:49:11,760 --> 01:49:15,360
to be in the uh root here and then if

2935
01:49:15,360 --> 01:49:18,599
we're going to point to the project

2936
01:49:18,599 --> 01:49:22,400
directory then we're going to point to/

2937
01:49:22,400 --> 01:49:24,480
DB T which is the name essentially going

2938
01:49:24,480 --> 01:49:26,000
to be the name of our project directory

2939
01:49:26,000 --> 01:49:28,520
here the one thing I also want to do uh

2940
01:49:28,520 --> 01:49:30,560
well we can leave this out for now

2941
01:49:30,560 --> 01:49:34,599
actually um so after that we're going to

2942
01:49:34,599 --> 01:49:37,960
do networks and this will be altore

2943
01:49:37,960 --> 01:49:39,360
Network so we can keep it on the same

2944
01:49:39,360 --> 01:49:40,719
network here and now we're going to

2945
01:49:40,719 --> 01:49:42,599
point some volumes here so with the

2946
01:49:42,599 --> 01:49:44,960
volumes we have the actual project

2947
01:49:44,960 --> 01:49:47,880
itself so you notice I said SL DBT so

2948
01:49:47,880 --> 01:49:49,040
here we're actually going to create

2949
01:49:49,040 --> 01:49:51,440
another mapping to point to DBT because

2950
01:49:51,440 --> 01:49:53,360
if we remember correctly on Docker

2951
01:49:53,360 --> 01:49:55,360
containers every directory here is

2952
01:49:55,360 --> 01:49:57,400
pretty much going to be pointing to the

2953
01:49:57,400 --> 01:49:59,599
directory inside of the actual Docker

2954
01:49:59,599 --> 01:50:01,520
container and not your local machine so

2955
01:50:01,520 --> 01:50:03,679
you have to map the docker container to

2956
01:50:03,679 --> 01:50:05,719
look at where the actual project is

2957
01:50:05,719 --> 01:50:07,440
going to be on your local machine so

2958
01:50:07,440 --> 01:50:09,239
we're going to create that mapping and

2959
01:50:09,239 --> 01:50:12,520
this is going to be/ custom postgress

2960
01:50:12,520 --> 01:50:15,280
and then uh from there we're going to do

2961
01:50:15,280 --> 01:50:17,719
the colon to create the mapping to The

2962
01:50:17,719 --> 01:50:19,719
Container path and then the container

2963
01:50:19,719 --> 01:50:21,840
path is simply just going to be/ DBT

2964
01:50:21,840 --> 01:50:23,880
which we've pointed right here now we

2965
01:50:23,880 --> 01:50:25,560
need to create another volume here uh

2966
01:50:25,560 --> 01:50:27,280
let me add a space here because that

2967
01:50:27,280 --> 01:50:29,280
requires a space uh we're going to point

2968
01:50:29,280 --> 01:50:33,760
to the um the DBT profile that we did so

2969
01:50:33,760 --> 01:50:36,159
we're going to need the squiggly Tilda

2970
01:50:36,159 --> 01:50:38,960
we need squiggly SL DBT and we're going

2971
01:50:38,960 --> 01:50:41,800
to point this over into the root which

2972
01:50:41,800 --> 01:50:43,920
is where we pointed if I could spell

2973
01:50:43,920 --> 01:50:46,079
normally uh this is where the profiles

2974
01:50:46,079 --> 01:50:47,719
directory was which is going to be in/

2975
01:50:47,719 --> 01:50:50,960
root so now we're mapping our local DBT

2976
01:50:50,960 --> 01:50:54,000
folder with the profiles. emo file to

2977
01:50:54,000 --> 01:50:56,199
the/ root of the docker container

2978
01:50:56,199 --> 01:50:58,079
hopefully that makes a bunch of sense

2979
01:50:58,079 --> 01:50:59,599
cuz in my mind it kind of does so we're

2980
01:50:59,599 --> 01:51:01,599
also going to say depends on the elt

2981
01:51:01,599 --> 01:51:03,880
undersource scripts we want DBT only to

2982
01:51:03,880 --> 01:51:06,119
run because remember when this container

2983
01:51:06,119 --> 01:51:08,239
starts we're running this command and if

2984
01:51:08,239 --> 01:51:11,400
we run DBT run on top of the destination

2985
01:51:11,400 --> 01:51:14,400
database without it having any data this

2986
01:51:14,400 --> 01:51:15,760
will not work because there nothing to

2987
01:51:15,760 --> 01:51:17,159
reference and it has nothing to write

2988
01:51:17,159 --> 01:51:19,040
data on so we need this to make sure

2989
01:51:19,040 --> 01:51:21,040
that it depends on the elt script and

2990
01:51:21,040 --> 01:51:23,199
the elt script depends on the two

2991
01:51:23,199 --> 01:51:25,000
databases so this is working down the

2992
01:51:25,000 --> 01:51:27,440
line we've essentially created a uh work

2993
01:51:27,440 --> 01:51:29,560
line here and then for the environments

2994
01:51:29,560 --> 01:51:32,880
we need two here so we need DBT profile

2995
01:51:32,880 --> 01:51:34,719
this one is going to be it's going to be

2996
01:51:34,719 --> 01:51:37,159
default and then we have another one

2997
01:51:37,159 --> 01:51:38,960
this one doesn't need a hyphen actually

2998
01:51:38,960 --> 01:51:41,079
cuz we made that mistake last time and

2999
01:51:41,079 --> 01:51:44,079
then we need DBT uncore Target and this

3000
01:51:44,079 --> 01:51:46,000
one is going to be Dev so this is going

3001
01:51:46,000 --> 01:51:49,360
to be everything we need for the DBT

3002
01:51:49,360 --> 01:51:51,920
container now all we need to do go ahead

3003
01:51:51,920 --> 01:51:56,119
and clear this I don't think compos down

3004
01:51:56,119 --> 01:51:58,520
Docker compos down everything uh I think

3005
01:51:58,520 --> 01:51:59,719
the volumes are still up but that's

3006
01:51:59,719 --> 01:52:01,679
totally fine so now we're going to do

3007
01:52:01,679 --> 01:52:03,719
Docker compose up did I type that

3008
01:52:03,719 --> 01:52:05,320
correctly

3009
01:52:05,320 --> 01:52:08,199
hc. i/

3010
01:52:08,199 --> 01:52:11,679
DBT lab

3011
01:52:11,760 --> 01:52:18,320
slbt post press s oh uh 1.7 okay that's

3012
01:52:18,320 --> 01:52:21,119
another one another typo there we go so

3013
01:52:21,119 --> 01:52:22,679
we're going to go ahead and let that run

3014
01:52:22,679 --> 01:52:25,280
here so elt script exited Code Zero so

3015
01:52:25,280 --> 01:52:27,560
that's a good sign now the DBT one

3016
01:52:27,560 --> 01:52:29,719
should pop up invalid not a project

3017
01:52:29,719 --> 01:52:33,440
missing DBT unor pro. file okay so

3018
01:52:33,440 --> 01:52:35,880
invalid project directory project

3019
01:52:35,880 --> 01:52:40,280
directory here custom _ post press maybe

3020
01:52:40,280 --> 01:52:43,760
we do not need this let's go ahead and

3021
01:52:43,760 --> 01:52:48,719
clear this let's do Docker down SLB and

3022
01:52:48,719 --> 01:52:53,079
then so maybe custom oh I'm dumb

3023
01:52:53,079 --> 01:52:55,400
uh it should have been an underscore you

3024
01:52:55,400 --> 01:52:57,800
can see all the typos and everything

3025
01:52:57,800 --> 01:52:59,840
really does make a difference here so

3026
01:52:59,840 --> 01:53:01,719
let's run that again and that should map

3027
01:53:01,719 --> 01:53:04,360
to the correct project now hopefully

3028
01:53:04,360 --> 01:53:07,000
there we go so it's ran successfully I

3029
01:53:07,000 --> 01:53:08,679
think unable to do partial parsing

3030
01:53:08,679 --> 01:53:11,719
encoun an error error sources. yo

3031
01:53:11,719 --> 01:53:14,880
runtime error sources. Yeo list of

3032
01:53:14,880 --> 01:53:17,239
actors film actors ra eror while parsing

3033
01:53:17,239 --> 01:53:19,480
of block mapping uni code okay so there

3034
01:53:19,480 --> 01:53:22,560
was an error in our sources file here

3035
01:53:22,560 --> 01:53:25,719
somewhere that might have been it um 13

3036
01:53:25,719 --> 01:53:29,920
and 14 Filmore actors okay let's do this

3037
01:53:29,920 --> 01:53:33,440
one more time I think my cat may have

3038
01:53:33,440 --> 01:53:35,960
done something with that so you can see

3039
01:53:35,960 --> 01:53:37,719
there a lot of back and forth here

3040
01:53:37,719 --> 01:53:40,639
scripts ran successfully okay it's

3041
01:53:40,639 --> 01:53:42,400
taking a little bit longer which is

3042
01:53:42,400 --> 01:53:45,000
totally fine here model fims was which

3043
01:53:45,000 --> 01:53:46,679
was not F there's a lot of typas going

3044
01:53:46,679 --> 01:53:49,800
on film ratings so if we go into Filmore

3045
01:53:49,800 --> 01:53:53,079
ratings reference films fil

3046
01:53:53,079 --> 01:53:55,599
okay here's the typo let's Docker

3047
01:53:55,599 --> 01:53:59,159
compose down again so also uh if you're

3048
01:53:59,159 --> 01:54:00,840
curious if I'm Docker composing down

3049
01:54:00,840 --> 01:54:02,719
hyphen V I'm actually killing the

3050
01:54:02,719 --> 01:54:04,920
volumes every single time just to make

3051
01:54:04,920 --> 01:54:06,880
sure that everything is working even if

3052
01:54:06,880 --> 01:54:07,960
we're starting straight from the

3053
01:54:07,960 --> 01:54:10,400
beginning without any data persisting so

3054
01:54:10,400 --> 01:54:12,280
I'm that's the only reason why I'm doing

3055
01:54:12,280 --> 01:54:14,079
that um so now we Docker compose up

3056
01:54:14,079 --> 01:54:16,560
again this should work unless I've made

3057
01:54:16,560 --> 01:54:18,840
even more typos okay so we're doing that

3058
01:54:18,840 --> 01:54:21,040
again there we go okay so now you can

3059
01:54:21,040 --> 01:54:23,880
see that we've successfully run our

3060
01:54:23,880 --> 01:54:25,880
models so we've created a couple models

3061
01:54:25,880 --> 01:54:27,639
here the first one was the actors the

3062
01:54:27,639 --> 01:54:29,440
first one was the film actors the F and

3063
01:54:29,440 --> 01:54:30,679
the second or the third one was the

3064
01:54:30,679 --> 01:54:32,920
films so these are all our references so

3065
01:54:32,920 --> 01:54:34,800
we've successfully taken that in but now

3066
01:54:34,800 --> 01:54:36,960
we've actually done the fourth one which

3067
01:54:36,960 --> 01:54:40,040
is the model for the Filmore ratings so

3068
01:54:40,040 --> 01:54:41,400
you can see that that's actually worked

3069
01:54:41,400 --> 01:54:44,760
now now if we were to go Docker exact

3070
01:54:44,760 --> 01:54:48,320
hyphen it and then I think it was elt

3071
01:54:48,320 --> 01:54:52,400
Destination _ postgress hyph 1 and then

3072
01:54:52,400 --> 01:54:53,239
we do

3073
01:54:53,239 --> 01:54:56,800
psql hyphen U postgress so then we go

3074
01:54:56,800 --> 01:54:58,480
here we do c

3075
01:54:58,480 --> 01:55:01,760
destination DB we connect there and then

3076
01:55:01,760 --> 01:55:05,119
slash DT so now you can see Filmore

3077
01:55:05,119 --> 01:55:07,360
ratings which is the new table that

3078
01:55:07,360 --> 01:55:09,280
we've written in DBT is actually written

3079
01:55:09,280 --> 01:55:13,520
now if we select all from Filmore

3080
01:55:13,520 --> 01:55:16,400
ratings and it with the semicolon you

3081
01:55:16,400 --> 01:55:19,599
can see that if I move this over it's a

3082
01:55:19,599 --> 01:55:22,719
little big but you can see that our case

3083
01:55:22,719 --> 01:55:24,800
has gone in here uh it's kind of cut off

3084
01:55:24,800 --> 01:55:26,119
just because of the way that my terminal

3085
01:55:26,119 --> 01:55:27,800
looks you can see everything is in there

3086
01:55:27,800 --> 01:55:30,599
so we have our actors we have our film

3087
01:55:30,599 --> 01:55:33,199
ID we have the release date the price

3088
01:55:33,199 --> 01:55:35,000
but the most important part is the

3089
01:55:35,000 --> 01:55:37,560
rating that we've created here so the

3090
01:55:37,560 --> 01:55:39,400
case statement worked successfully so

3091
01:55:39,400 --> 01:55:41,880
anything above a 4.5 was excellent

3092
01:55:41,880 --> 01:55:45,400
anything below that between 4.0 and 4.4

3093
01:55:45,400 --> 01:55:47,320
was good and you had no average one so

3094
01:55:47,320 --> 01:55:48,920
you can see that we've actually created

3095
01:55:48,920 --> 01:55:51,199
this custom model successfully uh along

3096
01:55:51,199 --> 01:55:53,320
with the actor and the actor name so you

3097
01:55:53,320 --> 01:55:55,679
had Inception with Leonardo DiCaprio it

3098
01:55:55,679 --> 01:55:57,280
just looks a little weird because of the

3099
01:55:57,280 --> 01:56:00,400
way that um if I were to do this here so

3100
01:56:00,400 --> 01:56:02,159
let's do the same one so now you can see

3101
01:56:02,159 --> 01:56:04,000
it it it looks a well it still looks a

3102
01:56:04,000 --> 01:56:05,639
little weird but anyways you can see

3103
01:56:05,639 --> 01:56:07,960
that it works so that is creating a

3104
01:56:07,960 --> 01:56:10,520
simple model in DBT now let's look at

3105
01:56:10,520 --> 01:56:13,280
some other Advanced options you can do

3106
01:56:13,280 --> 01:56:15,840
inside of DBT to make your queries a

3107
01:56:15,840 --> 01:56:18,119
little bit more Dynamic is the best way

3108
01:56:18,119 --> 01:56:20,040
to put it okay so now that we've

3109
01:56:20,040 --> 01:56:21,320
actually created the models I told you

3110
01:56:21,320 --> 01:56:22,639
that we're going to get into some

3111
01:56:22,639 --> 01:56:26,079
advanced stuff with DBT and that's why I

3112
01:56:26,079 --> 01:56:28,719
mentioned the macros folder so you can

3113
01:56:28,719 --> 01:56:31,679
think of macros as sort of like a

3114
01:56:31,679 --> 01:56:35,639
reusable components of DBT where you may

3115
01:56:35,639 --> 01:56:38,360
have some sort of queries that you want

3116
01:56:38,360 --> 01:56:41,360
to reuse and is universal through pretty

3117
01:56:41,360 --> 01:56:42,800
much all your models so what if you

3118
01:56:42,800 --> 01:56:44,119
could just create a macro where you

3119
01:56:44,119 --> 01:56:45,760
didn't have to rewrite the same thing

3120
01:56:45,760 --> 01:56:47,119
every single time well you can

3121
01:56:47,119 --> 01:56:48,960
absolutely do that with macros let's

3122
01:56:48,960 --> 01:56:51,719
take the Filmore ratings file for

3123
01:56:51,719 --> 01:56:53,840
example say we wanted to generate this

3124
01:56:53,840 --> 01:56:56,119
every single time uh now that's probably

3125
01:56:56,119 --> 01:56:58,000
not going to happen but let's say we

3126
01:56:58,000 --> 01:57:00,520
wanted to do it and so let's just go

3127
01:57:00,520 --> 01:57:03,920
ahead and actually take the whole file

3128
01:57:03,920 --> 01:57:06,639
and cut it now inside of the macros

3129
01:57:06,639 --> 01:57:08,760
folder what we're going to create is

3130
01:57:08,760 --> 01:57:13,199
we're going to say Filmore ratings macro

3131
01:57:13,199 --> 01:57:15,079
do SQL file everything's going to be a

3132
01:57:15,079 --> 01:57:16,880
SQL file here now what we're going to do

3133
01:57:16,880 --> 01:57:18,920
is we're going to start the file with

3134
01:57:18,920 --> 01:57:21,000
curly brackets both sides are going to

3135
01:57:21,000 --> 01:57:23,280
have a parenthesis so double parentheses

3136
01:57:23,280 --> 01:57:25,560
and inside that we're going to say macro

3137
01:57:25,560 --> 01:57:29,520
generate uncore Filmore ratings uh and

3138
01:57:29,520 --> 01:57:31,760
then we're going to parenthesis after

3139
01:57:31,760 --> 01:57:34,159
now the end of the macro is also going

3140
01:57:34,159 --> 01:57:35,920
to have curly brackets is also going to

3141
01:57:35,920 --> 01:57:38,599
have double parentheses but inside the

3142
01:57:38,599 --> 01:57:40,639
parentheses or I'm sorry inside of the

3143
01:57:40,639 --> 01:57:42,320
uh percent signs you're going to say n

3144
01:57:42,320 --> 01:57:44,400
macro in one word now in between that is

3145
01:57:44,400 --> 01:57:46,199
where your macro is going to go so I'm

3146
01:57:46,199 --> 01:57:48,119
going to go ahead and paste what we just

3147
01:57:48,119 --> 01:57:50,480
took from film ratings into the macro

3148
01:57:50,480 --> 01:57:53,560
now Filmore ratings has nothing but if

3149
01:57:53,560 --> 01:57:56,560
we were to go inside of film ratings now

3150
01:57:56,560 --> 01:57:59,360
all we have to say is two early brackets

3151
01:57:59,360 --> 01:58:00,960
and we're going to call the generate

3152
01:58:00,960 --> 01:58:03,599
Filmore ratings macro so you can see

3153
01:58:03,599 --> 01:58:05,480
that this is the model that we're

3154
01:58:05,480 --> 01:58:07,040
actually writing and the macros never

3155
01:58:07,040 --> 01:58:09,000
actually gets written but if I were

3156
01:58:09,000 --> 01:58:10,840
going to go back into our terminal here

3157
01:58:10,840 --> 01:58:13,079
and let's close this and let's say

3158
01:58:13,079 --> 01:58:15,679
dockor compos down hph V so let's kill

3159
01:58:15,679 --> 01:58:16,800
the volumes here we're going to say

3160
01:58:16,800 --> 01:58:18,360
Docker compose up and it's going to run

3161
01:58:18,360 --> 01:58:20,440
through everything all over again so

3162
01:58:20,440 --> 01:58:22,159
let's go ahead and let that go through

3163
01:58:22,159 --> 01:58:24,520
through really quickly DBT is going to

3164
01:58:24,520 --> 01:58:26,960
start running and then you can see we

3165
01:58:26,960 --> 01:58:29,560
still have four models being written if

3166
01:58:29,560 --> 01:58:33,400
we go back now over to the destination

3167
01:58:33,400 --> 01:58:36,280
database uh SLC

3168
01:58:36,280 --> 01:58:40,440
destination DP and then /dt the Filmore

3169
01:58:40,440 --> 01:58:42,719
ratings table is still getting written

3170
01:58:42,719 --> 01:58:46,440
and if I do select all from

3171
01:58:46,440 --> 01:58:49,000
Filmore ratings you can see that we're

3172
01:58:49,000 --> 01:58:52,199
still writing exactly what we wrote inil

3173
01:58:52,199 --> 01:58:54,280
underscore ratings but we've only been

3174
01:58:54,280 --> 01:58:56,199
using the macro so you can see that

3175
01:58:56,199 --> 01:58:58,880
literally anything inside of the macro

3176
01:58:58,880 --> 01:59:01,440
file in between this section here and

3177
01:59:01,440 --> 01:59:04,280
here is going to be written exactly as

3178
01:59:04,280 --> 01:59:06,639
shown so if I were to say let's I don't

3179
01:59:06,639 --> 01:59:09,199
know let's create a a macro for this

3180
01:59:09,199 --> 01:59:11,960
case which probably is more plausible

3181
01:59:11,960 --> 01:59:14,560
than anything so if I wanted to say

3182
01:59:14,560 --> 01:59:16,360
generate

3183
01:59:16,360 --> 01:59:19,920
ratings macro do SQL and we wanted to do

3184
01:59:19,920 --> 01:59:22,960
the same thing where we go uh let's just

3185
01:59:22,960 --> 01:59:27,360
percent sign this generates ratings and

3186
01:59:27,360 --> 01:59:31,599
then we're going to end macro right and

3187
01:59:31,599 --> 01:59:34,679
then we paste this inside all we have to

3188
01:59:34,679 --> 01:59:38,400
do now is then just say generate ratings

3189
01:59:38,400 --> 01:59:40,440
call that and then we should be able to

3190
01:59:40,440 --> 01:59:42,840
do the same thing uh if we do this

3191
01:59:42,840 --> 01:59:46,760
Docker compos down be compose up let

3192
01:59:46,760 --> 01:59:48,719
that run again yes it takes a little bit

3193
01:59:48,719 --> 01:59:50,560
of time to run it every single time but

3194
01:59:50,560 --> 01:59:52,400
you know this is just what what it comes

3195
01:59:52,400 --> 01:59:54,760
with it be much harder is undefined

3196
01:59:54,760 --> 01:59:58,239
under undefined generate uncore ratings

3197
01:59:58,239 --> 02:00:01,280
it's not generate uncore ratings uh it's

3198
02:00:01,280 --> 02:00:02,920
generate underscore rating wondering if

3199
02:00:02,920 --> 02:00:04,760
you can't call CT EAS here so now you

3200
02:00:04,760 --> 02:00:08,400
can see kind of how macros could work is

3201
02:00:08,400 --> 02:00:10,719
it it allows you to have reusable

3202
02:00:10,719 --> 02:00:13,119
queries throughout your whole DBT

3203
02:00:13,119 --> 02:00:15,000
project essentially to just plug and

3204
02:00:15,000 --> 02:00:17,360
play in and not have to rewrite the same

3205
02:00:17,360 --> 02:00:19,400
thing every single time so if you have

3206
02:00:19,400 --> 02:00:21,760
reusable queries that you can use go

3207
02:00:21,760 --> 02:00:23,960
ahead head and use macros because it's

3208
02:00:23,960 --> 02:00:26,840
very very efficient in terms of not

3209
02:00:26,840 --> 02:00:29,560
having to you know it it implores the

3210
02:00:29,560 --> 02:00:31,639
dry method of software engineering where

3211
02:00:31,639 --> 02:00:32,880
you know don't repeat yourself you don't

3212
02:00:32,880 --> 02:00:34,360
have to repeat yourself every single

3213
02:00:34,360 --> 02:00:36,119
time if you have the same queries over

3214
02:00:36,119 --> 02:00:37,760
and over and over again so utilize

3215
02:00:37,760 --> 02:00:39,760
macros when you can now let's move over

3216
02:00:39,760 --> 02:00:42,440
into gingas which is another feature of

3217
02:00:42,440 --> 02:00:44,400
DBT okay so this next section that I

3218
02:00:44,400 --> 02:00:46,760
just mentioned with gingas gingas are

3219
02:00:46,760 --> 02:00:48,639
essentially what allow you to create

3220
02:00:48,639 --> 02:00:51,000
conditionals or add control structures

3221
02:00:51,000 --> 02:00:53,679
to your SQL queries so for example that

3222
02:00:53,679 --> 02:00:55,440
we're going to use is let's say we

3223
02:00:55,440 --> 02:00:58,880
wanted to select a specific title but

3224
02:00:58,880 --> 02:01:00,360
using a Ginga so we didn't have to

3225
02:01:00,360 --> 02:01:01,920
actually put it within our actual SQL

3226
02:01:01,920 --> 02:01:03,360
query that's what it allows us to do it

3227
02:01:03,360 --> 02:01:05,360
could allow you to select you know do we

3228
02:01:05,360 --> 02:01:07,880
want to use the prod Target instead of

3229
02:01:07,880 --> 02:01:10,880
the dev Target inside of our DBT project

3230
02:01:10,880 --> 02:01:12,840
then we could do that as well and we can

3231
02:01:12,840 --> 02:01:14,840
change the way that queries are done

3232
02:01:14,840 --> 02:01:16,880
again adding a control structure so

3233
02:01:16,880 --> 02:01:18,679
let's go ahead and inside of our example

3234
02:01:18,679 --> 02:01:20,560
folder we're going to create a file

3235
02:01:20,560 --> 02:01:23,400
called specific under _ movie SQL and

3236
02:01:23,400 --> 02:01:24,840
inside of that is where we're going to

3237
02:01:24,840 --> 02:01:26,920
start with our Ginger here so again

3238
02:01:26,920 --> 02:01:28,840
starts with a curly bracket and then two

3239
02:01:28,840 --> 02:01:30,480
percent signs and inside of that we're

3240
02:01:30,480 --> 02:01:32,280
going to say sets so when you see sets

3241
02:01:32,280 --> 02:01:33,840
is essentially what is starting our

3242
02:01:33,840 --> 02:01:35,079
control structure here and we're going

3243
02:01:35,079 --> 02:01:38,760
to set Filmore title to equal for this

3244
02:01:38,760 --> 02:01:40,159
example we're going to say Dunkirk cuz I

3245
02:01:40,159 --> 02:01:41,440
know that's going to be a movie inside

3246
02:01:41,440 --> 02:01:44,000
of the demo or the um test database here

3247
02:01:44,000 --> 02:01:45,400
so Dunkirk is going to be a movie that

3248
02:01:45,400 --> 02:01:46,840
we're going to look for right now inside

3249
02:01:46,840 --> 02:01:48,159
of that we're going to say select so

3250
02:01:48,159 --> 02:01:49,760
this is the actual query itself select

3251
02:01:49,760 --> 02:01:52,400
all from and we're going to reference

3252
02:01:52,400 --> 02:01:55,840
the uh films table here where let's

3253
02:01:55,840 --> 02:01:58,040
practice here where title equals and

3254
02:01:58,040 --> 02:02:01,560
then we can say in the single quotes

3255
02:02:01,560 --> 02:02:04,639
Filmore title so that is obviously the

3256
02:02:04,639 --> 02:02:07,480
variable that we've set up here right

3257
02:02:07,480 --> 02:02:08,880
that's going to be our Ginger here we're

3258
02:02:08,880 --> 02:02:10,800
setting a control structure where we

3259
02:02:10,800 --> 02:02:13,079
only want to select the title where

3260
02:02:13,079 --> 02:02:15,440
dynamically the value we've set here is

3261
02:02:15,440 --> 02:02:17,040
dunker and obviously this can be

3262
02:02:17,040 --> 02:02:18,520
anything we want it to be but so let's

3263
02:02:18,520 --> 02:02:21,280
go ahead and save that and then run our

3264
02:02:21,280 --> 02:02:23,719
docker compose up here and let

3265
02:02:23,719 --> 02:02:27,159
everything go when DBT runs we should

3266
02:02:27,159 --> 02:02:29,280
have a fifth model that runs which is

3267
02:02:29,280 --> 02:02:31,239
going to be our specific movie and so

3268
02:02:31,239 --> 02:02:33,280
let's go ahead and let that run here

3269
02:02:33,280 --> 02:02:34,920
there's going to be the fifth it's all

3270
02:02:34,920 --> 02:02:38,159
pass very good let's run our destination

3271
02:02:38,159 --> 02:02:41,440
database and SLC into it so

3272
02:02:41,440 --> 02:02:43,400
destination

3273
02:02:43,400 --> 02:02:46,480
db/dt and you can see specific movie is

3274
02:02:46,480 --> 02:02:49,239
now a table inside of this database and

3275
02:02:49,239 --> 02:02:53,079
so if I say select all from specific

3276
02:02:53,079 --> 02:02:56,000
uncore movie you can see Dunkirk as well

3277
02:02:56,000 --> 02:02:57,920
as all of its information including the

3278
02:02:57,920 --> 02:02:59,639
film ID the release date price rating

3279
02:02:59,639 --> 02:03:02,040
and user rating is going to be in there

3280
02:03:02,040 --> 02:03:04,159
because we've used the ginger in there

3281
02:03:04,159 --> 02:03:06,440
now it allows you to to pretty much do

3282
02:03:06,440 --> 02:03:08,280
anything you want you know if we wanted

3283
02:03:08,280 --> 02:03:11,440
to go into the macro here and create

3284
02:03:11,440 --> 02:03:13,520
conditionals where we have an excellent

3285
02:03:13,520 --> 02:03:15,520
condition a good condition or an average

3286
02:03:15,520 --> 02:03:17,639
condition and we set those to be this

3287
02:03:17,639 --> 02:03:19,480
number we can absolutely do that and

3288
02:03:19,480 --> 02:03:22,159
allows us to do that outside of the

3289
02:03:22,159 --> 02:03:24,520
query so that way we can know that up

3290
02:03:24,520 --> 02:03:26,960
here we can set it to a different movie

3291
02:03:26,960 --> 02:03:29,800
you know if we wanted to do Inception we

3292
02:03:29,800 --> 02:03:32,280
we're only changing it Inception pretty

3293
02:03:32,280 --> 02:03:33,599
sure that's how you spell it if it's not

3294
02:03:33,599 --> 02:03:35,239
that's going to be very awkward but so

3295
02:03:35,239 --> 02:03:38,400
let's do this Docker compose down V

3296
02:03:38,400 --> 02:03:41,440
Docker compose up let's run this again

3297
02:03:41,440 --> 02:03:43,840
and so when we run this we should see

3298
02:03:43,840 --> 02:03:46,520
that the specific movie has then changed

3299
02:03:46,520 --> 02:03:48,800
over to Inception instead of dunker

3300
02:03:48,800 --> 02:03:51,559
therefore showing that the ginger works

3301
02:03:51,559 --> 02:03:53,360
and it it allows for a little bit more

3302
02:03:53,360 --> 02:03:55,400
readability right because you can see

3303
02:03:55,400 --> 02:03:56,880
that our film title we've set it to a

3304
02:03:56,880 --> 02:03:58,920
variable we're not you know manually

3305
02:03:58,920 --> 02:04:02,679
searching for a a movie here and we're

3306
02:04:02,679 --> 02:04:06,639
going to do select all from a specific

3307
02:04:06,639 --> 02:04:08,719
movie and now you can see Inception is

3308
02:04:08,719 --> 02:04:12,520
now there so again a very simple example

3309
02:04:12,520 --> 02:04:14,800
of what a ginger is and kind of how it

3310
02:04:14,800 --> 02:04:16,880
works but go ahead and play with it I

3311
02:04:16,880 --> 02:04:18,639
implore you to kind of you know

3312
02:04:18,639 --> 02:04:21,400
integrate gingas with macros to really

3313
02:04:21,400 --> 02:04:23,719
really you know use the full power of

3314
02:04:23,719 --> 02:04:26,199
macros and gingas together and I think

3315
02:04:26,199 --> 02:04:29,079
it could really 10x your SQL queries and

3316
02:04:29,079 --> 02:04:31,679
your custom models from within DBT and

3317
02:04:31,679 --> 02:04:33,960
really just Excel that process of the

3318
02:04:33,960 --> 02:04:36,800
whole data engineering SL data analytics

3319
02:04:36,800 --> 02:04:39,119
process all together okay so as I've

3320
02:04:39,119 --> 02:04:41,000
mentioned before we're going to be

3321
02:04:41,000 --> 02:04:44,840
adding a Cron job to this not ideal I

3322
02:04:44,840 --> 02:04:46,760
guess you could say in the sense of that

3323
02:04:46,760 --> 02:04:49,199
like it's not necessarily the best

3324
02:04:49,199 --> 02:04:50,840
implementation I guess you could say but

3325
02:04:50,840 --> 02:04:52,320
there are a lot of other people out

3326
02:04:52,320 --> 02:04:54,400
there that use Crown jobs I'm going to

3327
02:04:54,400 --> 02:04:55,800
show you the way you can Implement a

3328
02:04:55,800 --> 02:04:57,639
crown job because again you don't want

3329
02:04:57,639 --> 02:04:59,679
to manually be triggering these data

3330
02:04:59,679 --> 02:05:02,079
syns or this pipeline to be running on

3331
02:05:02,079 --> 02:05:03,320
your own you kind of want some

3332
02:05:03,320 --> 02:05:05,119
automation here so the first thing we're

3333
02:05:05,119 --> 02:05:06,559
going to do is add the crown job I'll

3334
02:05:06,559 --> 02:05:08,400
show you how you can do that in this

3335
02:05:08,400 --> 02:05:10,239
type of implementation obviously there's

3336
02:05:10,239 --> 02:05:11,719
different ways to implement it but this

3337
02:05:11,719 --> 02:05:13,679
will eventually evolve into US adding a

3338
02:05:13,679 --> 02:05:15,440
tool called airflow air flow is going to

3339
02:05:15,440 --> 02:05:17,199
be an orchestration tool that easily

3340
02:05:17,199 --> 02:05:19,400
allow us to kind of have more control

3341
02:05:19,400 --> 02:05:21,760
than a Cron job over each individual

3342
02:05:21,760 --> 02:05:23,639
task inside of our project to allow us

3343
02:05:23,639 --> 02:05:25,400
to schedule it properly I think the best

3344
02:05:25,400 --> 02:05:27,119
thing that you can have is more control

3345
02:05:27,119 --> 02:05:29,360
outside of just scheduling when it runs

3346
02:05:29,360 --> 02:05:30,920
and so let me go ahead and show you how

3347
02:05:30,920 --> 02:05:32,520
the Cron job works first and then we'll

3348
02:05:32,520 --> 02:05:34,360
move into airflow and other

3349
02:05:34,360 --> 02:05:36,440
orchestration tools like that okay so

3350
02:05:36,440 --> 02:05:39,000
for the Cron job the main file we got to

3351
02:05:39,000 --> 02:05:41,239
go into is going to be the docker file

3352
02:05:41,239 --> 02:05:44,599
now because we're primarily main working

3353
02:05:44,599 --> 02:05:47,599
on the El script and we want to schedule

3354
02:05:47,599 --> 02:05:48,760
that this is where we're going to run

3355
02:05:48,760 --> 02:05:50,840
everything so just going to be some

3356
02:05:50,840 --> 02:05:52,360
slight modifications here so the one

3357
02:05:52,360 --> 02:05:53,559
thing we're going to do is we're going

3358
02:05:53,559 --> 02:05:56,880
to add KRON to the end of the list of

3359
02:05:56,880 --> 02:05:58,119
installs we're going to do so we're

3360
02:05:58,119 --> 02:06:00,440
going to run for postgress client as

3361
02:06:00,440 --> 02:06:02,840
well as cron underneath here now what

3362
02:06:02,840 --> 02:06:04,440
we're going to do is we're going to

3363
02:06:04,440 --> 02:06:06,360
create a new file called

3364
02:06:06,360 --> 02:06:08,360
start.sh now this is going to be a bash

3365
02:06:08,360 --> 02:06:09,920
script that we run so this sits in the

3366
02:06:09,920 --> 02:06:11,440
root directory and we'll modify this

3367
02:06:11,440 --> 02:06:14,440
later but above this copy script or

3368
02:06:14,440 --> 02:06:16,719
above this copy command that we have

3369
02:06:16,719 --> 02:06:18,480
we're going to add another one and this

3370
02:06:18,480 --> 02:06:20,960
one's going to be start.sh uh and we're

3371
02:06:20,960 --> 02:06:22,960
going to copy this over to the app

3372
02:06:22,960 --> 02:06:25,760
directory of Docker so that Docker now

3373
02:06:25,760 --> 02:06:29,239
has the start.sh file within its own

3374
02:06:29,239 --> 02:06:31,800
container here the working directory is

3375
02:06:31,800 --> 02:06:33,440
going to be the app so we're going to

3376
02:06:33,440 --> 02:06:36,400
say worker is going to be slapp here in

3377
02:06:36,400 --> 02:06:38,079
between work directory and command this

3378
02:06:38,079 --> 02:06:40,119
is where we're going to add the Cron job

3379
02:06:40,119 --> 02:06:41,920
now for this example we're going to run

3380
02:06:41,920 --> 02:06:44,320
the script let's say every day at 3:00

3381
02:06:44,320 --> 02:06:46,520
a.m. so we're going to do a run command

3382
02:06:46,520 --> 02:06:48,239
here and then we're going to Echo and

3383
02:06:48,239 --> 02:06:50,239
then in quotes we're going to say zero

3384
02:06:50,239 --> 02:06:53,599
space three and then three asterisks and

3385
02:06:53,599 --> 02:06:55,280
I'm sure there's like you know sources

3386
02:06:55,280 --> 02:06:57,520
online that can show you kind of like

3387
02:06:57,520 --> 02:06:59,920
how to properly write a Cron job for a

3388
02:06:59,920 --> 02:07:01,400
specific time this is just the one that

3389
02:07:01,400 --> 02:07:05,000
I have now we're going to say python SLA

3390
02:07:05,000 --> 02:07:06,880
_

3391
02:07:06,880 --> 02:07:09,000
script.py and then outside of that we're

3392
02:07:09,000 --> 02:07:10,760
going to do the divider here and then

3393
02:07:10,760 --> 02:07:12,599
we're going to say cron tab now we're

3394
02:07:12,599 --> 02:07:14,400
going to save this and then if we go

3395
02:07:14,400 --> 02:07:17,079
back into start. s this is where we're

3396
02:07:17,079 --> 02:07:20,800
going to write the uh how to actually

3397
02:07:20,800 --> 02:07:23,040
start the Cron demon so at the very top

3398
02:07:23,040 --> 02:07:25,239
we're going to say cron and and that

3399
02:07:25,239 --> 02:07:27,760
pretty much is what's going to run the

3400
02:07:27,760 --> 02:07:30,199
cron and have it run in the background

3401
02:07:30,199 --> 02:07:33,520
and then python slapp

3402
02:07:33,520 --> 02:07:37,639
_ script.py what this is going to do is

3403
02:07:37,639 --> 02:07:40,079
we have the bash script and it's in our

3404
02:07:40,079 --> 02:07:42,840
working directory we're going to run

3405
02:07:42,840 --> 02:07:44,400
this command here when the docker

3406
02:07:44,400 --> 02:07:46,760
container starts and now this bash

3407
02:07:46,760 --> 02:07:48,800
script is going to run the pron Damon in

3408
02:07:48,800 --> 02:07:50,679
the background and then run this every

3409
02:07:50,679 --> 02:07:52,760
single time it's 3:00 a.m. and so we'll

3410
02:07:52,760 --> 02:07:54,400
run the bat script at 3:00 a.m. every

3411
02:07:54,400 --> 02:07:56,840
single time due to this Crown so again a

3412
02:07:56,840 --> 02:07:58,559
very simple implementation of how the

3413
02:07:58,559 --> 02:08:00,040
cron is supposed to work obviously it's

3414
02:08:00,040 --> 02:08:01,520
hard to demonstrate this because it's

3415
02:08:01,520 --> 02:08:03,360
6:50 p.m. right now so I can't really

3416
02:08:03,360 --> 02:08:06,520
just wait here until 3:00 a.m. but now

3417
02:08:06,520 --> 02:08:09,040
at 3:00 a.m. every single time this will

3418
02:08:09,040 --> 02:08:11,400
run so yeah that's essentially how this

3419
02:08:11,400 --> 02:08:13,920
Cron job is going to work now let's move

3420
02:08:13,920 --> 02:08:16,880
into how airflow is going to play in the

3421
02:08:16,880 --> 02:08:18,920
mix and how we can now orchestrate this

3422
02:08:18,920 --> 02:08:21,000
using a real open source tool that's out

3423
02:08:21,000 --> 02:08:22,760
there in the wild all right so in this

3424
02:08:22,760 --> 02:08:24,679
section we're going to be adding airflow

3425
02:08:24,679 --> 02:08:27,079
to our project and as I mentioned before

3426
02:08:27,079 --> 02:08:29,679
airflow is an orchestration tool open

3427
02:08:29,679 --> 02:08:31,920
source that allows you to essentially

3428
02:08:31,920 --> 02:08:33,800
have a top down view of every single

3429
02:08:33,800 --> 02:08:36,559
task and say Hey I want my elt script to

3430
02:08:36,559 --> 02:08:38,599
run first and then once this finishes

3431
02:08:38,599 --> 02:08:39,840
and is

3432
02:08:39,840 --> 02:08:41,920
successful and that's exactly what we're

3433
02:08:41,920 --> 02:08:43,000
going to do here we're going to

3434
02:08:43,000 --> 02:08:45,199
orchestrate all of our tools and all of

3435
02:08:45,199 --> 02:08:46,960
the working pieces that we have right

3436
02:08:46,960 --> 02:08:48,280
now to make sure that they work

3437
02:08:48,280 --> 02:08:50,360
sequentially here and you know there's a

3438
02:08:50,360 --> 02:08:52,360
lot of different use cases with airflow

3439
02:08:52,360 --> 02:08:54,440
or other open source tools like Daxter

3440
02:08:54,440 --> 02:08:56,119
or prefect but we're simply going to be

3441
02:08:56,119 --> 02:08:57,880
using airflow as our orchestration tool

3442
02:08:57,880 --> 02:08:59,679
to make sure that our pipeline is

3443
02:08:59,679 --> 02:09:01,599
working the way we want it to and has

3444
02:09:01,599 --> 02:09:03,400
some form of automation here all right

3445
02:09:03,400 --> 02:09:04,960
so first thing we're going to do is

3446
02:09:04,960 --> 02:09:07,159
going to create a new folder here and

3447
02:09:07,159 --> 02:09:09,040
we're going to name this airflow and

3448
02:09:09,040 --> 02:09:10,920
inside of airflow we're going to have

3449
02:09:10,920 --> 02:09:14,119
another folder called dags and a dag is

3450
02:09:14,119 --> 02:09:16,400
simply a directed acyclic graph I think

3451
02:09:16,400 --> 02:09:19,040
is how you pronounce the a part but so

3452
02:09:19,040 --> 02:09:21,719
the dag is what we write in order to

3453
02:09:21,719 --> 02:09:24,119
orchestrate all of our tasks together

3454
02:09:24,119 --> 02:09:26,159
and also put in some of our Logic for

3455
02:09:26,159 --> 02:09:28,040
each task so that's what we're going to

3456
02:09:28,040 --> 02:09:30,440
be writing here in DBT we were writing

3457
02:09:30,440 --> 02:09:32,639
uh models custom models in airflow we

3458
02:09:32,639 --> 02:09:35,320
write dags or in any orchestration tool

3459
02:09:35,320 --> 02:09:37,199
we're going to be writing a dag so that

3460
02:09:37,199 --> 02:09:39,079
is another term for you to put into your

3461
02:09:39,079 --> 02:09:41,199
brain as knowledge to know as a data

3462
02:09:41,199 --> 02:09:42,520
engineer the other thing we're also

3463
02:09:42,520 --> 02:09:44,800
going to create here is a file not

3464
02:09:44,800 --> 02:09:48,280
inside of the dags folder so this is

3465
02:09:48,280 --> 02:09:50,199
going to go into the root folder of

3466
02:09:50,199 --> 02:09:52,800
airflow but this is going to be airflow.

3467
02:09:52,800 --> 02:09:54,360
CFG I think we just need this for

3468
02:09:54,360 --> 02:09:56,000
airflow specifically we don't need to

3469
02:09:56,000 --> 02:09:57,480
put anything in it but if you needed to

3470
02:09:57,480 --> 02:09:59,440
do anything with your configuration of

3471
02:09:59,440 --> 02:10:01,000
airf flow this is going to be the file

3472
02:10:01,000 --> 02:10:02,199
that you're going to put it in now that

3473
02:10:02,199 --> 02:10:05,239
we have this structure put together

3474
02:10:05,239 --> 02:10:07,000
let's go ahead and go into our Docker

3475
02:10:07,000 --> 02:10:09,360
compos file and then add the airflow

3476
02:10:09,360 --> 02:10:10,960
service this is going to be a little

3477
02:10:10,960 --> 02:10:13,440
extensive because it is a big service so

3478
02:10:13,440 --> 02:10:14,639
we're going to take our time with this

3479
02:10:14,639 --> 02:10:16,400
one and really go through it all right

3480
02:10:16,400 --> 02:10:19,400
so uh underneath the DBT section we're

3481
02:10:19,400 --> 02:10:21,320
going to go here and add a couple spaces

3482
02:10:21,320 --> 02:10:22,520
because we're actually going to be

3483
02:10:22,520 --> 02:10:25,520
adding quite a bit of new Services here

3484
02:10:25,520 --> 02:10:26,800
that have to work with airf flow it

3485
02:10:26,800 --> 02:10:28,440
would be a lot but I've narrowed it down

3486
02:10:28,440 --> 02:10:30,360
to be very minimal here so we don't have

3487
02:10:30,360 --> 02:10:31,800
to worry about that too much so the

3488
02:10:31,800 --> 02:10:33,360
first thing we're actually going to add

3489
02:10:33,360 --> 02:10:35,559
is going to be another postgress service

3490
02:10:35,559 --> 02:10:37,559
and why are we adding another postgress

3491
02:10:37,559 --> 02:10:40,119
service here well it's because airflow

3492
02:10:40,119 --> 02:10:42,719
needs a database to store its metadata

3493
02:10:42,719 --> 02:10:44,800
and its logs so this is the database

3494
02:10:44,800 --> 02:10:46,559
that's going to go into it's going to be

3495
02:10:46,559 --> 02:10:48,480
the same look here where we're going to

3496
02:10:48,480 --> 02:10:51,040
say postgress and the latest image here

3497
02:10:51,040 --> 02:10:53,360
right um networks we're going to tie

3498
02:10:53,360 --> 02:10:57,840
into the elt uncore network and then for

3499
02:10:57,840 --> 02:11:00,440
the environment let's do this so

3500
02:11:00,440 --> 02:11:02,599
environment we're going to do postgress

3501
02:11:02,599 --> 02:11:06,679
user is going to equal airflow here we

3502
02:11:06,679 --> 02:11:09,320
have postgress password which is going

3503
02:11:09,320 --> 02:11:12,840
to equal also airflow and then for the

3504
02:11:12,840 --> 02:11:15,800
postgress DB this is going to be airflow

3505
02:11:15,800 --> 02:11:19,119
so very simple there now fix this now

3506
02:11:19,119 --> 02:11:21,320
that's the metadata service so you can

3507
02:11:21,320 --> 02:11:22,639
name that whatever you want but I'm for

3508
02:11:22,639 --> 02:11:24,760
Simplicity sake I'm going to keep it as

3509
02:11:24,760 --> 02:11:26,760
postgress next thing we need to do is

3510
02:11:26,760 --> 02:11:29,599
going to be anit airflow service now for

3511
02:11:29,599 --> 02:11:31,840
the inet airflow service what this is

3512
02:11:31,840 --> 02:11:35,079
primarily doing here is initializing the

3513
02:11:35,079 --> 02:11:37,800
user and the database that we just

3514
02:11:37,800 --> 02:11:40,159
created alt together for airflow so we

3515
02:11:40,159 --> 02:11:41,679
had we're going to add two more services

3516
02:11:41,679 --> 02:11:44,840
after this but this is a very important

3517
02:11:44,840 --> 02:11:47,079
service for us because without this

3518
02:11:47,079 --> 02:11:48,599
we're not going to have the admin user

3519
02:11:48,599 --> 02:11:50,960
and be able to create new connections

3520
02:11:50,960 --> 02:11:52,800
and things like that so this is very

3521
02:11:52,800 --> 02:11:54,920
important here now the image that we're

3522
02:11:54,920 --> 02:11:57,040
going to add is going to be Apache so

3523
02:11:57,040 --> 02:11:58,760
the Apache project open source projects

3524
02:11:58,760 --> 02:12:00,920
airflow and then latest this is going to

3525
02:12:00,920 --> 02:12:03,960
be the same for pretty much every single

3526
02:12:03,960 --> 02:12:05,639
uh I think it's going to be the same for

3527
02:12:05,639 --> 02:12:07,119
every single one but I could be wrong uh

3528
02:12:07,119 --> 02:12:09,079
anyway so image this is going to depend

3529
02:12:09,079 --> 02:12:11,760
on postgress cuz we need that database

3530
02:12:11,760 --> 02:12:14,000
to be initialized essentially before we

3531
02:12:14,000 --> 02:12:15,559
initialize airflow because without it

3532
02:12:15,559 --> 02:12:16,760
we're going to have some errors here

3533
02:12:16,760 --> 02:12:19,199
networks again we're going to say _

3534
02:12:19,199 --> 02:12:21,239
Network for the environments we're going

3535
02:12:21,239 --> 02:12:22,440
going to say this is going to be a long

3536
02:12:22,440 --> 02:12:25,639
one so airflow underscore underscore so

3537
02:12:25,639 --> 02:12:27,520
two underscores database underscore

3538
02:12:27,520 --> 02:12:32,119
uncore SQL underscore Alchemy _ con for

3539
02:12:32,119 --> 02:12:34,679
connection is going to equal and this is

3540
02:12:34,679 --> 02:12:36,920
going to be pointing to our postgress

3541
02:12:36,920 --> 02:12:38,639
data base here that we just created so

3542
02:12:38,639 --> 02:12:40,440
postgress

3543
02:12:40,440 --> 02:12:45,880
plusy cop G2 col SL SL airflow for

3544
02:12:45,880 --> 02:12:49,559
username and password here at postgress

3545
02:12:49,559 --> 02:12:51,880
SL airflow okay so that's that's a long

3546
02:12:51,880 --> 02:12:54,520
one but that's going to be the

3547
02:12:54,520 --> 02:12:57,440
environment there now last one we need

3548
02:12:57,440 --> 02:12:59,920
is a command the command we're going to

3549
02:12:59,920 --> 02:13:03,079
say uh less than or greater than sign

3550
02:13:03,079 --> 02:13:06,360
and in we're going to say bash I see in

3551
02:13:06,360 --> 02:13:09,880
quotes airfow EB and nit to initialize

3552
02:13:09,880 --> 02:13:13,040
the database for airflow and and string

3553
02:13:13,040 --> 02:13:16,079
on another one here push it over here

3554
02:13:16,079 --> 02:13:19,199
say airflow users create so we're this

3555
02:13:19,199 --> 02:13:21,440
is where we create the admin account

3556
02:13:21,440 --> 02:13:25,040
username airflow password is going to be

3557
02:13:25,040 --> 02:13:28,840
password let's just say first first name

3558
02:13:28,840 --> 02:13:32,800
is going to John last name is going to

3559
02:13:32,800 --> 02:13:35,719
be do we want the role here to be admin

3560
02:13:35,719 --> 02:13:37,840
and then the email we need to set let's

3561
02:13:37,840 --> 02:13:40,800
say admin at ample cool all right so

3562
02:13:40,800 --> 02:13:43,000
that's a pretty long one there already

3563
02:13:43,000 --> 02:13:45,719
let's go down here into the next service

3564
02:13:45,719 --> 02:13:47,000
that we need to create so that's our

3565
02:13:47,000 --> 02:13:48,840
initialization of airflow now we're

3566
02:13:48,840 --> 02:13:51,079
going to get into the actual like UI of

3567
02:13:51,079 --> 02:13:52,639
air flow which is going to be the web

3568
02:13:52,639 --> 02:13:55,239
server service let me add some spacing

3569
02:13:55,239 --> 02:13:56,960
here the image we're actually going to

3570
02:13:56,960 --> 02:13:59,119
create a Docker file for this so we need

3571
02:13:59,119 --> 02:14:02,679
to do that first now in the root of the

3572
02:14:02,679 --> 02:14:04,679
directory here we're going to say Docker

3573
02:14:04,679 --> 02:14:06,840
file and then in here we're going to say

3574
02:14:06,840 --> 02:14:10,320
from Apache SL airflow latest so the

3575
02:14:10,320 --> 02:14:12,480
same thing that we did uh with the

3576
02:14:12,480 --> 02:14:13,840
initialization of airf flow now we're

3577
02:14:13,840 --> 02:14:17,480
going to say run tip install Apache

3578
02:14:17,480 --> 02:14:20,360
airflow providers Docker now this is

3579
02:14:20,360 --> 02:14:22,719
going to come in handy later on but we

3580
02:14:22,719 --> 02:14:24,360
do need this in order to run this

3581
02:14:24,360 --> 02:14:26,119
command here airflow has a bunch of

3582
02:14:26,119 --> 02:14:27,880
different providers for you to access

3583
02:14:27,880 --> 02:14:29,559
different Integrations Docker being one

3584
02:14:29,559 --> 02:14:30,960
of them and there's going to be another

3585
02:14:30,960 --> 02:14:32,520
couple ones that we're going to use

3586
02:14:32,520 --> 02:14:34,000
later down the line but Docker is the

3587
02:14:34,000 --> 02:14:36,159
one we need so now that we have this

3588
02:14:36,159 --> 02:14:38,040
we're going to go back into our Docker

3589
02:14:38,040 --> 02:14:40,040
compos file and then for the build

3590
02:14:40,040 --> 02:14:42,199
section we're going to say build context

3591
02:14:42,199 --> 02:14:44,119
just add the dot here the docker file

3592
02:14:44,119 --> 02:14:46,199
we're going to point to Docker file uh

3593
02:14:46,199 --> 02:14:48,520
just capitalize this part the user here

3594
02:14:48,520 --> 02:14:50,520
is going to be root because we want the

3595
02:14:50,520 --> 02:14:52,360
root here here and then it depends on

3596
02:14:52,360 --> 02:14:54,719
the postgress service so we do not want

3597
02:14:54,719 --> 02:14:57,159
airfall to initialize until the metadata

3598
02:14:57,159 --> 02:14:59,480
store essentially is is initialized

3599
02:14:59,480 --> 02:15:01,199
networks we're going to point over to

3600
02:15:01,199 --> 02:15:02,599
the elt network and this is going to be

3601
02:15:02,599 --> 02:15:05,440
a special one here so extra hosts extra

3602
02:15:05,440 --> 02:15:08,000
hosts is going to be an interesting one

3603
02:15:08,000 --> 02:15:09,520
because we are running everything on

3604
02:15:09,520 --> 02:15:12,000
Docker we actually need this for special

3605
02:15:12,000 --> 02:15:14,480
reasons that'll come up later but so in

3606
02:15:14,480 --> 02:15:16,320
double quotes we're going to say host.

3607
02:15:16,320 --> 02:15:18,400
doer. internal and then we're actually

3608
02:15:18,400 --> 02:15:21,800
going to point that to host Gateway okay

3609
02:15:21,800 --> 02:15:24,520
so that points to inside Docker the host

3610
02:15:24,520 --> 02:15:26,040
Gateway that's going to come in handy

3611
02:15:26,040 --> 02:15:27,480
later so now that we have that we're

3612
02:15:27,480 --> 02:15:29,480
going to point to some volumes here now

3613
02:15:29,480 --> 02:15:31,320
the volumes are going to be very

3614
02:15:31,320 --> 02:15:34,159
important so we have our dags that we

3615
02:15:34,159 --> 02:15:36,880
need to find So within that we're going

3616
02:15:36,880 --> 02:15:40,239
to say/ airflow SL dags so now we have

3617
02:15:40,239 --> 02:15:42,520
our dags folder now we need to map it so

3618
02:15:42,520 --> 02:15:44,360
we're going to map it to the SL opt

3619
02:15:44,360 --> 02:15:49,000
slair flow/ dags so now we have the same

3620
02:15:49,000 --> 02:15:51,960
directory of dags inside the opt folder

3621
02:15:51,960 --> 02:15:53,880
and then it'll go to airflow deck so now

3622
02:15:53,880 --> 02:15:55,040
we have that inside of our Docker

3623
02:15:55,040 --> 02:15:56,719
container next one next one is going to

3624
02:15:56,719 --> 02:15:58,520
be the elt script that we have because

3625
02:15:58,520 --> 02:16:00,159
we need access to that

3626
02:16:00,159 --> 02:16:02,800
so/ is the folder that we have and then

3627
02:16:02,800 --> 02:16:04,559
we're going to say we going to map that

3628
02:16:04,559 --> 02:16:09,760
over again to/ opt SL airflow elt so now

3629
02:16:09,760 --> 02:16:12,239
we have our own elt folder with the

3630
02:16:12,239 --> 02:16:14,400
script and all of its contents which is

3631
02:16:14,400 --> 02:16:15,880
just the bash script there now we need

3632
02:16:15,880 --> 02:16:17,800
the Transformations because we're also

3633
02:16:17,800 --> 02:16:20,239
going to be orchestrating not only the

3634
02:16:20,239 --> 02:16:21,719
script but we're also going to be

3635
02:16:21,719 --> 02:16:24,000
orchestrating DBT and we need access to

3636
02:16:24,000 --> 02:16:26,520
those files so we're going to say slash

3637
02:16:26,520 --> 02:16:29,280
custom hostress that is going to map

3638
02:16:29,280 --> 02:16:32,880
over to slop SL DBT now we have the DBT

3639
02:16:32,880 --> 02:16:34,359
folder in there we're going to need the

3640
02:16:34,359 --> 02:16:36,200
profiles for DBT so we're going to say

3641
02:16:36,200 --> 02:16:38,800
Tilda sl. DBT and then we're going to

3642
02:16:38,800 --> 02:16:41,960
point that over to SL root

3643
02:16:41,960 --> 02:16:44,280
sl. I hopefully this is all making sense

3644
02:16:44,280 --> 02:16:46,960
here this one is going to be opening up

3645
02:16:46,960 --> 02:16:49,200
essentially giving airflow access to the

3646
02:16:49,200 --> 02:16:51,399
essentially the docker Network so we

3647
02:16:51,399 --> 02:16:52,599
this is going to be very important here

3648
02:16:52,599 --> 02:16:55,679
so we're going to say /var SL run/ doer.

3649
02:16:55,679 --> 02:16:57,519
sock we're giving access to the socket

3650
02:16:57,519 --> 02:16:59,880
there SLV bar we mapping get to SL far

3651
02:16:59,880 --> 02:17:02,920
SL run/ doer okay cool now for the

3652
02:17:02,920 --> 02:17:04,200
environment variables and this is going

3653
02:17:04,200 --> 02:17:05,599
to get really long here so we're going

3654
02:17:05,599 --> 02:17:07,359
to get environment variables here the

3655
02:17:07,359 --> 02:17:10,240
first one is going to be load underscore

3656
02:17:10,240 --> 02:17:12,920
x = n these are all just going to be

3657
02:17:12,920 --> 02:17:16,679
needed for airf flow executor equals

3658
02:17:16,679 --> 02:17:19,559
local and we're going to say airflow and

3659
02:17:19,559 --> 02:17:21,000
then we're mapping this back to the

3660
02:17:21,000 --> 02:17:23,880
database here soore undor database

3661
02:17:23,880 --> 02:17:26,319
Alchemy con so I've just copy and paste

3662
02:17:26,319 --> 02:17:28,639
this over actually cool so I've got that

3663
02:17:28,639 --> 02:17:31,200
now one thing airflow does need is it's

3664
02:17:31,200 --> 02:17:34,679
going to need a fernet key underscore

3665
02:17:34,679 --> 02:17:37,319
fetor key so that's only one underscore

3666
02:17:37,319 --> 02:17:38,559
there and then we're going to say equals

3667
02:17:38,559 --> 02:17:40,559
it essentially encrypts the username and

3668
02:17:40,559 --> 02:17:42,639
password it's for a security reason

3669
02:17:42,639 --> 02:17:44,639
we're just going to do that because you

3670
02:17:44,639 --> 02:17:46,399
know for the sake of this video so I've

3671
02:17:46,399 --> 02:17:47,800
actually if we go to orchestration

3672
02:17:47,800 --> 02:17:49,800
airflow I have this command which I will

3673
02:17:49,800 --> 02:17:52,120
also leave for you in the description

3674
02:17:52,120 --> 02:17:53,359
but this is essentially going to

3675
02:17:53,359 --> 02:17:56,040
generate our fernet key for us and what

3676
02:17:56,040 --> 02:17:58,000
we're going to do is copy and paste that

3677
02:17:58,000 --> 02:18:01,120
command into our terminal and it should

3678
02:18:01,120 --> 02:18:04,160
spit out to us a key which we will then

3679
02:18:04,160 --> 02:18:06,439
use and paste here so now that is our

3680
02:18:06,439 --> 02:18:09,319
fet key that we're going to just leave

3681
02:18:09,319 --> 02:18:12,880
in and will be used for encryption sake

3682
02:18:12,880 --> 02:18:15,679
right and for security there's that uh

3683
02:18:15,679 --> 02:18:18,840
now we're going to need airflow uncore

3684
02:18:18,840 --> 02:18:21,599
uncore web server

3685
02:18:21,599 --> 02:18:27,280
uncore default user underscore username

3686
02:18:27,280 --> 02:18:28,800
and that's just going to be airflow I'm

3687
02:18:28,800 --> 02:18:30,599
actually going to copy this and then

3688
02:18:30,599 --> 02:18:34,880
just change the last bit here to say

3689
02:18:34,880 --> 02:18:38,200
oops say password and this was going to

3690
02:18:38,200 --> 02:18:41,160
be password cool next environment

3691
02:18:41,160 --> 02:18:43,840
variable here we're going to go airflow

3692
02:18:43,840 --> 02:18:49,880
uncore un 1core www uncore user uncore

3693
02:18:49,880 --> 02:18:53,639
username equals airflow same thing copy

3694
02:18:53,639 --> 02:18:56,599
and paste this password then the last

3695
02:18:56,599 --> 02:18:59,080
thing we need is going to be

3696
02:18:59,080 --> 02:19:03,519
airflow web server underscore uncore

3697
02:19:03,519 --> 02:19:05,800
secretor key that's just going to be

3698
02:19:05,800 --> 02:19:07,599
secret cool all right last bits here

3699
02:19:07,599 --> 02:19:09,760
we're going to say ports so we need

3700
02:19:09,760 --> 02:19:12,120
expose the ports here uh this is going

3701
02:19:12,120 --> 02:19:14,160
to sit on port 8080 so we're going to

3702
02:19:14,160 --> 02:19:15,800
say 8080 here so that's how we're going

3703
02:19:15,800 --> 02:19:18,319
to access the web server and the command

3704
02:19:18,319 --> 02:19:21,359
we're going to run this web cool now now

3705
02:19:21,359 --> 02:19:22,840
the one thing that's going to save us

3706
02:19:22,840 --> 02:19:25,240
some time here is we're going to copy

3707
02:19:25,240 --> 02:19:28,160
and duplicate the web server portion

3708
02:19:28,160 --> 02:19:30,399
because it's going to be the exact same

3709
02:19:30,399 --> 02:19:32,559
but now instead of web server this is

3710
02:19:32,559 --> 02:19:35,200
going to be the scheduler so it it

3711
02:19:35,200 --> 02:19:37,639
literally is going to be the exact same

3712
02:19:37,639 --> 02:19:39,399
so I don't think we need to change

3713
02:19:39,399 --> 02:19:41,719
anything no so the scheduler is a needed

3714
02:19:41,719 --> 02:19:45,080
worker for airflow and so we absolutely

3715
02:19:45,080 --> 02:19:48,160
need both of these one the web server to

3716
02:19:48,160 --> 02:19:50,319
give us a UI to access and then we're

3717
02:19:50,319 --> 02:19:52,720
also going to need the scheduler to

3718
02:19:52,720 --> 02:19:54,520
schedule all of our jobs here and

3719
02:19:54,520 --> 02:19:56,160
they're going to point to the same exact

3720
02:19:56,160 --> 02:19:58,040
thing okay so that is going to be the

3721
02:19:58,040 --> 02:20:00,479
setup for airflow now let's go into

3722
02:20:00,479 --> 02:20:03,640
writing our first dag in order to

3723
02:20:03,640 --> 02:20:06,359
actually orchestrate all of our tasks

3724
02:20:06,359 --> 02:20:09,240
here okay so we're going to go into our

3725
02:20:09,240 --> 02:20:10,840
dags folder here and we're going to

3726
02:20:10,840 --> 02:20:12,600
create a new folder and in that folder

3727
02:20:12,600 --> 02:20:14,080
is going to be

3728
02:20:14,080 --> 02:20:16,560
eltor dag dopy so we're going to be

3729
02:20:16,560 --> 02:20:18,120
writing some python here now the first

3730
02:20:18,120 --> 02:20:19,680
things we're going to import are going

3731
02:20:19,680 --> 02:20:24,120
to be from date time import date time

3732
02:20:24,120 --> 02:20:26,120
and time Delta so we're going to be

3733
02:20:26,120 --> 02:20:29,000
using some time values here and the next

3734
02:20:29,000 --> 02:20:31,560
one is going to be obviously airflow so

3735
02:20:31,560 --> 02:20:33,600
airflow uh from airflow we're going to

3736
02:20:33,600 --> 02:20:35,880
import D this is going to be a default

3737
02:20:35,880 --> 02:20:38,840
one that we're going to need because uh

3738
02:20:38,840 --> 02:20:41,760
obviously we need to type our dag from

3739
02:20:41,760 --> 02:20:44,160
Docker do types we're going to import

3740
02:20:44,160 --> 02:20:46,000
Mount this is going to come in handy for

3741
02:20:46,000 --> 02:20:48,439
us later because we're orchestrating

3742
02:20:48,439 --> 02:20:50,920
Docker services or Docker containers you

3743
02:20:50,920 --> 02:20:52,880
need some specific Docker types and then

3744
02:20:52,880 --> 02:20:54,560
we're also going to need a specific

3745
02:20:54,560 --> 02:20:57,000
Docker operator that comes from airflow

3746
02:20:57,000 --> 02:20:58,880
in order to actually orchestrate them uh

3747
02:20:58,880 --> 02:20:59,960
the next thing we're going to need is

3748
02:20:59,960 --> 02:21:04,319
going to be uh from airflow. operators.

3749
02:21:04,319 --> 02:21:07,479
python operator we going to import the

3750
02:21:07,479 --> 02:21:09,120
python

3751
02:21:09,120 --> 02:21:11,920
operator so this is going to be very

3752
02:21:11,920 --> 02:21:15,399
very crucial because our elt script is a

3753
02:21:15,399 --> 02:21:17,000
python script we need the python

3754
02:21:17,000 --> 02:21:18,840
operator in order to actually add that

3755
02:21:18,840 --> 02:21:21,439
in there okay so we're going to copy and

3756
02:21:21,439 --> 02:21:23,640
paste this down here as well because in

3757
02:21:23,640 --> 02:21:25,880
the same operators package we're going

3758
02:21:25,880 --> 02:21:28,200
to need the bash operator we're going to

3759
02:21:28,200 --> 02:21:31,479
change this to bash operator so that way

3760
02:21:31,479 --> 02:21:33,680
we can actually interact with the bash

3761
02:21:33,680 --> 02:21:36,319
here and and do a couple commands there

3762
02:21:36,319 --> 02:21:37,800
last one we're going to do it's going to

3763
02:21:37,800 --> 02:21:41,040
be from airflow actually should be copy

3764
02:21:41,040 --> 02:21:43,280
copying this again so from there we're

3765
02:21:43,280 --> 02:21:46,160
going to say Docker underscore or I

3766
02:21:46,160 --> 02:21:48,200
think it's just Docker here yeah just

3767
02:21:48,200 --> 02:21:51,800
Docker and then the docker operate cool

3768
02:21:51,800 --> 02:21:53,439
so these are all the packages oh

3769
02:21:53,439 --> 02:21:54,640
actually we're going to need one more

3770
02:21:54,640 --> 02:21:57,479
sub process silly me okay so those are

3771
02:21:57,479 --> 02:21:59,040
going to be all the packages that we

3772
02:21:59,040 --> 02:22:01,280
need here now let's go into some default

3773
02:22:01,280 --> 02:22:02,720
arguments here so we're going to see

3774
02:22:02,720 --> 02:22:06,040
default unor args um this is just couple

3775
02:22:06,040 --> 02:22:07,920
things so the owner of this whole

3776
02:22:07,920 --> 02:22:10,439
project here is going to be airflow the

3777
02:22:10,439 --> 02:22:13,160
next one is going to be depends on past

3778
02:22:13,160 --> 02:22:15,960
so do we want this to depends underscore

3779
02:22:15,960 --> 02:22:18,439
onore pass we're going to say false on

3780
02:22:18,439 --> 02:22:21,359
this so it doesn't email on failure

3781
02:22:21,359 --> 02:22:22,479
these are just some things that are

3782
02:22:22,479 --> 02:22:25,319
built into airflow and we are setting

3783
02:22:25,319 --> 02:22:27,000
some default values here default

3784
02:22:27,000 --> 02:22:29,200
arguments we're going to say false and

3785
02:22:29,200 --> 02:22:33,319
then on email uncore onore

3786
02:22:33,319 --> 02:22:35,399
retry I think these should be curly

3787
02:22:35,399 --> 02:22:38,160
brackets not square brackets I screw up

3788
02:22:38,160 --> 02:22:41,160
on that one cool all right now we're

3789
02:22:41,160 --> 02:22:43,600
going to write a function here Define

3790
02:22:43,600 --> 02:22:47,240
runor _ scripts so this is going to be a

3791
02:22:47,240 --> 02:22:49,160
function we use in order to actually run

3792
02:22:49,160 --> 02:22:50,680
the script now we're going to need the

3793
02:22:50,680 --> 02:22:53,560
script path obviously script scriptor

3794
02:22:53,560 --> 02:22:55,120
path we're going to set this variable

3795
02:22:55,120 --> 02:22:58,120
here and this is going to be pointed to

3796
02:22:58,120 --> 02:23:00,040
where we've set it inside of the docker

3797
02:23:00,040 --> 02:23:03,319
container so if you remember correctly

3798
02:23:03,319 --> 02:23:06,000
this path right here so we have opt

3799
02:23:06,000 --> 02:23:07,680
airflow

3800
02:23:07,680 --> 02:23:10,600
SLT so we need to point to that and not

3801
02:23:10,600 --> 02:23:13,240
where it's pointed to locally for us so

3802
02:23:13,240 --> 02:23:17,720
we're going to say SL optflow

3803
02:23:17,920 --> 02:23:20,720
slore script

3804
02:23:20,720 --> 02:23:23,880
Pi so now we are pointed directly to the

3805
02:23:23,880 --> 02:23:26,160
path of the elt script from within the

3806
02:23:26,160 --> 02:23:28,479
docker container so what we can do now

3807
02:23:28,479 --> 02:23:30,040
is we're going to say

3808
02:23:30,040 --> 02:23:33,120
result equals subprocess do run and this

3809
02:23:33,120 --> 02:23:34,720
is going to be you know we we've had

3810
02:23:34,720 --> 02:23:37,040
this command inside of actual batch

3811
02:23:37,040 --> 02:23:38,520
script itself so we're going to say

3812
02:23:38,520 --> 02:23:40,840
python we're going to run Python and

3813
02:23:40,840 --> 02:23:42,479
then we're going to use this point it to

3814
02:23:42,479 --> 02:23:44,880
the script path now after this we're

3815
02:23:44,880 --> 02:23:46,279
going to add a comma and we're going to

3816
02:23:46,279 --> 02:23:49,160
say capture output equals true so we

3817
02:23:49,160 --> 02:23:51,120
want to capture the output there and the

3818
02:23:51,120 --> 02:23:54,120
text equals true okay now after that

3819
02:23:54,120 --> 02:23:56,479
we're going to add a control structure

3820
02:23:56,479 --> 02:23:57,960
here so if

3821
02:23:57,960 --> 02:24:01,319
results. return code does not equal

3822
02:24:01,319 --> 02:24:03,279
doesn't equal zero that means we failed

3823
02:24:03,279 --> 02:24:04,520
something so we need to raise an

3824
02:24:04,520 --> 02:24:06,800
exception and in that we're going to say

3825
02:24:06,800 --> 02:24:10,240
script failed with error and then we're

3826
02:24:10,240 --> 02:24:14,680
going okay and then else we print the

3827
02:24:14,680 --> 02:24:18,000
result output cool now let's actually

3828
02:24:18,000 --> 02:24:20,080
put this into a dag so we're going to

3829
02:24:20,080 --> 02:24:22,800
say dag equals and then point it to the

3830
02:24:22,800 --> 02:24:25,560
dag object that we just imported add a

3831
02:24:25,560 --> 02:24:27,240
parenthesis and this is where we add in

3832
02:24:27,240 --> 02:24:28,800
all the information so the first one is

3833
02:24:28,800 --> 02:24:29,840
going to be the name so we're going to

3834
02:24:29,840 --> 02:24:33,600
name it elore andore DBT so that's going

3835
02:24:33,600 --> 02:24:36,560
to be the name of our tag now uh the

3836
02:24:36,560 --> 02:24:38,160
default arguments this is where it comes

3837
02:24:38,160 --> 02:24:39,439
into play here so we're going to say

3838
02:24:39,439 --> 02:24:41,120
default arguments equals the default

3839
02:24:41,120 --> 02:24:42,840
arguments that we've specified the

3840
02:24:42,840 --> 02:24:46,560
description of this dag is going to be

3841
02:24:46,560 --> 02:24:50,800
an elt workflow with DBT right

3842
02:24:50,800 --> 02:24:53,279
accidentally the start date start

3843
02:24:53,279 --> 02:24:56,080
underscore date is going to be date time

3844
02:24:56,080 --> 02:24:57,240
so that's where we're going to use date

3845
02:24:57,240 --> 02:24:58,720
time here and we're going to say

3846
02:24:58,720 --> 02:25:01,680
2023 uh it the time of this recording is

3847
02:25:01,680 --> 02:25:04,640
currently October 28th so that's going

3848
02:25:04,640 --> 02:25:06,399
to be our start time there catchup is

3849
02:25:06,399 --> 02:25:09,520
going to be another one catch up equals

3850
02:25:09,520 --> 02:25:11,760
pulse we're we're not going to catch up

3851
02:25:11,760 --> 02:25:13,359
all right oh I didn't close it I'm done

3852
02:25:13,359 --> 02:25:15,200
so now we're going to go into actually

3853
02:25:15,200 --> 02:25:17,200
writing out the tasks so you can name a

3854
02:25:17,200 --> 02:25:19,240
task whatever you want the first thing

3855
02:25:19,240 --> 02:25:21,319
I'm going to do or the easiest way to do

3856
02:25:21,319 --> 02:25:23,439
it for me is going to say T1 for task

3857
02:25:23,439 --> 02:25:25,680
one that's just the way I like to do it

3858
02:25:25,680 --> 02:25:26,800
and we're going to use the python

3859
02:25:26,800 --> 02:25:28,479
operator because the first task we want

3860
02:25:28,479 --> 02:25:30,479
is the elt script and because it is a

3861
02:25:30,479 --> 02:25:32,240
python script we need the python

3862
02:25:32,240 --> 02:25:33,920
operator now let's do the same thing

3863
02:25:33,920 --> 02:25:35,960
where we initiated the dag here where

3864
02:25:35,960 --> 02:25:37,200
we're going to add a parenthesis the

3865
02:25:37,200 --> 02:25:41,359
task ID is going to be task uncore ID

3866
02:25:41,359 --> 02:25:44,120
we're going to tag this over and you

3867
02:25:44,120 --> 02:25:47,120
know label this as runor elore script so

3868
02:25:47,120 --> 02:25:49,080
that we can identify this properly we're

3869
02:25:49,080 --> 02:25:50,760
going to say python column

3870
02:25:50,760 --> 02:25:53,240
equals the Run elt script function that

3871
02:25:53,240 --> 02:25:55,000
we just created and then the dag is

3872
02:25:55,000 --> 02:25:58,399
going to equal dag okay so very very

3873
02:25:58,399 --> 02:26:00,040
simple we've we've given it an

3874
02:26:00,040 --> 02:26:02,680
identifier we've added the python

3875
02:26:02,680 --> 02:26:04,920
function here in order for us to

3876
02:26:04,920 --> 02:26:06,840
actually run the elt script and then

3877
02:26:06,840 --> 02:26:08,680
we've attached it to the dag that we've

3878
02:26:08,680 --> 02:26:10,920
created all right the next one is going

3879
02:26:10,920 --> 02:26:13,800
to be task two which is going to be DBT

3880
02:26:13,800 --> 02:26:16,040
and obviously for DBT we've added the

3881
02:26:16,040 --> 02:26:18,120
docker operator so let's go ahead and

3882
02:26:18,120 --> 02:26:21,200
add all the necessary information

3883
02:26:21,200 --> 02:26:23,200
for the docker operator the same thing

3884
02:26:23,200 --> 02:26:26,760
is going to be here so task ID right uh

3885
02:26:26,760 --> 02:26:28,520
we're going to name this the same one is

3886
02:26:28,520 --> 02:26:29,880
going to be

3887
02:26:29,880 --> 02:26:33,760
DBT run very simple there after task ID

3888
02:26:33,760 --> 02:26:35,720
we're going to need to attach an image

3889
02:26:35,720 --> 02:26:39,399
to it and so um I we do have a DBT

3890
02:26:39,399 --> 02:26:41,279
container but we're actually going to

3891
02:26:41,279 --> 02:26:43,240
remove it and replace it with this so

3892
02:26:43,240 --> 02:26:45,720
we're going to do the same information

3893
02:26:45,720 --> 02:26:48,880
that we had in the docker or the DBT

3894
02:26:48,880 --> 02:26:51,120
container so we're going to say G

3895
02:26:51,120 --> 02:26:56,200
hc. DBT Labs DBT postgress for the

3896
02:26:56,200 --> 02:26:58,040
postgress adapter and then point it

3897
02:26:58,040 --> 02:26:59,160
directly to

3898
02:26:59,160 --> 02:27:01,439
1.4.7 all right and the command we're

3899
02:27:01,439 --> 02:27:03,600
going to run is going to be the exact

3900
02:27:03,600 --> 02:27:06,439
same so you can see kind of like the the

3901
02:27:06,439 --> 02:27:08,240
similarities here uh so we're going to

3902
02:27:08,240 --> 02:27:12,160
say that we're going to point it to the

3903
02:27:12,160 --> 02:27:14,880
profiles directory and the profiles

3904
02:27:14,880 --> 02:27:17,600
directory is going to be SL root the

3905
02:27:17,600 --> 02:27:21,960
project directory is going to b/ DBT and

3906
02:27:21,960 --> 02:27:24,560
then that should be it the next one for

3907
02:27:24,560 --> 02:27:27,520
this one is auto remove so Auto remove

3908
02:27:27,520 --> 02:27:30,160
is do we want to automatically remove

3909
02:27:30,160 --> 02:27:32,640
the container once it's finished and

3910
02:27:32,640 --> 02:27:34,640
we're going to say true because we don't

3911
02:27:34,640 --> 02:27:38,319
want it open all the time so Docker URL

3912
02:27:38,319 --> 02:27:39,760
is going to be the next one and this

3913
02:27:39,760 --> 02:27:41,560
we're going to be pointing directly to

3914
02:27:41,560 --> 02:27:44,960
the the socket that we open so Unix sl/

3915
02:27:44,960 --> 02:27:49,040
bar/ run/ doer. right it can identify

3916
02:27:49,040 --> 02:27:51,439
where of the docker container is now the

3917
02:27:51,439 --> 02:27:55,040
network mode we're going to label as

3918
02:27:55,040 --> 02:27:57,880
bridge and if you remember the docker or

3919
02:27:57,880 --> 02:27:59,520
the network driver for the docker

3920
02:27:59,520 --> 02:28:01,840
Network that we had was a bridge so that

3921
02:28:01,840 --> 02:28:03,560
is going to be our mode here and then

3922
02:28:03,560 --> 02:28:06,160
mounts so mounts is going to be where we

3923
02:28:06,160 --> 02:28:07,760
imported the type of mounts this is

3924
02:28:07,760 --> 02:28:09,279
where we're actually doing the same

3925
02:28:09,279 --> 02:28:12,600
thing that we see here in the DBT

3926
02:28:12,600 --> 02:28:15,640
service where we've mounted these two

3927
02:28:15,640 --> 02:28:17,600
volumes here and we want to mount them

3928
02:28:17,600 --> 02:28:19,359
because we're actually doing exactly

3929
02:28:19,359 --> 02:28:21,600
what we're doing here here but instead

3930
02:28:21,600 --> 02:28:24,800
we're doing it inside of airflow we're

3931
02:28:24,800 --> 02:28:26,680
creating this Docker container from

3932
02:28:26,680 --> 02:28:29,880
scratch using the same information but

3933
02:28:29,880 --> 02:28:32,720
that way airflow has sight of okay well

3934
02:28:32,720 --> 02:28:35,279
this is exactly what I'm orchestrating

3935
02:28:35,279 --> 02:28:37,000
let me go ahead and create this and then

3936
02:28:37,000 --> 02:28:38,680
run it so the first thing we're going to

3937
02:28:38,680 --> 02:28:40,279
do is say Mount and then inside of that

3938
02:28:40,279 --> 02:28:42,399
is going to be Source the source of this

3939
02:28:42,399 --> 02:28:46,359
is going to be the local path of my

3940
02:28:46,359 --> 02:28:48,279
actual custom postgress so I'm going to

3941
02:28:48,279 --> 02:28:52,520
say users SL my name is Justin Chow slev

3942
02:28:52,520 --> 02:28:54,279
development and this is going to be

3943
02:28:54,279 --> 02:28:57,439
separate and very different uh depending

3944
02:28:57,439 --> 02:29:00,000
on what you're doing here so the inside

3945
02:29:00,000 --> 02:29:02,359
of development is just the elt folder

3946
02:29:02,359 --> 02:29:04,720
and then we're going to go into custom

3947
02:29:04,720 --> 02:29:08,520
uncore post press is where my sources is

3948
02:29:08,520 --> 02:29:12,319
now after this we're going to say Target

3949
02:29:12,319 --> 02:29:17,160
equals slashin quotes SL DBT well that's

3950
02:29:17,160 --> 02:29:19,800
essentially mapping the source to the SL

3951
02:29:19,800 --> 02:29:22,439
DV folder and we're going to say type

3952
02:29:22,439 --> 02:29:25,439
equals bind okay now what we're going to

3953
02:29:25,439 --> 02:29:27,600
do is we're going to copy this and we're

3954
02:29:27,600 --> 02:29:29,880
going to add a comma here now this is

3955
02:29:29,880 --> 02:29:32,439
going to be shorter here so I can get

3956
02:29:32,439 --> 02:29:34,479
rid of pretty much everything here and

3957
02:29:34,479 --> 02:29:36,600
then we're going to say DBT because this

3958
02:29:36,600 --> 02:29:39,359
is our profile and then instead of

3959
02:29:39,359 --> 02:29:42,160
Target being SL DBT we want this to be

3960
02:29:42,160 --> 02:29:44,000
root and the type is going to remain

3961
02:29:44,000 --> 02:29:46,279
bind the last thing we need after the

3962
02:29:46,279 --> 02:29:48,920
mounts is going to tag it to the dag so

3963
02:29:48,920 --> 02:29:50,800
dag Dag

3964
02:29:50,800 --> 02:29:53,359
and there we go that's pretty much

3965
02:29:53,359 --> 02:29:55,120
writing both of our tasks the last thing

3966
02:29:55,120 --> 02:29:58,160
we need to do here is create the order

3967
02:29:58,160 --> 02:30:00,279
in which we want it to run and so at the

3968
02:30:00,279 --> 02:30:02,279
very bottom here we're going to say T1

3969
02:30:02,279 --> 02:30:04,520
two greater than signs and then T2 so

3970
02:30:04,520 --> 02:30:07,279
this means that T1 takes priority over

3971
02:30:07,279 --> 02:30:09,359
T2 and that's the order that we want it

3972
02:30:09,359 --> 02:30:11,399
to run in okay so let's go ahead and

3973
02:30:11,399 --> 02:30:13,479
make sure to save this it looks like we

3974
02:30:13,479 --> 02:30:15,120
have that's fine we don't have to worry

3975
02:30:15,120 --> 02:30:17,160
about this so that is pretty much

3976
02:30:17,160 --> 02:30:19,560
writing our dag here let's go over it

3977
02:30:19,560 --> 02:30:21,319
one more time we've created some default

3978
02:30:21,319 --> 02:30:23,960
arguments here that airflow needs inside

3979
02:30:23,960 --> 02:30:26,680
of the dag we've created our python

3980
02:30:26,680 --> 02:30:29,399
function in order to correctly identify

3981
02:30:29,399 --> 02:30:30,840
where the script is and then we're going

3982
02:30:30,840 --> 02:30:32,920
to go ahead and run it with some error

3983
02:30:32,920 --> 02:30:35,200
checks here we've created the actual dag

3984
02:30:35,200 --> 02:30:37,479
itself and named it with the default

3985
02:30:37,479 --> 02:30:39,439
arguments description and then the start

3986
02:30:39,439 --> 02:30:41,600
time we've created the first task here

3987
02:30:41,600 --> 02:30:43,640
using the python operator given it an

3988
02:30:43,640 --> 02:30:45,760
identifier pointed the function we

3989
02:30:45,760 --> 02:30:47,960
created to it so that's what we know to

3990
02:30:47,960 --> 02:30:50,520
run and then we've attached it to the

3991
02:30:50,520 --> 02:30:52,680
dag we created and then this is the

3992
02:30:52,680 --> 02:30:54,920
second operator or the second task here

3993
02:30:54,920 --> 02:30:56,600
using the docker operator and

3994
02:30:56,600 --> 02:30:59,120
essentially creating DBT in a new

3995
02:30:59,120 --> 02:31:01,640
container and then running and mounting

3996
02:31:01,640 --> 02:31:04,840
everything we need to correctly have you

3997
02:31:04,840 --> 02:31:07,040
know the DBT project run on top of the

3998
02:31:07,040 --> 02:31:09,920
destination once the first task has run

3999
02:31:09,920 --> 02:31:12,520
and then we've created the order of

4000
02:31:12,520 --> 02:31:14,560
operations here in which we want it to

4001
02:31:14,560 --> 02:31:16,359
run so hopefully this all makes sense in

4002
02:31:16,359 --> 02:31:17,800
this next one we're going to go ahead

4003
02:31:17,800 --> 02:31:19,600
and run it and show you what the web

4004
02:31:19,600 --> 02:31:21,160
server looks like and then make sure

4005
02:31:21,160 --> 02:31:23,240
that the dag actually works so let's get

4006
02:31:23,240 --> 02:31:25,680
into that okay so we have our dag now

4007
02:31:25,680 --> 02:31:27,439
the one thing to note is that we are

4008
02:31:27,439 --> 02:31:29,080
actually running the script here and

4009
02:31:29,080 --> 02:31:30,800
then creating a new Docker container

4010
02:31:30,800 --> 02:31:32,960
here for TBT so we can actually go back

4011
02:31:32,960 --> 02:31:35,399
into our Docker compos file and we're

4012
02:31:35,399 --> 02:31:38,319
going to comment out the DBT as well as

4013
02:31:38,319 --> 02:31:40,439
the elt script containers because we do

4014
02:31:40,439 --> 02:31:42,520
not need to create them anymore because

4015
02:31:42,520 --> 02:31:44,359
we have airflow doing it we don't need

4016
02:31:44,359 --> 02:31:45,840
to have them any so let's go ahead and

4017
02:31:45,840 --> 02:31:47,200
comment those out and what we're

4018
02:31:47,200 --> 02:31:49,120
actually going to do is we're going to

4019
02:31:49,120 --> 02:31:52,120
do docker compose up and run all these

4020
02:31:52,120 --> 02:31:54,240
containers so I forgot to do one thing

4021
02:31:54,240 --> 02:31:56,279
so remove the port section and then the

4022
02:31:56,279 --> 02:31:58,200
command should be scheduler not web

4023
02:31:58,200 --> 02:32:01,439
server that's my bad so let's do Docker

4024
02:32:01,439 --> 02:32:06,040
compose up again ports must

4025
02:32:06,840 --> 02:32:09,520
exist there we go okay just some weird

4026
02:32:09,520 --> 02:32:11,120
issue there so this is airflow

4027
02:32:11,120 --> 02:32:13,319
initializing everything everything seems

4028
02:32:13,319 --> 02:32:16,080
to be going into plan here and so now

4029
02:32:16,080 --> 02:32:18,720
what we can do exit with Code Zero we

4030
02:32:18,720 --> 02:32:20,840
should see the scheduler and the web

4031
02:32:20,840 --> 02:32:23,319
server pop up in just a second here oh

4032
02:32:23,319 --> 02:32:24,920
you know what okay so now that we have

4033
02:32:24,920 --> 02:32:27,399
everything going let's go ahead and

4034
02:32:27,399 --> 02:32:31,000
create all of our Docker compos files so

4035
02:32:31,000 --> 02:32:32,200
but the first thing we have to do is

4036
02:32:32,200 --> 02:32:35,040
actually run the init airflow container

4037
02:32:35,040 --> 02:32:36,560
first because it's very important so

4038
02:32:36,560 --> 02:32:38,200
we're going to say Docker compose up and

4039
02:32:38,200 --> 02:32:40,120
knit hyphen airflow and we're going to

4040
02:32:40,120 --> 02:32:42,279
actually say hyphen D in order to do

4041
02:32:42,279 --> 02:32:43,720
that first so what that's going to do is

4042
02:32:43,720 --> 02:32:45,399
going to start the postgress and it's

4043
02:32:45,399 --> 02:32:47,359
going to start the initialized airflow

4044
02:32:47,359 --> 02:32:49,120
containers first and if we go to Docker

4045
02:32:49,120 --> 02:32:50,840
desktop here you you can see that they

4046
02:32:50,840 --> 02:32:52,840
they're already running we actually need

4047
02:32:52,840 --> 02:32:55,319
those to be running first before we

4048
02:32:55,319 --> 02:32:57,160
enable anything else because without

4049
02:32:57,160 --> 02:32:59,000
those the web server and the scheduler

4050
02:32:59,000 --> 02:33:00,840
will not work so now what we can do is

4051
02:33:00,840 --> 02:33:02,479
we're going to say Docker compose up and

4052
02:33:02,479 --> 02:33:03,880
that's going to create the rest of the

4053
02:33:03,880 --> 02:33:06,479
docker containers that we have and so

4054
02:33:06,479 --> 02:33:07,880
let's go ahead and wait for that now we

4055
02:33:07,880 --> 02:33:09,880
can see that the web server is now open

4056
02:33:09,880 --> 02:33:11,520
so what I'm going to do here is going to

4057
02:33:11,520 --> 02:33:13,479
do open a new window and then we're

4058
02:33:13,479 --> 02:33:15,600
going to go to Local Host and remember

4059
02:33:15,600 --> 02:33:18,040
we said 8080 so if we go to Local Host

4060
02:33:18,040 --> 02:33:22,560
8080 we are now in the airflow UI so

4061
02:33:22,560 --> 02:33:25,359
airflow password was the username and

4062
02:33:25,359 --> 02:33:27,279
password that we enabled here we're

4063
02:33:27,279 --> 02:33:30,080
going to say no here no but you can see

4064
02:33:30,080 --> 02:33:33,760
we have an issue opt airflow dags

4065
02:33:33,760 --> 02:33:35,359
_

4066
02:33:35,359 --> 02:33:38,640
D.P a broken dag so that's fine I think

4067
02:33:38,640 --> 02:33:42,840
what we probably forgot to do was

4068
02:33:42,840 --> 02:33:46,720
install the python operators so let's go

4069
02:33:46,720 --> 02:33:49,200
ahead and debug this really quickly a

4070
02:33:49,200 --> 02:33:50,800
nothing like like a little bit of

4071
02:33:50,800 --> 02:33:53,800
problem right so let's just make sure op

4072
02:33:53,800 --> 02:33:58,359
airflow. oper python oper oh so this

4073
02:33:58,359 --> 02:34:02,520
should be an operator not operators now

4074
02:34:02,520 --> 02:34:05,520
let's go ahead and go back and kill all

4075
02:34:05,520 --> 02:34:09,240
of these again so Docker compose

4076
02:34:09,240 --> 02:34:12,920
down D we're going to say the same thing

4077
02:34:12,920 --> 02:34:15,080
so we're going to say Docker

4078
02:34:15,080 --> 02:34:18,200
compose let that run for a second and

4079
02:34:18,200 --> 02:34:20,160
then Docker compose up okay let's go

4080
02:34:20,160 --> 02:34:22,840
back to our web server here should load

4081
02:34:22,840 --> 02:34:27,479
up in just a second go airflow

4082
02:34:27,479 --> 02:34:30,160
password in I may have tried a little

4083
02:34:30,160 --> 02:34:32,920
too soon there we go uh we're still

4084
02:34:32,920 --> 02:34:36,080
running into an error here docker's the

4085
02:34:36,080 --> 02:34:37,960
operator I think I probably did this

4086
02:34:37,960 --> 02:34:41,680
let's look at the docker file here tip

4087
02:34:41,680 --> 02:34:42,800
install

4088
02:34:42,800 --> 02:34:46,640
Apache I an airflow

4089
02:34:46,640 --> 02:34:50,200
high do okay so I found the issue it was

4090
02:34:50,200 --> 02:34:52,040
from the actual package here so I wasn't

4091
02:34:52,040 --> 02:34:54,040
doing it properly on the docker file

4092
02:34:54,040 --> 02:34:56,319
here Pache airflow Pro Docker so this

4093
02:34:56,319 --> 02:34:59,600
should actually be airflow. providers.

4094
02:34:59,600 --> 02:35:04,040
doer uh and then operators. doer so that

4095
02:35:04,040 --> 02:35:06,560
should be the import name uh that's why

4096
02:35:06,560 --> 02:35:08,399
we were getting the issue here uh so

4097
02:35:08,399 --> 02:35:11,479
we're going to say Docker compos down B

4098
02:35:11,479 --> 02:35:14,120
do the same thing here end it airflow

4099
02:35:14,120 --> 02:35:16,120
wait a couple seconds then Docker

4100
02:35:16,120 --> 02:35:20,359
compose up in a second now hopefully

4101
02:35:20,359 --> 02:35:22,439
this should fix the issue because I had

4102
02:35:22,439 --> 02:35:24,279
another just like simple

4103
02:35:24,279 --> 02:35:28,479
typo so if we go back now crash airflow

4104
02:35:28,479 --> 02:35:30,920
password still the same issue oh I had

4105
02:35:30,920 --> 02:35:33,720
it twice it's another typo okay so this

4106
02:35:33,720 --> 02:35:36,000
shouldn't be operators this should be

4107
02:35:36,000 --> 02:35:39,479
providers A okay

4108
02:35:39,479 --> 02:35:41,359
compose down

4109
02:35:41,359 --> 02:35:45,439
I do initialize it again do compose up

4110
02:35:45,439 --> 02:35:50,160
again just some simple simple typos that

4111
02:35:50,160 --> 02:35:53,760
are screwing it all up there we go now

4112
02:35:53,760 --> 02:35:56,000
now that I haven't typoed anything you

4113
02:35:56,000 --> 02:35:59,279
can see that we have the elt and DBT dag

4114
02:35:59,279 --> 02:36:01,439
here we have the owner being airflow we

4115
02:36:01,439 --> 02:36:03,680
have all the runs um so you have failed

4116
02:36:03,680 --> 02:36:06,399
running success cued you have a schedule

4117
02:36:06,399 --> 02:36:08,479
your last run next run which we pointed

4118
02:36:08,479 --> 02:36:10,120
out would be today but we're going to go

4119
02:36:10,120 --> 02:36:12,080
ahead and manually run this so what

4120
02:36:12,080 --> 02:36:12,880
we're going to do is they're actually

4121
02:36:12,880 --> 02:36:14,319
going to trigger the dag and what we're

4122
02:36:14,319 --> 02:36:15,720
going to see here is we're going to see

4123
02:36:15,720 --> 02:36:18,840
it run so we see one is one is uh still

4124
02:36:18,840 --> 02:36:20,960
queued so we we have one successful and

4125
02:36:20,960 --> 02:36:22,479
I believe we should be waiting for one

4126
02:36:22,479 --> 02:36:24,439
more to go believe we're still waiting

4127
02:36:24,439 --> 02:36:26,040
for one more to go yeah okay so we see

4128
02:36:26,040 --> 02:36:27,640
one has failed now let's go ahead and

4129
02:36:27,640 --> 02:36:30,960
check why um so the dbt1 failed DBT was

4130
02:36:30,960 --> 02:36:32,279
not running at the state so we can check

4131
02:36:32,279 --> 02:36:34,279
the logs here now remember that we

4132
02:36:34,279 --> 02:36:36,680
created that DBT or sorry that postgress

4133
02:36:36,680 --> 02:36:39,840
service for the airf flow and so that is

4134
02:36:39,840 --> 02:36:42,520
because of this so we needed the actual

4135
02:36:42,520 --> 02:36:44,560
postgress database for this reason so we

4136
02:36:44,560 --> 02:36:45,920
can actually get some logs here if you

4137
02:36:45,920 --> 02:36:47,319
didn't have it it wouldn't we wouldn't

4138
02:36:47,319 --> 02:36:49,560
get any logs here so it's actually

4139
02:36:49,560 --> 02:36:52,359
erroring out because custom post. myc

4140
02:36:52,359 --> 02:36:54,960
DBT model depends on a node name my

4141
02:36:54,960 --> 02:36:57,080
first DBT model which was not found

4142
02:36:57,080 --> 02:36:59,680
which is interesting because this is not

4143
02:36:59,680 --> 02:37:02,200
what we had in mind here very

4144
02:37:02,200 --> 02:37:04,359
interesting so it looks like the script

4145
02:37:04,359 --> 02:37:07,640
worked but the DVT section did not so

4146
02:37:07,640 --> 02:37:09,200
we're going to have to take a look at

4147
02:37:09,200 --> 02:37:11,359
why and it has to be something in here

4148
02:37:11,359 --> 02:37:14,359
right so the DVT run profiles directory

4149
02:37:14,359 --> 02:37:17,000
profiles directory is going to be/ root

4150
02:37:17,000 --> 02:37:19,840
project directory is going to be SL DVD

4151
02:37:19,840 --> 02:37:22,359
if we check the docker desktop we go

4152
02:37:22,359 --> 02:37:25,960
into web server go into files here um

4153
02:37:25,960 --> 02:37:28,479
and then I believe so rout should

4154
02:37:28,479 --> 02:37:31,240
contain our DBT folder with the

4155
02:37:31,240 --> 02:37:33,600
profiles. yl folder and we can actually

4156
02:37:33,600 --> 02:37:38,040
see that custom post address has exactly

4157
02:37:38,040 --> 02:37:39,720
the information we're looking for so

4158
02:37:39,720 --> 02:37:43,200
that's root that is fine the other one

4159
02:37:43,200 --> 02:37:47,200
that we should have airflow x no airflow

4160
02:37:47,200 --> 02:37:50,479
where did we put the actual we put in SL

4161
02:37:50,479 --> 02:37:53,560
DBT so let's go back it should be in a

4162
02:37:53,560 --> 02:37:57,080
DBT but it is not SL op SL D and I

4163
02:37:57,080 --> 02:37:59,359
believe our models should be in here

4164
02:37:59,359 --> 02:38:01,279
okay so I think we're pointing it to the

4165
02:38:01,279 --> 02:38:05,120
wrong area here so SL opt SL DVT let's

4166
02:38:05,120 --> 02:38:07,319
go ahead and see if that changes

4167
02:38:07,319 --> 02:38:09,680
everything cuz we didn't create

4168
02:38:09,680 --> 02:38:12,800
the section there so let's go ahead and

4169
02:38:12,800 --> 02:38:15,680
restart this so we're going to

4170
02:38:15,680 --> 02:38:19,680
say airflow wait a second

4171
02:38:19,680 --> 02:38:23,479
okay let's go back to the UI password

4172
02:38:23,479 --> 02:38:25,080
okay this is still going let's go ahead

4173
02:38:25,080 --> 02:38:27,479
and Trigger it okay I think we're still

4174
02:38:27,479 --> 02:38:30,000
waiting on one one's running right now

4175
02:38:30,000 --> 02:38:31,680
which is a good thing let's hope it

4176
02:38:31,680 --> 02:38:33,720
doesn't fail fails now let's go ahead

4177
02:38:33,720 --> 02:38:35,760
and Che the logs here there inv valid

4178
02:38:35,760 --> 02:38:38,399
project directory not a project project

4179
02:38:38,399 --> 02:38:41,760
AML okay so that's a better sign which

4180
02:38:41,760 --> 02:38:44,479
means that we just need to change this

4181
02:38:44,479 --> 02:38:48,840
now slash op slash now I believe that

4182
02:38:48,840 --> 02:38:50,760
when we run this it should work let's go

4183
02:38:50,760 --> 02:38:54,520
ahead and kill this same

4184
02:38:54,520 --> 02:38:59,399
thing go up should be good reset go

4185
02:38:59,399 --> 02:39:02,439
ahead and run it so looks like the elt1

4186
02:39:02,439 --> 02:39:04,479
ran successfully and then we're just

4187
02:39:04,479 --> 02:39:06,560
going to wait for the second one to pass

4188
02:39:06,560 --> 02:39:09,240
hopefully it does and it's still failing

4189
02:39:09,240 --> 02:39:10,720
why is it still pointing to the other

4190
02:39:10,720 --> 02:39:12,840
models I don't know how this happened

4191
02:39:12,840 --> 02:39:14,960
but inside of the example folder there

4192
02:39:14,960 --> 02:39:17,600
was a my second DBT model sequel file

4193
02:39:17,600 --> 02:39:19,920
that was throwing the eror so I just

4194
02:39:19,920 --> 02:39:24,000
deleted it so now let's try and see if I

4195
02:39:24,000 --> 02:39:25,560
don't know how that got in there I I

4196
02:39:25,560 --> 02:39:28,200
don't even remember if I deleted or not

4197
02:39:28,200 --> 02:39:29,680
but obviously while we were testing it

4198
02:39:29,680 --> 02:39:31,120
manually it wasn't throwing an error but

4199
02:39:31,120 --> 02:39:33,080
now airflow decides to throw the error

4200
02:39:33,080 --> 02:39:34,880
so let's go ahead and see if that's

4201
02:39:34,880 --> 02:39:37,479
going to fix the issue I'm pretty sure

4202
02:39:37,479 --> 02:39:39,760
it will very just like didn't even think

4203
02:39:39,760 --> 02:39:41,960
about it kind of thing but again like

4204
02:39:41,960 --> 02:39:43,680
I'm leaving all these mistakes in there

4205
02:39:43,680 --> 02:39:45,319
not because it's like obviously doesn't

4206
02:39:45,319 --> 02:39:47,720
look that great but I do believe that

4207
02:39:47,720 --> 02:39:49,399
these errors are just a part of

4208
02:39:49,399 --> 02:39:50,920
Engineering in general and so I think

4209
02:39:50,920 --> 02:39:52,279
it's good to put some light on it and

4210
02:39:52,279 --> 02:39:54,319
just you know not every course or not

4211
02:39:54,319 --> 02:39:55,840
every lesson is going to be fully

4212
02:39:55,840 --> 02:39:57,359
fledged I think it's better to just

4213
02:39:57,359 --> 02:39:58,479
leave that stuff in there because you

4214
02:39:58,479 --> 02:40:00,040
know we all go through mistakes stuff

4215
02:40:00,040 --> 02:40:01,520
like this happens where it just you know

4216
02:40:01,520 --> 02:40:03,760
there was one file that was throwing

4217
02:40:03,760 --> 02:40:05,439
everything off or something like that

4218
02:40:05,439 --> 02:40:07,040
now let's go ahead and see if I can

4219
02:40:07,040 --> 02:40:08,800
actually get in here so I can refresh

4220
02:40:08,800 --> 02:40:11,439
and I'm in so let me go ahead and hit

4221
02:40:11,439 --> 02:40:14,439
start on the dag and let's see what we

4222
02:40:14,439 --> 02:40:16,240
get here so it looks like our batch

4223
02:40:16,240 --> 02:40:18,080
script worked now we're just waiting for

4224
02:40:18,080 --> 02:40:20,160
airflow let's hope for for number two on

4225
02:40:20,160 --> 02:40:22,319
the green I think we're still running

4226
02:40:22,319 --> 02:40:24,319
cool that was it that was literally it

4227
02:40:24,319 --> 02:40:25,880
so now you can see we have two on the

4228
02:40:25,880 --> 02:40:28,479
success part so we have our DBT and our

4229
02:40:28,479 --> 02:40:31,319
elt script that ran successfully so what

4230
02:40:31,319 --> 02:40:33,560
we can do now is we can go into our

4231
02:40:33,560 --> 02:40:36,439
destination postest and do the

4232
02:40:36,439 --> 02:40:38,279
destination

4233
02:40:38,279 --> 02:40:41,120
DB and we're going to say/ DT and you

4234
02:40:41,120 --> 02:40:43,439
can see all the models and everything

4235
02:40:43,439 --> 02:40:45,240
that we ran are now inside of the

4236
02:40:45,240 --> 02:40:47,640
destination and to prove that I can say

4237
02:40:47,640 --> 02:40:49,760
select all from

4238
02:40:49,760 --> 02:40:52,000
uh let's say specific movie again and

4239
02:40:52,000 --> 02:40:54,200
you can see that the Inception selection

4240
02:40:54,200 --> 02:40:57,720
is still there I can say select all from

4241
02:40:57,720 --> 02:41:00,439
users and everything should be in there

4242
02:41:00,439 --> 02:41:03,560
so that is successfully adding airflow

4243
02:41:03,560 --> 02:41:05,479
with some minor hiccups but obviously

4244
02:41:05,479 --> 02:41:07,240
you can see here that our python

4245
02:41:07,240 --> 02:41:09,439
operator and our Docker operator are in

4246
02:41:09,439 --> 02:41:12,040
play here and working it does take a

4247
02:41:12,040 --> 02:41:13,920
little bit of work to make sure that

4248
02:41:13,920 --> 02:41:15,439
everything is moving because there yes

4249
02:41:15,439 --> 02:41:17,319
there is a lot of moving Parts here but

4250
02:41:17,319 --> 02:41:19,640
in this next section with the elt script

4251
02:41:19,640 --> 02:41:21,560
we're making it a lot easier because

4252
02:41:21,560 --> 02:41:23,760
we're removing the need for the elt

4253
02:41:23,760 --> 02:41:26,279
script we're actually adding in another

4254
02:41:26,279 --> 02:41:27,960
open source tool that I happen to work

4255
02:41:27,960 --> 02:41:30,439
for called air bites to be able to add

4256
02:41:30,439 --> 02:41:32,960
more Integrations and more data sources

4257
02:41:32,960 --> 02:41:35,800
more destinations with ease so let's

4258
02:41:35,800 --> 02:41:37,439
look at how that would work with

4259
02:41:37,439 --> 02:41:39,720
orchestration and everything like that

4260
02:41:39,720 --> 02:41:42,200
all put together now all right so for

4261
02:41:42,200 --> 02:41:44,240
this next and final section like I

4262
02:41:44,240 --> 02:41:46,279
mentioned we're going to be implementing

4263
02:41:46,279 --> 02:41:48,680
an open-source data integration tool

4264
02:41:48,680 --> 02:41:50,240
called air B which I just so happen to

4265
02:41:50,240 --> 02:41:52,200
work for airite we are pretty much a

4266
02:41:52,200 --> 02:41:54,319
data Movement platform like I just said

4267
02:41:54,319 --> 02:41:55,840
so you have a bunch of sources like we

4268
02:41:55,840 --> 02:41:57,640
have our source database and we have our

4269
02:41:57,640 --> 02:42:00,479
destination database both in postgress

4270
02:42:00,479 --> 02:42:02,720
now imagine you have a couple other

4271
02:42:02,720 --> 02:42:04,359
sources that aren't just postgress but

4272
02:42:04,359 --> 02:42:06,960
you also have places like Salesforce or

4273
02:42:06,960 --> 02:42:09,840
LinkedIn Facebook marketing places like

4274
02:42:09,840 --> 02:42:12,080
that where you need data to come out of

4275
02:42:12,080 --> 02:42:14,080
and then move them into you know your

4276
02:42:14,080 --> 02:42:16,479
destination postgress database or you

4277
02:42:16,479 --> 02:42:18,560
may have some cloud data warehouses

4278
02:42:18,560 --> 02:42:19,840
things like that air bite is the

4279
02:42:19,840 --> 02:42:22,080
platform to easily sync all of them

4280
02:42:22,080 --> 02:42:24,200
together without having to manage any of

4281
02:42:24,200 --> 02:42:26,160
these manual scripts like the one we

4282
02:42:26,160 --> 02:42:28,160
just made use a dump file to go from

4283
02:42:28,160 --> 02:42:30,279
postest to postgress uh it would be much

4284
02:42:30,279 --> 02:42:31,800
more complicated if we were doing that

4285
02:42:31,800 --> 02:42:33,200
from you know a different source to a

4286
02:42:33,200 --> 02:42:34,479
different destination and so I'm going

4287
02:42:34,479 --> 02:42:36,439
to show you how easy it is to get airite

4288
02:42:36,439 --> 02:42:38,399
into your project and it's open source

4289
02:42:38,399 --> 02:42:40,439
like I said and utilizes Docker so it's

4290
02:42:40,439 --> 02:42:42,000
pretty easy to hook up to the rest of

4291
02:42:42,000 --> 02:42:43,920
our application and then get airflow

4292
02:42:43,920 --> 02:42:45,080
hooked up as well so let's go ahead and

4293
02:42:45,080 --> 02:42:47,160
do that so I am on the air bite repo

4294
02:42:47,160 --> 02:42:48,720
right now which you can just go on

4295
02:42:48,720 --> 02:42:51,000
GitHub and all we're going to do pretty

4296
02:42:51,000 --> 02:42:53,240
simply is just copy this uh what we're

4297
02:42:53,240 --> 02:42:55,160
going to do is we're going to go back

4298
02:42:55,160 --> 02:42:57,560
into our terminal here we're going to

4299
02:42:57,560 --> 02:42:59,880
stop all of the docker containers and

4300
02:42:59,880 --> 02:43:02,359
then what we're going to do is get clone

4301
02:43:02,359 --> 02:43:04,000
and then we're going to clone air bite

4302
02:43:04,000 --> 02:43:06,399
into our repo here so that's going to

4303
02:43:06,399 --> 02:43:08,080
take a little bit the big open source

4304
02:43:08,080 --> 02:43:09,439
package and then if you wanted to read

4305
02:43:09,439 --> 02:43:11,000
the read me on how to get started and

4306
02:43:11,000 --> 02:43:13,080
things like that all of it is down here

4307
02:43:13,080 --> 02:43:14,640
but you can see that literally like you

4308
02:43:14,640 --> 02:43:16,880
can use this project for free and that's

4309
02:43:16,880 --> 02:43:19,240
the beauty of Open Source right so now

4310
02:43:19,240 --> 02:43:21,080
if we hit LS you can see we've created

4311
02:43:21,080 --> 02:43:23,279
an airite directory here and if we open

4312
02:43:23,279 --> 02:43:26,080
our project here on vs code you can see

4313
02:43:26,080 --> 02:43:28,399
that airite is now successfully inside

4314
02:43:28,399 --> 02:43:29,920
of the file directory along with

4315
02:43:29,920 --> 02:43:31,760
everything else so now let's hook up

4316
02:43:31,760 --> 02:43:33,760
everything together to make sure that it

4317
02:43:33,760 --> 02:43:35,520
works in harmony but before we run

4318
02:43:35,520 --> 02:43:36,760
anything with air bite we actually got

4319
02:43:36,760 --> 02:43:38,399
to set up a couple things so we do not

4320
02:43:38,399 --> 02:43:39,960
need to touch this Docker compos file

4321
02:43:39,960 --> 02:43:42,399
anymore that is completely all set and

4322
02:43:42,399 --> 02:43:44,960
ready to go if we go into this Docker

4323
02:43:44,960 --> 02:43:46,479
file you can see that obviously we've

4324
02:43:46,479 --> 02:43:48,520
installed the docker provider we're

4325
02:43:48,520 --> 02:43:50,359
actually going to install the air bite

4326
02:43:50,359 --> 02:43:51,720
provider as well as a couple other

4327
02:43:51,720 --> 02:43:53,600
things uh yes like I mentioned that

4328
02:43:53,600 --> 02:43:55,279
there are a couple other Integrations

4329
02:43:55,279 --> 02:43:57,160
with airf flow and air bite is one of

4330
02:43:57,160 --> 02:43:58,880
them with open source it's a little

4331
02:43:58,880 --> 02:44:01,960
different but we do use the HTTP

4332
02:44:01,960 --> 02:44:04,080
provider as well as the airb provider so

4333
02:44:04,080 --> 02:44:05,319
we're going to change this command up a

4334
02:44:05,319 --> 02:44:06,600
little bit everything's going to stay

4335
02:44:06,600 --> 02:44:08,600
the same but when we run pip install the

4336
02:44:08,600 --> 02:44:10,840
provider's docker we're going to add a

4337
02:44:10,840 --> 02:44:14,200
little uh Slash here we're going to say

4338
02:44:14,200 --> 02:44:16,359
and and pip

4339
02:44:16,359 --> 02:44:21,800
install Apache air flow providers and

4340
02:44:21,800 --> 02:44:24,080
then we're going to say HTTP we're going

4341
02:44:24,080 --> 02:44:25,439
add another backs slash here and we're

4342
02:44:25,439 --> 02:44:27,720
going to add another and and and then

4343
02:44:27,720 --> 02:44:30,640
this is going to be pip install Apache

4344
02:44:30,640 --> 02:44:34,880
airflow providers air bite so now we're

4345
02:44:34,880 --> 02:44:37,200
installing three different packages that

4346
02:44:37,200 --> 02:44:39,120
we need u i mean yes we do we do need

4347
02:44:39,120 --> 02:44:41,040
the docker one still but so yes we we're

4348
02:44:41,040 --> 02:44:43,439
going to be using airflow for Docker

4349
02:44:43,439 --> 02:44:45,680
HTTP and air bite works synonymously

4350
02:44:45,680 --> 02:44:48,399
together HTTP provider is a dependency

4351
02:44:48,399 --> 02:44:50,200
for the air provider so now we're going

4352
02:44:50,200 --> 02:44:52,319
to save that I'm actually going to

4353
02:44:52,319 --> 02:44:54,160
change up this

4354
02:44:54,160 --> 02:44:56,600
start.sh file so it's going to make it a

4355
02:44:56,600 --> 02:44:58,960
little bit easier to run the whole

4356
02:44:58,960 --> 02:45:00,520
project Al together we don't have to

4357
02:45:00,520 --> 02:45:02,640
keep waiting for the init air flow to

4358
02:45:02,640 --> 02:45:05,080
start and then we can kind of structure

4359
02:45:05,080 --> 02:45:07,439
the way that all these Zer containers

4360
02:45:07,439 --> 02:45:09,600
are running with this bash script so let

4361
02:45:09,600 --> 02:45:11,040
me go ahead and do that right now okay

4362
02:45:11,040 --> 02:45:12,399
so we're going to actually delete all

4363
02:45:12,399 --> 02:45:14,560
this stuff that's in here right now the

4364
02:45:14,560 --> 02:45:16,399
first thing that we want to do is we

4365
02:45:16,399 --> 02:45:18,200
want to do Docker compose up and then we

4366
02:45:18,200 --> 02:45:20,720
want to do in air flow now that's going

4367
02:45:20,720 --> 02:45:23,240
to obviously do the initialization of

4368
02:45:23,240 --> 02:45:25,479
air flow after that we're going to wait

4369
02:45:25,479 --> 02:45:27,319
5 seconds so we're going to sleep the

4370
02:45:27,319 --> 02:45:29,160
command for 5 seconds and then next

4371
02:45:29,160 --> 02:45:31,359
we're going to say Docker compose up hph

4372
02:45:31,359 --> 02:45:33,200
D to run it in the background because if

4373
02:45:33,200 --> 02:45:34,720
we don't run it in the background we

4374
02:45:34,720 --> 02:45:37,000
can't really um continue to see air bite

4375
02:45:37,000 --> 02:45:38,319
come through so after that we're going

4376
02:45:38,319 --> 02:45:40,880
to sleep for another 5 seconds after

4377
02:45:40,880 --> 02:45:42,479
that we're going to change directories

4378
02:45:42,479 --> 02:45:44,240
into the air bites directory because if

4379
02:45:44,240 --> 02:45:46,080
we see it here you can well you don't

4380
02:45:46,080 --> 02:45:47,640
you won't see it now but there is a

4381
02:45:47,640 --> 02:45:49,279
Docker composed file that needs to be

4382
02:45:49,279 --> 02:45:51,160
downloaded here and that's exactly what

4383
02:45:51,160 --> 02:45:52,399
we're going to do so we're going to CD

4384
02:45:52,399 --> 02:45:53,680
into airite and we're going to do a

4385
02:45:53,680 --> 02:45:56,120
little check here because the way that

4386
02:45:56,120 --> 02:45:59,240
we run it is there's a run platform uh

4387
02:45:59,240 --> 02:46:01,080
shell script that we need to run with

4388
02:46:01,080 --> 02:46:04,040
airite and that is the initialization

4389
02:46:04,040 --> 02:46:06,240
where it downloads all the correct files

4390
02:46:06,240 --> 02:46:07,720
that we need to in order to spin up all

4391
02:46:07,720 --> 02:46:09,319
the docker containers so we're going to

4392
02:46:09,319 --> 02:46:10,560
say if and we're going to look for the

4393
02:46:10,560 --> 02:46:13,080
file here so we're going to say uh

4394
02:46:13,080 --> 02:46:14,920
hyphen f and then we're looking for

4395
02:46:14,920 --> 02:46:17,760
Docker composed. yo that's the file

4396
02:46:17,760 --> 02:46:19,479
we're looking for if

4397
02:46:19,479 --> 02:46:23,439
that exists then we're going to uh run

4398
02:46:23,439 --> 02:46:27,160
Docker compos up hyphen D if it doesn't

4399
02:46:27,160 --> 02:46:30,680
exist we're going to run slash run

4400
02:46:30,680 --> 02:46:33,040
hyphen ab

4401
02:46:33,040 --> 02:46:34,520
platform.sh and then we're going to

4402
02:46:34,520 --> 02:46:37,640
finish okay so very simple script here

4403
02:46:37,640 --> 02:46:39,359
uh we're also going to create another

4404
02:46:39,359 --> 02:46:42,120
one that's going to say stop. sh so this

4405
02:46:42,120 --> 02:46:44,920
one is going to say Docker compose down

4406
02:46:44,920 --> 02:46:48,000
hyphen V and then we're going to uh I

4407
02:46:48,000 --> 02:46:49,880
think we're going to sleep for 5 seconds

4408
02:46:49,880 --> 02:46:53,200
we're going to CD into air bite and and

4409
02:46:53,200 --> 02:46:56,000
then do Docker compose down so that is

4410
02:46:56,000 --> 02:46:59,240
going to be the start and stop for this

4411
02:46:59,240 --> 02:47:02,399
to make this easier to run every single

4412
02:47:02,399 --> 02:47:04,760
container so now what we're going to do

4413
02:47:04,760 --> 02:47:06,960
we're going to go into our dag and then

4414
02:47:06,960 --> 02:47:09,319
change up everything because we no

4415
02:47:09,319 --> 02:47:11,399
longer need this elt script we're

4416
02:47:11,399 --> 02:47:12,880
obviously going to still need the docker

4417
02:47:12,880 --> 02:47:14,800
operator but the python operator we

4418
02:47:14,800 --> 02:47:16,080
don't need it anymore since we're going

4419
02:47:16,080 --> 02:47:18,200
to be using airite to do it so let's go

4420
02:47:18,200 --> 02:47:19,399
ahead and

4421
02:47:19,399 --> 02:47:22,080
hook that up right now all right so like

4422
02:47:22,080 --> 02:47:23,560
I said we we actually didn't end up

4423
02:47:23,560 --> 02:47:25,279
using the bash operator and we don't

4424
02:47:25,279 --> 02:47:27,000
need the python operator anymore so we

4425
02:47:27,000 --> 02:47:28,800
can remove this um let's go ahead and

4426
02:47:28,800 --> 02:47:31,359
remove the time Delta as well because we

4427
02:47:31,359 --> 02:47:32,960
do not need that right now so what we're

4428
02:47:32,960 --> 02:47:36,399
going to do is also remove this function

4429
02:47:36,399 --> 02:47:38,080
here and then this is where we're going

4430
02:47:38,080 --> 02:47:40,279
to start doing our actually I'm going to

4431
02:47:40,279 --> 02:47:41,880
leave this for now so right here above

4432
02:47:41,880 --> 02:47:43,720
the default args we're going to create a

4433
02:47:43,720 --> 02:47:46,760
Conor ID variable and this is going to

4434
02:47:46,760 --> 02:47:49,240
be a string so this will make sense so a

4435
02:47:49,240 --> 02:47:51,319
connection ID is what this stands for

4436
02:47:51,319 --> 02:47:53,200
within airite we have a connection ID

4437
02:47:53,200 --> 02:47:55,399
and a workspace ID and those are just

4438
02:47:55,399 --> 02:47:57,880
identifiers for your specific instance

4439
02:47:57,880 --> 02:47:59,920
of airite let's say but more

4440
02:47:59,920 --> 02:48:01,600
specifically if we're looking at the

4441
02:48:01,600 --> 02:48:02,960
source and the destination that we

4442
02:48:02,960 --> 02:48:05,080
currently have the both of the postgress

4443
02:48:05,080 --> 02:48:06,800
databases connecting those together

4444
02:48:06,800 --> 02:48:08,560
obviously create a connection and for

4445
02:48:08,560 --> 02:48:10,520
airite when we connect the two we have a

4446
02:48:10,520 --> 02:48:12,439
connector and that connector has that

4447
02:48:12,439 --> 02:48:13,960
connection ID so that's exactly what

4448
02:48:13,960 --> 02:48:15,880
we're going to use this variable for is

4449
02:48:15,880 --> 02:48:18,200
to grab that and then input it here into

4450
02:48:18,200 --> 02:48:19,640
the Dag to make sure that we're

4451
02:48:19,640 --> 02:48:21,319
orchestrating the correct connector

4452
02:48:21,319 --> 02:48:22,800
right now and so here what we're going

4453
02:48:22,800 --> 02:48:24,279
to do is we're actually going to go back

4454
02:48:24,279 --> 02:48:26,479
up here we're going to say from airflow

4455
02:48:26,479 --> 02:48:27,399
uh the first thing we're actually going

4456
02:48:27,399 --> 02:48:30,680
to do is from utils and dates so we're

4457
02:48:30,680 --> 02:48:33,279
going to use the dates util from airflow

4458
02:48:33,279 --> 02:48:35,680
we're going to import days uncore ago

4459
02:48:35,680 --> 02:48:37,720
under that we're going to say from

4460
02:48:37,720 --> 02:48:43,080
airflow. providers. a. operators. airite

4461
02:48:43,080 --> 02:48:45,479
we're going to import the airite trigger

4462
02:48:45,479 --> 02:48:49,240
sync operator so this is going to be the

4463
02:48:49,240 --> 02:48:51,600
module that we're using to trigger syns

4464
02:48:51,600 --> 02:48:53,319
on the connection that we create with

4465
02:48:53,319 --> 02:48:55,720
from within airbag now we're going to

4466
02:48:55,720 --> 02:48:58,479
replace that replace T1 with this

4467
02:48:58,479 --> 02:49:00,200
operator here let's go ahead and replace

4468
02:49:00,200 --> 02:49:01,319
it and now the first thing we're going

4469
02:49:01,319 --> 02:49:04,200
to do is change the task ID so this is

4470
02:49:04,200 --> 02:49:07,120
uh oh whoops I replaced the wrong one uh

4471
02:49:07,120 --> 02:49:08,760
this is the python operator we're trying

4472
02:49:08,760 --> 02:49:09,960
to replace so the first thing we're

4473
02:49:09,960 --> 02:49:12,200
going to replace is the task ID so this

4474
02:49:12,200 --> 02:49:15,479
one is going to be the Airy _ postgress

4475
02:49:15,479 --> 02:49:18,960
_ postgress task ID and uh we no longer

4476
02:49:18,960 --> 02:49:20,479
have a python callable here but the

4477
02:49:20,479 --> 02:49:22,319
first thing we're going to do is

4478
02:49:22,319 --> 02:49:25,640
aircore Conor ID which is an argument

4479
02:49:25,640 --> 02:49:27,600
that we need which obviously we've

4480
02:49:27,600 --> 02:49:29,479
provided which is going to be air bite

4481
02:49:29,479 --> 02:49:31,239
so this will make more sense once we're

4482
02:49:31,239 --> 02:49:32,840
inside of web flow but we need to make a

4483
02:49:32,840 --> 02:49:34,800
connection inside airflow and we're

4484
02:49:34,800 --> 02:49:36,000
going to name that air bite so we're

4485
02:49:36,000 --> 02:49:38,239
going to add that the connection ID is

4486
02:49:38,239 --> 02:49:40,640
what we provided so this will point to

4487
02:49:40,640 --> 02:49:43,760
the con ID variable that we had right

4488
02:49:43,760 --> 02:49:45,600
make sure that my commas here underneath

4489
02:49:45,600 --> 02:49:47,520
that is asynchronous so if we wanted to

4490
02:49:47,520 --> 02:49:51,120
asynchronously do jobs asynchronous I

4491
02:49:51,120 --> 02:49:52,800
think is how I spell it wait did I spell

4492
02:49:52,800 --> 02:49:55,359
that right asynchronous false so this is

4493
02:49:55,359 --> 02:49:56,520
not going to be asynchronous we would

4494
02:49:56,520 --> 02:49:58,239
have to add another operator but we're

4495
02:49:58,239 --> 02:50:00,000
not doing any jobs asynchronously we're

4496
02:50:00,000 --> 02:50:02,120
only triggering one job so we're going

4497
02:50:02,120 --> 02:50:03,239
to leave it at that we're going to leave

4498
02:50:03,239 --> 02:50:06,080
the timeout to 3600 we're going to say

4499
02:50:06,080 --> 02:50:08,680
waitor seconds uh we're going to wait 3

4500
02:50:08,680 --> 02:50:10,880
seconds and then the dag obviously we're

4501
02:50:10,880 --> 02:50:12,359
we're putting back into deck so you can

4502
02:50:12,359 --> 02:50:14,399
see pretty simple in terms of what it's

4503
02:50:14,399 --> 02:50:16,800
accepting here the main thing here to

4504
02:50:16,800 --> 02:50:19,399
note is going to be these two properties

4505
02:50:19,399 --> 02:50:21,600
right here so the airb con ID which

4506
02:50:21,600 --> 02:50:23,319
we're going to find within airflow and

4507
02:50:23,319 --> 02:50:25,000
then the connection ID is going to be

4508
02:50:25,000 --> 02:50:26,319
what's important to us here so we're

4509
02:50:26,319 --> 02:50:27,760
actually going to save that and nothing

4510
02:50:27,760 --> 02:50:30,239
else changes so we've we've successfully

4511
02:50:30,239 --> 02:50:32,720
put an air bite within the dag um the

4512
02:50:32,720 --> 02:50:34,439
one thing we need to do here is we do

4513
02:50:34,439 --> 02:50:36,399
need to add our connection ID which we

4514
02:50:36,399 --> 02:50:37,880
have not gotten yet there is a little

4515
02:50:37,880 --> 02:50:39,600
bit of a trick here that we're going to

4516
02:50:39,600 --> 02:50:41,880
have to do um it's kind of inefficient

4517
02:50:41,880 --> 02:50:43,200
but for the sake of this project we're

4518
02:50:43,200 --> 02:50:44,560
going to have to do it so let me show

4519
02:50:44,560 --> 02:50:45,960
you what that is we're going to have to

4520
02:50:45,960 --> 02:50:48,239
make another bash script potentially but

4521
02:50:48,239 --> 02:50:49,880
it should all be okay this is what

4522
02:50:49,880 --> 02:50:51,880
happens when you kind of have to work

4523
02:50:51,880 --> 02:50:54,000
with multiple different Docker

4524
02:50:54,000 --> 02:50:56,399
containers since airite is working in in

4525
02:50:56,399 --> 02:50:58,080
its own so let's go ahead and do that

4526
02:50:58,080 --> 02:50:59,160
right now I'm actually going to create

4527
02:50:59,160 --> 02:51:01,479
another bash script here um this one's

4528
02:51:01,479 --> 02:51:03,479
going to be elt Dosh and this one is

4529
02:51:03,479 --> 02:51:05,399
going to be exactly what we did before

4530
02:51:05,399 --> 02:51:07,439
where it's just Docker compose up init

4531
02:51:07,439 --> 02:51:08,920
uh hyphen airflow and then we're going

4532
02:51:08,920 --> 02:51:10,600
to sleep for five and then we're going

4533
02:51:10,600 --> 02:51:14,399
to Docker compose up Hy so the reason

4534
02:51:14,399 --> 02:51:17,840
for this is that air bite has its own

4535
02:51:17,840 --> 02:51:19,840
set of do containers that are running to

4536
02:51:19,840 --> 02:51:21,680
make sure that everything is working and

4537
02:51:21,680 --> 02:51:23,840
then we have our own elt containers that

4538
02:51:23,840 --> 02:51:25,720
we've already been working with and we

4539
02:51:25,720 --> 02:51:28,720
can close those separately now in order

4540
02:51:28,720 --> 02:51:30,840
for this to work we need to grab the

4541
02:51:30,840 --> 02:51:32,760
connection ID that we make from within

4542
02:51:32,760 --> 02:51:34,800
air bite and in order to create the

4543
02:51:34,800 --> 02:51:37,359
connection we need to obviously hook up

4544
02:51:37,359 --> 02:51:39,080
the source and the destination together

4545
02:51:39,080 --> 02:51:40,319
which we're going to do next but then

4546
02:51:40,319 --> 02:51:42,160
when we have the connection ID we can't

4547
02:51:42,160 --> 02:51:45,160
necessarily save the connection ID into

4548
02:51:45,160 --> 02:51:47,640
the dag and then you know load it up

4549
02:51:47,640 --> 02:51:48,640
we're going to have to kill the

4550
02:51:48,640 --> 02:51:51,279
container so that the new connector ID

4551
02:51:51,279 --> 02:51:53,080
propagates but air bite will still be

4552
02:51:53,080 --> 02:51:55,120
active so we're just going to go ahead

4553
02:51:55,120 --> 02:51:56,800
and kind of go through that process but

4554
02:51:56,800 --> 02:51:58,800
then at the end we'll see that airflow

4555
02:51:58,800 --> 02:52:00,479
is able to read everything that we've

4556
02:52:00,479 --> 02:52:02,399
done and then we can orchestrate both

4557
02:52:02,399 --> 02:52:04,319
air bites that's replacing our elt

4558
02:52:04,319 --> 02:52:07,279
script and then using DBT to write on

4559
02:52:07,279 --> 02:52:09,479
top of the destination databases that we

4560
02:52:09,479 --> 02:52:11,120
have currently so let's go ahead and run

4561
02:52:11,120 --> 02:52:13,160
air bite right now and then we'll get

4562
02:52:13,160 --> 02:52:15,640
going into uh hooking up both of the

4563
02:52:15,640 --> 02:52:17,200
source and destinations to create our

4564
02:52:17,200 --> 02:52:18,600
first connector all right so now we're

4565
02:52:18,600 --> 02:52:20,800
in the UI and then now all we got to do

4566
02:52:20,800 --> 02:52:24,439
is put in our information here you can

4567
02:52:24,439 --> 02:52:25,920
choose this if you want but I'm going to

4568
02:52:25,920 --> 02:52:27,239
say get started and then now we're in

4569
02:52:27,239 --> 02:52:29,000
the airb UI and let me walk you through

4570
02:52:29,000 --> 02:52:31,160
really quickly it's it's very simple so

4571
02:52:31,160 --> 02:52:32,960
we have connections so if you have all

4572
02:52:32,960 --> 02:52:34,840
your sources and destinations in they're

4573
02:52:34,840 --> 02:52:36,160
connected together this would be your

4574
02:52:36,160 --> 02:52:37,760
connections if we go to sources you can

4575
02:52:37,760 --> 02:52:39,680
see we have a bunch of different sources

4576
02:52:39,680 --> 02:52:41,960
both certified as well as community and

4577
02:52:41,960 --> 02:52:44,000
the same thing on the destination side

4578
02:52:44,000 --> 02:52:45,560
so the one thing we're going to do is

4579
02:52:45,560 --> 02:52:46,960
we're actually going to go for post

4580
02:52:46,960 --> 02:52:48,080
crust here you can see it's pretty

4581
02:52:48,080 --> 02:52:50,720
simple it's just simply logging in to

4582
02:52:50,720 --> 02:52:53,439
your instances here or our databases so

4583
02:52:53,439 --> 02:52:55,040
I'm actually going to name this source

4584
02:52:55,040 --> 02:52:56,760
postgress and then for the host here

4585
02:52:56,760 --> 02:52:58,479
we're going to say host. Docker do

4586
02:52:58,479 --> 02:53:01,279
internal and for the port I believe Port

4587
02:53:01,279 --> 02:53:04,800
5433 is is the name or is the port

4588
02:53:04,800 --> 02:53:07,000
number and then for the database name is

4589
02:53:07,000 --> 02:53:09,720
going to be Source DB now for the

4590
02:53:09,720 --> 02:53:12,000
username was just postgress and for the

4591
02:53:12,000 --> 02:53:15,120
password was just secret okay now no SSL

4592
02:53:15,120 --> 02:53:17,520
modes no SSH tunnels needed for this

4593
02:53:17,520 --> 02:53:19,040
sake I'm going to be using detect

4594
02:53:19,040 --> 02:53:21,239
changes with the X-Men system column and

4595
02:53:21,239 --> 02:53:23,359
then you know if you have any jdbc URL

4596
02:53:23,359 --> 02:53:25,200
parameters here you can absolutely add

4597
02:53:25,200 --> 02:53:26,720
that let me go ahead and hit set up

4598
02:53:26,720 --> 02:53:29,399
Source here and then it should just

4599
02:53:29,399 --> 02:53:31,640
essentially make a call to the postest

4600
02:53:31,640 --> 02:53:34,279
database there through the API and We're

4601
02:53:34,279 --> 02:53:36,640
Off to the Races it should just connect

4602
02:53:36,640 --> 02:53:39,760
properly if everything is correct and if

4603
02:53:39,760 --> 02:53:42,200
I look on Docker we should have the

4604
02:53:42,200 --> 02:53:45,120
containers open so that is correct cool

4605
02:53:45,120 --> 02:53:47,359
all the test connections have passed so

4606
02:53:47,359 --> 02:53:48,760
then it spits us over to create a

4607
02:53:48,760 --> 02:53:50,479
connection and we're actually going to

4608
02:53:50,479 --> 02:53:53,160
add a destination now which is going to

4609
02:53:53,160 --> 02:53:54,880
be also postgress now it's going to be

4610
02:53:54,880 --> 02:53:57,640
the same thing we're going to name this

4611
02:53:57,640 --> 02:53:59,279
destination

4612
02:53:59,279 --> 02:54:03,160
postgress uh host. doer. internal the

4613
02:54:03,160 --> 02:54:06,200
port here is going to be 5434 DB name is

4614
02:54:06,200 --> 02:54:07,200
going to be

4615
02:54:07,200 --> 02:54:10,760
destination DB default schema uh we're

4616
02:54:10,760 --> 02:54:13,080
going to name the user postgress and

4617
02:54:13,080 --> 02:54:14,760
then it's kind of hidden right now but

4618
02:54:14,760 --> 02:54:16,279
in the optional Fields we're going to

4619
02:54:16,279 --> 02:54:18,640
say secret as the password because we do

4620
02:54:18,640 --> 02:54:20,239
need that and then we're going to go

4621
02:54:20,239 --> 02:54:23,319
ahead and hit setup destination and cool

4622
02:54:23,319 --> 02:54:25,520
all test connections have passed and

4623
02:54:25,520 --> 02:54:28,319
what you can see up here uh is that we

4624
02:54:28,319 --> 02:54:29,960
have you know the connection name you

4625
02:54:29,960 --> 02:54:31,680
have source postgress to destination

4626
02:54:31,680 --> 02:54:33,920
postgress replication frequency there

4627
02:54:33,920 --> 02:54:36,600
isn't orchestrator from within airite

4628
02:54:36,600 --> 02:54:38,520
but we want to switch this over to

4629
02:54:38,520 --> 02:54:41,080
manual because we are orchestrating this

4630
02:54:41,080 --> 02:54:43,359
with airflow if we were wanted to just

4631
02:54:43,359 --> 02:54:45,000
have this work on its own we can

4632
02:54:45,000 --> 02:54:46,960
absolutely do that if we wanted to add a

4633
02:54:46,960 --> 02:54:48,960
Kon job you can absolutely do that as

4634
02:54:48,960 --> 02:54:50,840
well from within here but for our sake

4635
02:54:50,840 --> 02:54:52,560
we're going to use manual there's a name

4636
02:54:52,560 --> 02:54:54,800
space there's the stream prefix to

4637
02:54:54,800 --> 02:54:56,760
identify streams a little easier and

4638
02:54:56,760 --> 02:54:59,120
here is all the tables coming in from

4639
02:54:59,120 --> 02:55:01,720
our source database now what I'm going

4640
02:55:01,720 --> 02:55:03,160
to do here is I'm going to check all of

4641
02:55:03,160 --> 02:55:05,200
these cuz I want all of these streams or

4642
02:55:05,200 --> 02:55:07,720
all of these tables to come with and now

4643
02:55:07,720 --> 02:55:09,479
from here we can choose a sync mode so

4644
02:55:09,479 --> 02:55:12,239
do we want to fully refresh every single

4645
02:55:12,239 --> 02:55:14,760
time do we want to incremental which we

4646
02:55:14,760 --> 02:55:18,040
recommend uh only the changes because it

4647
02:55:18,040 --> 02:55:20,720
does support CDC do we only want to sync

4648
02:55:20,720 --> 02:55:23,200
the changes from the database over to

4649
02:55:23,200 --> 02:55:24,840
the destination depending on the

4650
02:55:24,840 --> 02:55:26,640
transactions uh in our case we're going

4651
02:55:26,640 --> 02:55:28,399
to do full refresh overwrite for all of

4652
02:55:28,399 --> 02:55:31,040
them uh so we can do some uh testing

4653
02:55:31,040 --> 02:55:33,560
here but uh yes incremental sync is

4654
02:55:33,560 --> 02:55:36,000
probably the way to go here we do offer

4655
02:55:36,000 --> 02:55:38,040
normalized tabular data in this so we do

4656
02:55:38,040 --> 02:55:40,880
some normalization on top of the data

4657
02:55:40,880 --> 02:55:42,279
and that is totally fine so I'm going to

4658
02:55:42,279 --> 02:55:44,000
go ahead and set up this connection here

4659
02:55:44,000 --> 02:55:46,279
and there we go uh once this is all set

4660
02:55:46,279 --> 02:55:48,359
up we can see here at the top we have we

4661
02:55:48,359 --> 02:55:50,560
have a couple IDs that are very

4662
02:55:50,560 --> 02:55:52,399
important to us so the first one is

4663
02:55:52,399 --> 02:55:55,200
going to be the workspaces ID uh the

4664
02:55:55,200 --> 02:55:56,680
next one is going to be the connections

4665
02:55:56,680 --> 02:55:59,479
ID we want this connections ID so what

4666
02:55:59,479 --> 02:56:03,319
we're going to do is copy this head over

4667
02:56:03,319 --> 02:56:07,000
into our dag and paste this into the

4668
02:56:07,000 --> 02:56:08,520
connection I now we're going to save

4669
02:56:08,520 --> 02:56:10,680
this but remember what I said when we uh

4670
02:56:10,680 --> 02:56:13,080
you know when we launch airflow and and

4671
02:56:13,080 --> 02:56:14,640
all of these containers right here

4672
02:56:14,640 --> 02:56:17,359
they're in separate instances right and

4673
02:56:17,359 --> 02:56:19,359
so the change just made has not

4674
02:56:19,359 --> 02:56:21,279
propagated and so we're not going to be

4675
02:56:21,279 --> 02:56:25,680
able to stop or to start the dag right

4676
02:56:25,680 --> 02:56:27,359
now so what we're going to do is we're

4677
02:56:27,359 --> 02:56:30,279
actually going to kill the elt section

4678
02:56:30,279 --> 02:56:33,359
first and then leave airite open restart

4679
02:56:33,359 --> 02:56:36,800
this we should be able to then start the

4680
02:56:36,800 --> 02:56:39,120
sink using airflow so what I'm going to

4681
02:56:39,120 --> 02:56:43,479
do now is Docker compose up or uh we

4682
02:56:43,479 --> 02:56:46,120
have that elt script so what I'm going

4683
02:56:46,120 --> 02:56:50,040
to do is I have to add uh see sod plus

4684
02:56:50,040 --> 02:56:54,319
x/t Dosh and now I can say elt

4685
02:56:54,319 --> 02:56:57,359
Dosh and that should run the init first

4686
02:56:57,359 --> 02:56:59,600
and then that should run the rest of the

4687
02:56:59,600 --> 02:57:02,000
docker containers we need on the elt

4688
02:57:02,000 --> 02:57:04,120
side um so the init is done and we can

4689
02:57:04,120 --> 02:57:05,760
see it down here and then it should

4690
02:57:05,760 --> 02:57:07,439
follow up with all of that so there we

4691
02:57:07,439 --> 02:57:10,399
go everything should be initialized now

4692
02:57:10,399 --> 02:57:12,200
what we have to do is obviously

4693
02:57:12,200 --> 02:57:14,200
everybody is still running now let's go

4694
02:57:14,200 --> 02:57:17,080
in and do Local Host port 8080 that's

4695
02:57:17,080 --> 02:57:18,800
going to let us sign into our instance

4696
02:57:18,800 --> 02:57:20,520
here uh we're having an issue with the

4697
02:57:20,520 --> 02:57:23,439
dag uh I think it's the provider here

4698
02:57:23,439 --> 02:57:26,479
yep okay so I had an issue with this

4699
02:57:26,479 --> 02:57:31,319
before airflow. providers. a. operators.

4700
02:57:31,319 --> 02:57:33,800
Airy um let me double check to make sure

4701
02:57:33,800 --> 02:57:37,479
that is the correct installation of it

4702
02:57:37,479 --> 02:57:39,200
so what we're probably going to need to

4703
02:57:39,200 --> 02:57:44,000
do is for some reason this doesn't fully

4704
02:57:44,000 --> 02:57:46,800
work here use your airflow yeah because

4705
02:57:46,800 --> 02:57:49,279
we let me double check this um oh I

4706
02:57:49,279 --> 02:57:51,439
forgot to do that okay so the one thing

4707
02:57:51,439 --> 02:57:54,080
we do actually need to do is we need to

4708
02:57:54,080 --> 02:57:57,080
remove this user tag here because we

4709
02:57:57,080 --> 02:57:59,560
want the user to switch every single

4710
02:57:59,560 --> 02:58:02,200
time so uh we it's a weird thing where

4711
02:58:02,200 --> 02:58:05,359
you have to be the airflow user before

4712
02:58:05,359 --> 02:58:07,880
to install the actual correct operator

4713
02:58:07,880 --> 02:58:09,600
and then switch back to the route in

4714
02:58:09,600 --> 02:58:10,800
order to run the dag so that's what

4715
02:58:10,800 --> 02:58:12,319
we're going to do we're going to do

4716
02:58:12,319 --> 02:58:14,960
Docker compose down hyphen B um and then

4717
02:58:14,960 --> 02:58:17,239
run our elt script again after we remove

4718
02:58:17,239 --> 02:58:19,200
that so let's go ahead and run it should

4719
02:58:19,200 --> 02:58:21,200
be good so then it will use it'll go

4720
02:58:21,200 --> 02:58:23,359
down and read the user airflow first run

4721
02:58:23,359 --> 02:58:25,439
this command to install all the correct

4722
02:58:25,439 --> 02:58:27,840
operators and then we'll have back to

4723
02:58:27,840 --> 02:58:29,520
the user route once they're installed

4724
02:58:29,520 --> 02:58:30,960
that way we can actually run the dag

4725
02:58:30,960 --> 02:58:32,880
okay so that should be good let me go

4726
02:58:32,880 --> 02:58:35,680
ahead and wait for it to run here there

4727
02:58:35,680 --> 02:58:37,960
we go uh still having an error here all

4728
02:58:37,960 --> 02:58:39,399
right so I got it working and this is

4729
02:58:39,399 --> 02:58:41,399
just a note uh there is some weird

4730
02:58:41,399 --> 02:58:43,880
issues kind of with Docker but so if you

4731
02:58:43,880 --> 02:58:45,439
ever run into issues like that you want

4732
02:58:45,439 --> 02:58:47,479
to go into the images section so I had

4733
02:58:47,479 --> 02:58:50,640
to look for for the elt web server and

4734
02:58:50,640 --> 02:58:52,680
scheduler because we built those images

4735
02:58:52,680 --> 02:58:55,239
already and it doesn't propagate with

4736
02:58:55,239 --> 02:58:57,439
these new commands here and so when I

4737
02:58:57,439 --> 02:58:59,800
reran or sorry when I deleted the images

4738
02:58:59,800 --> 02:59:01,920
and reran it it actually went through

4739
02:59:01,920 --> 02:59:04,319
and installed the correct operator so

4740
02:59:04,319 --> 02:59:06,800
now if we go back to the web UI you can

4741
02:59:06,800 --> 02:59:08,840
see that the dag is now in there so we

4742
02:59:08,840 --> 02:59:10,279
did everything correctly it was just a

4743
02:59:10,279 --> 02:59:12,239
matter of deleting the images on Docker

4744
02:59:12,239 --> 02:59:14,359
first and so now what we're going to do

4745
02:59:14,359 --> 02:59:15,920
is before we even run it we need to go

4746
02:59:15,920 --> 02:59:18,520
up into connections uh and then hit this

4747
02:59:18,520 --> 02:59:20,359
plus sign right here and now what we can

4748
02:59:20,359 --> 02:59:21,800
see is we have a connection type of air

4749
02:59:21,800 --> 02:59:23,120
bite but that's not exactly what we're

4750
02:59:23,120 --> 02:59:24,200
going to be using so if you remember

4751
02:59:24,200 --> 02:59:26,080
this connection ID if we go back to the

4752
02:59:26,080 --> 02:59:28,960
code of the dag you can see we had a

4753
02:59:28,960 --> 02:59:30,600
connection IDE of airbit so what we're

4754
02:59:30,600 --> 02:59:32,359
going to do is we're going to say air

4755
02:59:32,359 --> 02:59:34,680
bites we're going to go down into uh

4756
02:59:34,680 --> 02:59:37,600
HTTP and then for the host is going to

4757
02:59:37,600 --> 02:59:40,960
be do uh host. doer. internal we don't

4758
02:59:40,960 --> 02:59:42,560
need to provide login password but for

4759
02:59:42,560 --> 02:59:43,880
the UI we're actually going to point it

4760
02:59:43,880 --> 02:59:47,080
to 801 because that's going to be where

4761
02:59:47,080 --> 02:59:49,800
um we can access access the actual UI

4762
02:59:49,800 --> 02:59:51,080
and everything so we're going to hit

4763
02:59:51,080 --> 02:59:52,560
save and so now we have this air bite

4764
02:59:52,560 --> 02:59:54,439
section if we go back to dags let's go

4765
02:59:54,439 --> 02:59:56,239
ahead and Trigger this and so we

4766
02:59:56,239 --> 02:59:58,640
triggered it if we go back to the airb

4767
02:59:58,640 --> 03:00:01,000
connections we should be able to refresh

4768
03:00:01,000 --> 03:00:03,720
and hopefully see that a stream is going

4769
03:00:03,720 --> 03:00:06,279
to start here eventually okay so it

4770
03:00:06,279 --> 03:00:07,880
failed instantly okay so it looks like

4771
03:00:07,880 --> 03:00:09,800
it aired because let's actually go back

4772
03:00:09,800 --> 03:00:12,520
to the uh the connections here we

4773
03:00:12,520 --> 03:00:14,319
actually may need to do a login password

4774
03:00:14,319 --> 03:00:17,200
so this is host. doer. internal 801

4775
03:00:17,200 --> 03:00:18,680
let's add airb

4776
03:00:18,680 --> 03:00:21,720
and password because this is a default

4777
03:00:21,720 --> 03:00:23,840
um thing that's needed or login that's

4778
03:00:23,840 --> 03:00:26,160
needed for us on our side uh for

4779
03:00:26,160 --> 03:00:27,600
security reasons and obviously that can

4780
03:00:27,600 --> 03:00:29,560
change let me go ahead and rerun this

4781
03:00:29,560 --> 03:00:31,680
again and that should give us

4782
03:00:31,680 --> 03:00:34,680
permissions to run the sync there we go

4783
03:00:34,680 --> 03:00:36,000
so now you can see that we have a sync

4784
03:00:36,000 --> 03:00:37,880
running so we've able to trigger the

4785
03:00:37,880 --> 03:00:41,160
actual sync Now using airflow and that

4786
03:00:41,160 --> 03:00:42,760
should just work so if we go back to

4787
03:00:42,760 --> 03:00:45,319
statuses here we should be able to watch

4788
03:00:45,319 --> 03:00:47,960
it go and then once that's loaded into

4789
03:00:47,960 --> 03:00:49,920
to the destination then the DBT

4790
03:00:49,920 --> 03:00:51,880
container will spin up and then we will

4791
03:00:51,880 --> 03:00:54,760
have all of our models written onto the

4792
03:00:54,760 --> 03:00:56,640
destination side but data was moved from

4793
03:00:56,640 --> 03:00:58,720
Air bite so let's go ahead and wait for

4794
03:00:58,720 --> 03:01:01,040
that to load here but if we go back to

4795
03:01:01,040 --> 03:01:02,600
the dags we can see that it's all

4796
03:01:02,600 --> 03:01:05,840
working now we were able to successfully

4797
03:01:05,840 --> 03:01:07,520
connect to airbit and it's not going to

4798
03:01:07,520 --> 03:01:09,640
succeed until this is completely done

4799
03:01:09,640 --> 03:01:11,000
there we go so sink has succeeded you

4800
03:01:11,000 --> 03:01:14,120
can see that we have3 records extracted

4801
03:01:14,120 --> 03:01:16,920
if we go back to airflow we should be

4802
03:01:16,920 --> 03:01:18,520
able to see that it will will succeed

4803
03:01:18,520 --> 03:01:21,040
and then it's going to run DBT uh there

4804
03:01:21,040 --> 03:01:22,720
we go so there's the first success and

4805
03:01:22,720 --> 03:01:25,120
then now we're waiting for DBT to run

4806
03:01:25,120 --> 03:01:26,560
and then once DBT has run we're going to

4807
03:01:26,560 --> 03:01:28,120
go ahead and check so DBT just

4808
03:01:28,120 --> 03:01:29,800
successfully ran go back into our

4809
03:01:29,800 --> 03:01:32,479
terminal and then go back into our

4810
03:01:32,479 --> 03:01:35,520
destination database so see

4811
03:01:35,520 --> 03:01:40,200
destination DB let's go ahead and do a

4812
03:01:40,200 --> 03:01:43,080
/dt and then you can see so now we have

4813
03:01:43,080 --> 03:01:44,720
some extra stuff so you can see airb

4814
03:01:44,720 --> 03:01:46,760
actually wrote some raw data into the

4815
03:01:46,760 --> 03:01:48,880
database but it has come with all of the

4816
03:01:48,880 --> 03:01:51,479
other tables here notice how specific

4817
03:01:51,479 --> 03:01:55,399
movie and film ratings isn't here so you

4818
03:01:55,399 --> 03:01:57,800
can see that DBT actually ran we only

4819
03:01:57,800 --> 03:01:59,160
have the tables coming from the source

4820
03:01:59,160 --> 03:02:02,120
database and now if we do select all

4821
03:02:02,120 --> 03:02:04,359
from specific

4822
03:02:04,359 --> 03:02:07,120
movie that's going to show the actual

4823
03:02:07,120 --> 03:02:08,920
Inception you know all that stuff along

4824
03:02:08,920 --> 03:02:10,640
with some airite metadata so you could

4825
03:02:10,640 --> 03:02:12,680
see that has actually successfully

4826
03:02:12,680 --> 03:02:14,200
worked we have air bite being

4827
03:02:14,200 --> 03:02:17,319
orchestrated by airflow and DBT now

4828
03:02:17,319 --> 03:02:19,479
being or rated by airflow all within

4829
03:02:19,479 --> 03:02:22,920
this simple project and that right there

4830
03:02:22,920 --> 03:02:25,439
is the full project completed hopefully

4831
03:02:25,439 --> 03:02:27,120
that give you a pretty high level

4832
03:02:27,120 --> 03:02:29,560
understanding and example of how you

4833
03:02:29,560 --> 03:02:31,760
could successfully create a data

4834
03:02:31,760 --> 03:02:33,040
pipeline from scratch but then

4835
03:02:33,040 --> 03:02:35,040
ultimately lead that into a

4836
03:02:35,040 --> 03:02:37,680
fully-fledged open-source data pipeline

4837
03:02:37,680 --> 03:02:39,359
where you're sending data from a

4838
03:02:39,359 --> 03:02:41,120
postgress database using a tool like

4839
03:02:41,120 --> 03:02:43,359
airite to connect it to a destination

4840
03:02:43,359 --> 03:02:45,080
database where you need the data to go

4841
03:02:45,080 --> 03:02:46,520
to and then from there you're

4842
03:02:46,520 --> 03:02:48,319
orchestrating it with airflow writing

4843
03:02:48,319 --> 03:02:50,560
custom models on top of it with DBT to

4844
03:02:50,560 --> 03:02:52,680
then use for other sort of data analysis

4845
03:02:52,680 --> 03:02:54,040
or things like that ultimately the

4846
03:02:54,040 --> 03:02:55,840
destination could be anything where it

4847
03:02:55,840 --> 03:02:58,279
ends up in a CRM or some sort of tool

4848
03:02:58,279 --> 03:03:00,640
like metabase or looker for other open-

4849
03:03:00,640 --> 03:03:02,479
source options there but essentially

4850
03:03:02,479 --> 03:03:03,960
this is kind of like my version of a

4851
03:03:03,960 --> 03:03:06,120
storytelling where you can see how a

4852
03:03:06,120 --> 03:03:08,439
data pipeline can evolve how complicated

4853
03:03:08,439 --> 03:03:10,399
it can be at the very beginning but then

4854
03:03:10,399 --> 03:03:12,319
how simple it can be at the very end

4855
03:03:12,319 --> 03:03:13,600
when you start using some of the tools

4856
03:03:13,600 --> 03:03:15,239
in the modern data stack where you know

4857
03:03:15,239 --> 03:03:17,399
you have tools like air bite and airflow

4858
03:03:17,399 --> 03:03:19,160
and many other tools where you can bring

4859
03:03:19,160 --> 03:03:20,880
into the stack and just make it a lot

4860
03:03:20,880 --> 03:03:22,960
easier as a data engineer now the

4861
03:03:22,960 --> 03:03:24,399
opportunities here are endless and this

4862
03:03:24,399 --> 03:03:26,600
is can hopefully open some doors to you

4863
03:03:26,600 --> 03:03:28,800
to test some things and also play around

4864
03:03:28,800 --> 03:03:30,359
with other things to become a data

4865
03:03:30,359 --> 03:03:32,439
engineer eventually but please let us

4866
03:03:32,439 --> 03:03:33,960
know how we did please let me know if

4867
03:03:33,960 --> 03:03:35,760
you have any questions or if you learned

4868
03:03:35,760 --> 03:03:37,239
anything new here please let me know

4869
03:03:37,239 --> 03:03:39,239
down in the comments or anything like

4870
03:03:39,239 --> 03:03:40,520
that but I hope you all enjoyed this

4871
03:03:40,520 --> 03:03:42,080
course and thank you so much for

4872
03:03:42,080 --> 03:03:44,920
watching